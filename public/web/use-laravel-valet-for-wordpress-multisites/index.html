<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Cache-control" content="public">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5">
  
    <title>James Doyle | Use Laravel Valet for WordPress Multisites</title>
  
  <meta name="google-site-verification" content="KM-5h_iJ7JJsGeUp4ncEoYCBKft1ko1A4gBpjIzT0p4" />
  <link href="https://plus.google.com/109231487156400680487" rel="author publisher" />
  
  <meta itemprop="name" content="James Doyle">
  <meta property="og:site_name" content="ohdoylerules">
  <meta itemprop="url" content="https://ohdoylerules.com/web/use-laravel-valet-for-wordpress-multisites/">
  <meta itemprop="email" content="james2doyle@gmail.com">
  <meta property="og:url" content="https://ohdoylerules.com/web/use-laravel-valet-for-wordpress-multisites/">
  <meta itemprop="image logo" content="https://ohdoylerules.com/icons/logo.png">
  <meta property="og:image" content="https://ohdoylerules.com/icons/logo.png">
  <link rel="apple-touch-icon" sizes="57x57" href="https://ohdoylerules.com/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="https://ohdoylerules.com/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="https://ohdoylerules.com/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="https://ohdoylerules.com/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="https://ohdoylerules.com/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="https://ohdoylerules.com/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="https://ohdoylerules.com/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="https://ohdoylerules.com/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://ohdoylerules.com/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="https://ohdoylerules.com/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://ohdoylerules.com/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="https://ohdoylerules.com/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://ohdoylerules.com/icons/favicon-16x16.png">
  <link rel="manifest" href="https://ohdoylerules.com/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="https://ohdoylerules.com/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#333333">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@james2doyle">
  <meta name="twitter:title" content="Use Laravel Valet for WordPress Multisites">
  <meta name="twitter:creator" content="@james2doyle">
  <meta name="twitter:image" content="https://ohdoylerules.com/icons/logo.png">
  <meta name="twitter:domain" content="https://ohdoylerules.com/">
  <link rel="icon" href="https://ohdoylerules.com/icons/logo.svg">
  
  
    <link rel="dns-prefetch" href="https://c.disquscdn.com">
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Use Laravel Valet for WordPress Multisites">
    <meta property="article:author" content="James Doyle" />
    <meta property="article:section" content="Web" />
    <meta property="article:tag" content="laravel, valet&#34;, php, subdomain, wordpress, multisite, setup" />
    <meta itemprop="keywords" content="laravel, valet&#34;, php, subdomain, wordpress, multisite, setup">
    <meta property="og:keywords" content="laravel, valet&#34;, php, subdomain, wordpress, multisite, setup">
    
    
      <meta name="description" content="Use Laravel Valet for developing local WordPress multisites">
      <meta itemprop="description" content="Use Laravel Valet for developing local WordPress multisites">
      <meta property="og:description" content="Use Laravel Valet for developing local WordPress multisites">
      <meta name="twitter:description" content="Use Laravel Valet for developing local WordPress multisites">
    
  
  <link rel="dns-prefetch" href="https://www.google-analytics.com">
  <link rel="shortcut icon" href="https://ohdoylerules.com/favicon.ico" />
  <link rel="canonical" href="https://ohdoylerules.com/web/use-laravel-valet-for-wordpress-multisites/">
  <link rel="sitemap" type="application/xml" title="Sitemap" href="https://ohdoylerules.com/sitemap.xml" />
  <meta id="themes" name="themes" content="https://ohdoylerules.com/css/new.light.css,https://ohdoylerules.com/css/new.dark.css">
  <link id="stylesheet" rel="stylesheet" href="https://ohdoylerules.com/css/new.light.css">
  <style type="text/css">
    body {
      font-feature-settings: 'lnum' 1;
      font-variant-numeric: slashed-zero;
      text-rendering: geometricPrecision;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
      -webkit-text-size-adjust: 100%;
      -ms-text-size-adjust: 100%;
      opacity: 0;
      transition: opacity 0.2s ease;
      will-change: opacity;
    }
    body.light, body.dark {
      opacity: 1;
    }
    .show-on-light,
    .show-on-dark {
      display: none;
    }
    .light .show-on-light,
    .dark .show-on-dark {
      display: block;
    }
    a.none {
      color: inherit;
      border: none;
      opacity: 1;
    }
    a.none:hover {
      background: none;
      opacity: 0.6;
    }
    .center {
      text-align: center;
    }
    .center img {
      max-width: 100%;
      height: auto;
    }
    pre {
      color: #f8f8f2;
      background-color: #282a36;
      -moz-tab-size: 4;
      -o-tab-size: 4;
      tab-size: 4;
    }
    pre code.language-diff span:nth-child(1n + 7) {
      color: #50fa7b;
    }
    .switch-wrapper {
      display: flex;
      align-items: center;
      position: absolute;
      top: 1rem;
      right: 2rem;
      font-size: 80%;
    }
    .switch {
      position: relative;
      margin: 0 0.4rem;
    }
    .switch input {
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: 1;
      opacity: 0;
      cursor: pointer;
    }
    .switch label {
      display: flex;
      border-radius: 9999px;
      height: 0.8rem;
      width: 1.8rem;
      background-color: rgba(0, 0, 0, .1);
      border: 1px solid rgba(0, 0, 0, .3);
    }
    .switch input:checked + label {
      background-color: #357edd;
      border: 1px solid #357edd;
      justify-content: flex-end;
    }
    .switch div {
      width: calc(0.8rem - 2px);
      height: calc(0.8rem - 2px);
      border-radius: 9999px;
      border: 1px solid rgba(0, 0, 0, .3);
      background-color: #FFF;
    }
     
    body.dark table.highlight tr:nth-child(even) {
      background-color: rgb(246, 248, 250);
    }
    body.dark table.highlight td,
    body.dark table.highlight th {
      border-color: rgba(27,31,35,.3);
    }
  </style>
  <script type="text/javascript" charset="utf-8" defer>
    document.addEventListener('DOMContentLoaded', function() {
      
      const defaultIndex = window.matchMedia('(prefers-color-scheme)').media !== 'not all' ? '1' : '0';
      
      const activeIndex = JSON.parse(window.localStorage.getItem('activeIndex') || defaultIndex);

      const themes = document.getElementById('themes').content.split(',');
      const stylesheet = document.getElementById('stylesheet');
      if (stylesheet.href !== themes[activeIndex]) {
        stylesheet.href = themes[activeIndex];
      }

      document.body.className = activeIndex === 0 ? 'light' : 'dark';

      const theSwitch = document.getElementById('switch');
      theSwitch.checked = Boolean(activeIndex);
      theSwitch.addEventListener('change', function() {
        const newIndex = Number(this.checked);
        stylesheet.href = themes[newIndex];
        document.body.className = newIndex === 0 ? 'light' : 'dark';
        window.localStorage.setItem('activeIndex', newIndex);
      });
    });
  </script>
</head>
<body>
<div class="switch-wrapper">
  <div>Light</div>
  <div class="switch">
    <input id="switch" type="checkbox" style="display: none" />
    <label for="switch">
      <div></div>
    </label>
  </div>
  <div>Dark</div>
</div>

<div itemscope itemtype="http://schema.org/BlogPosting">
  <div class="container">
    <header class="grid -middle">
      <div class="cell menu">
        <h1 itemprop="name headline">Use Laravel Valet for WordPress Multisites</h1>
      </div>
    </header>
    <p><a href="https://ohdoylerules.com/" title="Go Back Home">Go home</a></p>
    <div class="the-loop">
      <div class="post-info">
        
        <span class="post-date" itemprop="datePublished">üïí September 1, 2019</span>
        
        
        &nbsp;&nbsp;&nbsp;
        
        <span class="post-category" itemprop="genre about">üè∑ Web</span>
        
      </div>
      <div itemprop="ArticleBody text" class="main-content"><p>Working with WordPress multisites can sometimes be a pain. Especially if you are not using the amazing <a href="https://laravel.com/docs/6.0/valet">Laravel Valet</a> tool to manage your local sites.</p>
<p>From the site:</p>
<blockquote>
<p>Valet is a Laravel (or any site really) development environment for Mac minimalists. No Vagrant, no /etc/hosts file.</p>
</blockquote>
<p>I would add that everything can be managed from the command line as well. Very handy.</p>
<p>I&rsquo;m going to make some assumptions for the rest of the post. Firstly, you already have a WordPress multisite setup at <code>~/Sites/my-blog</code> (or wherever your root folder is) that is already resolving with <code>my-blog.localhost</code>. The TLD (in my case <code>.localhost</code>) is not important either. Just imagine yours there instead.</p>
<p>We are going to want to add a new domain name that resolves to the exact same folder as our current blog setup. We can do that with <code>valet link</code>.</p>
<p>So let&rsquo;s run some commands:</p>
<ul>
<li><code>cd ~/Sites/my-blog</code></li>
<li><code>valet link my-other-blog.localhost</code></li>
</ul>
<p>Now we have 2 domains pointing to the same folder:</p>
<ul>
<li><code>my-blog.localhost</code></li>
<li><code>my-other-blog.localhost</code></li>
</ul>
<p>They are both going to resolve to the same site right now. That&rsquo;s OK. We need to tweak our <code>wp-config.php</code> to work properly with the requests.</p>
<p>If we have multisite already setup, we should see some sites in the <code>wp_blogs</code> table of our database. We want each of these &ldquo;sites&rdquo; to reflect the domains on our system. You can update those now and make sure that the domains match the ones we are setting up.</p>
<p>Then we need to update our <code>wp-config.php</code> with some changes:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#ff79c6">&lt;?php</span>
<span style="color:#6272a4">// wp-config.php
</span><span style="color:#6272a4"></span>
<span style="color:#6272a4">// ... there is going to be other stuff in here at the top...
</span><span style="color:#6272a4"></span>
<span style="color:#6272a4">// check for HTTPS since valet makes it easy to add HTTPS locally...
</span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">$protocol</span> <span style="color:#ff79c6">=</span> isset(<span style="color:#8be9fd;font-style:italic">$_SERVER</span>[<span style="color:#f1fa8c">&#39;HTTPS&#39;</span>]) <span style="color:#ff79c6">&amp;&amp;</span> <span style="color:#8be9fd;font-style:italic">$_SERVER</span>[<span style="color:#f1fa8c">&#39;HTTPS&#39;</span>] <span style="color:#ff79c6">===</span> <span style="color:#f1fa8c">&#39;on&#39;</span> <span style="color:#ff79c6">?</span> <span style="color:#f1fa8c">&#39;https://&#39;</span> <span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;http://&#39;</span>;

<span style="color:#6272a4">// set the home vars based on the domain that is being used for this request
</span><span style="color:#6272a4"></span>define(<span style="color:#f1fa8c">&#39;WP_HOME&#39;</span>, <span style="color:#8be9fd;font-style:italic">$protocol</span> <span style="color:#ff79c6">.</span> <span style="color:#8be9fd;font-style:italic">$_SERVER</span>[<span style="color:#f1fa8c">&#39;HTTP_HOST&#39;</span>]);
define(<span style="color:#f1fa8c">&#39;WP_SITEURL&#39;</span>, WP_HOME);

<span style="color:#6272a4">// multisite settings, should be the same
</span><span style="color:#6272a4"></span>define(<span style="color:#f1fa8c">&#39;WP_ALLOW_MULTISITE&#39;</span>, <span style="color:#ff79c6">true</span>);
define(<span style="color:#f1fa8c">&#39;MULTISITE&#39;</span>, <span style="color:#ff79c6">true</span>);

<span style="color:#6272a4">// grab the domain from the request and just set it as the current site
</span><span style="color:#6272a4"></span>define(<span style="color:#f1fa8c">&#39;DOMAIN_CURRENT_SITE&#39;</span>, <span style="color:#8be9fd;font-style:italic">$_SERVER</span>[<span style="color:#f1fa8c">&#39;HTTP_HOST&#39;</span>]);

<span style="color:#6272a4">// we get the IDs from `wp_blogs` table
</span><span style="color:#6272a4">// and use them here as our domain =&gt; wp_blog.id mappings
</span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">$site</span> <span style="color:#ff79c6">=</span> [
    <span style="color:#f1fa8c">&#39;my-blog.localhost&#39;</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#bd93f9">1</span>,
    <span style="color:#f1fa8c">&#39;my-other-blog.localhost&#39;</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#bd93f9">2</span>,
][<span style="color:#8be9fd;font-style:italic">$_SERVER</span>[<span style="color:#f1fa8c">&#39;HTTP_HOST&#39;</span>]];

<span style="color:#6272a4">// we set the active ID here now that we have the right one
</span><span style="color:#6272a4">// based on the domain we are on in this request
</span><span style="color:#6272a4"></span>define(<span style="color:#f1fa8c">&#39;SITE_ID_CURRENT_SITE&#39;</span>, <span style="color:#8be9fd;font-style:italic">$site</span>);
define(<span style="color:#f1fa8c">&#39;BLOG_ID_CURRENT_SITE&#39;</span>, <span style="color:#8be9fd;font-style:italic">$site</span>);

<span style="color:#6272a4">// the rest of the regular stuff
</span><span style="color:#6272a4">// up to you what you want here
</span><span style="color:#6272a4"></span>define(<span style="color:#f1fa8c">&#39;WP_DEBUG&#39;</span>, <span style="color:#ff79c6">false</span>);
define(<span style="color:#f1fa8c">&#39;WP_CACHE&#39;</span>, <span style="color:#ff79c6">false</span>);
define(<span style="color:#f1fa8c">&#39;PATH_CURRENT_SITE&#39;</span>, <span style="color:#f1fa8c">&#39;/&#39;</span>);
define(<span style="color:#f1fa8c">&#39;COOKIE_DOMAIN&#39;</span>, <span style="color:#f1fa8c">&#39;&#39;</span>);
define(<span style="color:#f1fa8c">&#39;ADMIN_COOKIE_PATH&#39;</span>, <span style="color:#f1fa8c">&#39;/&#39;</span>);
define(<span style="color:#f1fa8c">&#39;COOKIEPATH&#39;</span>, <span style="color:#f1fa8c">&#39;/&#39;</span>);
define(<span style="color:#f1fa8c">&#39;SITECOOKIEPATH&#39;</span>, <span style="color:#f1fa8c">&#39;/&#39;</span>);
</code></pre></div><p>So what we are doing here is taking advantage of the way PHP handles requests. Each request runs the entire application. So we can use the request itself as the state of our application. We use the domain to figure out which site we should be loading. Pretty simple.</p>
<p>Now we don&rsquo;t have to make multiple copies of the WordPress setup just to test the basic multisite features.</p>
<p>I understand that you probably don&rsquo;t want to do this as multisite is usually because you want to administrate multiple instances of WordPress at the same time. But when you are just using multisite for managing content. In my case, it was just that the site was multilingual and so we wanted the sites to be identical but the content is swapping in and out. So this is a setup for that instead of having two completely separate folders and copies.</p>
<p>The nice thing about this is that it also scales nicely. If you have new sites, just <code>valet link</code> the domain, and add to the array of <code>$sites</code>. Done!</p>
</div>
      <p><a href="https://ohdoylerules.com/" title="Go Back Home">Go home</a></p>
      <hr>
      <div class="media grid">
        <div class="media-left">
          <a href="https://twitter.com/james2doyle" target="_blank" class="post-author-link">
            <img src="https://www.gravatar.com/avatar/b7375c88e1864c4ddf0d7bdab58e4cca?s=120&amp;d=mm&amp;r=g" alt="James Doyle Profile Picture" width="120" height="120">
          </a>
        </div>
        <div class="media-body cell -9of12">
          <div class="media-heading"><h3 itemprop="author publisher creator provider">James Doyle</h3></div>
          <div class="media-content">
            <p>I'm a full-stack developer, co-organizer of <a href="https://www.meetup.com/vancouver-php" title="PHP Vancouver" target="_blank">PHP Vancouver</a> meetup, and winner of a <a href="http://www.canadianbusiness.com/innovation/developer-30-under-30-gallery/image/20/" title="Canadian Developer 30 under 30 award" target="_blank">Canadian Developer 30 under 30 award</a>. I'm a huge Open Source advocate and contributor to a lot of projects in my community. When I am not sitting at a computer, I'm trying to perfect some other skill.</p>
          </div>
        </div>
      </div>
      <hr>
      
        <div id="disqus_thread" itemprop="comment"></div>
        <script type="text/javascript">(function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//ohdoylerules.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })();</script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      
    </div>
  </div>
</div>


<script defer>
  
  
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js?384-128');
  }
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-30413344-2']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'https://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
  
</script>
</body>
</html>

