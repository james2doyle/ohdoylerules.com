<!doctype html><html lang=en><head><meta charset=utf-8><meta content=public http-equiv=Cache-control><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1,maximum-scale=5" name=viewport><title>Bitbucket Weekly Reports Using Make (Integromat) | OhDoyleRules</title><meta content="Bitbucket Weekly Reports Using Make (Integromat) | OhDoyleRules" name=twitter:title><meta content=KM-5h_iJ7JJsGeUp4ncEoYCBKft1ko1A4gBpjIzT0p4 name=google-site-verification><meta content="Bitbucket Weekly Reports Using Make (Integromat)" itemprop=name><meta content=OhDoyleRules property=og:site_name><meta content=https://ohdoylerules.com/snippets/bitbucket-weekly-reports-using-integromat-make/ itemprop=url><meta content=james2doyle@gmail.com itemprop=email><meta content=https://ohdoylerules.com/snippets/bitbucket-weekly-reports-using-integromat-make/ property=og:url><meta itemprop="image logo" content=/icons/logo.png><meta content=/icons/logo.png property=og:image><link href=/icons/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/icons/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/icons/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=/site.webmanifest rel=manifest><link color=#333333 href=/icons/safari-pinned-tab.svg rel=mask-icon><link href=/icons/favicon.ico rel=icon sizes=any><link href=/icons/favicon.svg rel=icon type=image/svg+xml><meta content=/browserconfig.xml name=msapplication-config><meta content=#ffffff name=msapplication-TileColor><meta content=#ffffff name=theme-color><meta content=summary name=twitter:card><meta content=@james2doyle name=twitter:site><meta content="Bitbucket Weekly Reports Using Make (Integromat)" name=twitter:title><meta content=@james2doyle name=twitter:creator><meta content=/icons/logo.png name=twitter:image><meta content=/ name=twitter:domain><link href=/icons/logo.svg rel=icon><meta content="Use Make (Integromat) to create a nice weekly report in Slack for all the closed pull-requests in a Bitbucket repository" name=description><meta content="Use Make (Integromat) to create a nice weekly report in Slack for all the closed pull-requests in a Bitbucket repository" itemprop=description><meta content="Use Make (Integromat) to create a nice weekly report in Slack for all the closed pull-requests in a Bitbucket repository" property=og:description><meta content="Use Make (Integromat) to create a nice weekly report in Slack for all the closed pull-requests in a Bitbucket repository" name=twitter:description><meta content=article property=og:type><meta content="Bitbucket Weekly Reports Using Make (Integromat) | OhDoyleRules" property=og:title><meta content="james2doyle@gmail.com James Doyle" property=article:author><meta content="make, Integromat, Bitbucket, report, git, slack, pagination" itemprop=keywords><meta content="make, Integromat, Bitbucket, report, git, slack, pagination" property=article:tag><meta content="make, Integromat, Bitbucket, report, git, slack, pagination" property=og:keywords><link href=https://www.google-analytics.com rel=dns-prefetch><link rel="shortcut icon" href=/favicon.ico><link href=https://ohdoylerules.com/snippets/bitbucket-weekly-reports-using-integromat-make/ rel=canonical><link href=https://ohdoylerules.com/atom.xml rel=alternate title=atom type=application/atom+xml><style>:root{--b-font-main:system-ui,sans-serif;--b-font-mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;--b-txt:#dcd7ba;--b-bg-1:#18171f;--b-bg-2:#2d4f67;--b-line:#727169;--b-link:#ffa066;--b-heading:#fff;--b-btn-bg:#2d4f67;--b-btn-txt:#c8c093;--b-focus:#2d4f67;--b-accent-1:#e6c384;--b-accent-2:#c34043;--b-selection-color:#c8c093;--b-selection-bg:#2d4f67}*,:before,:after{box-sizing:border-box}::selection{color:var(--b-selection-color);background-color:var(--b-selection-bg)}html:focus-within{scroll-behavior:smooth}body{background:var(--b-bg-1);font-family:var(--b-font-main);font-feature-settings:"lnum" 1;font-variant-numeric:slashed-zero;text-rendering:optimizelegibility;color:var(--b-txt);-moz-tab-size:4;tab-size:4;word-break:break-word;overflow-wrap:break-word;-webkit-tap-highlight-color:#0000;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;max-width:70ch;margin:auto;padding:0 1rem;line-height:1.5}h1,h2,h3,h4,h5,h6,p,ul,ol,dl,dd,details,blockquote,pre,figure,table,address,hr,fieldset,iframe,audio,video{margin:0 0 1.5rem}h1,h2,h3,h4,h5,h6{text-wrap:balance;color:var(--b-heading);margin-top:2rem;line-height:1.25}h1{font-size:2rem}h2{font-size:1.5rem}h3{font-size:1.25rem}h4{font-size:1rem}h5{font-size:.875rem}h6{font-size:.75rem}a{color:var(--b-link);text-decoration:underline}a:hover{text-decoration:underline}img,video,svg{max-width:100%;height:auto}embed,iframe,object{max-width:100%}iframe{border-style:none;width:100%;height:100%}abbr[title]{text-decoration:underline dotted}b,strong{font-weight:700}blockquote{border-left:.25rem solid var(--b-accent-2);margin-left:0;padding:.5rem 0 .5rem 1.5rem}blockquote p{margin-bottom:0}small{font-size:.875rem}sub,sup{vertical-align:baseline;font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}hr{border:0;border-bottom:1px solid var(--b-line);height:0}mark{background:var(--b-bg-2);color:var(--b-txt);border-radius:.25rem;padding:.125rem .25rem}pre,code,kbd,samp,tt,var{background:var(--b-bg-2);font-family:var(--b-font-mono);border-radius:.25rem;padding:.125rem .25rem;font-size:.875em}pre{white-space:pre;padding:1rem;overflow:auto}pre code{background-color:inherit;padding:0}p code{background-color:var(--b-bg-2);color:var(--b-accent-1)}details{background:var(--b-bg-2);border:1px solid var(--b-line);border-radius:.25rem;padding:.5rem 1rem;display:block}details[open]>summary{margin-bottom:1.5rem}summary{cursor:pointer;font-weight:700;display:list-item}summary:focus{box-shadow:none}table{border-collapse:collapse;text-indent:0;overflow-wrap:anywhere;width:100%}table caption{margin-bottom:.5rem}tr{border-bottom:1px solid var(--b-line)}td,th{word-break:normal;padding:.5rem 0 .5rem 1rem}td:first-child,th:first-child{padding-left:0}th{text-align:left}ul,ol,dd{padding-left:2rem}li>ul,li>ol{margin-bottom:0}fieldset{border:1px solid var(--b-line);border-radius:.25rem;padding:.5rem .75rem}legend{padding:0 .25rem}label{cursor:pointer;margin-bottom:.25rem;display:block}button,input,select,textarea{background:var(--b-bg-2);font:inherit;color:var(--b-txt);border:0;border-radius:.25rem;max-width:100%;margin:0;padding:.5rem .75rem;line-height:1.125}button,select{text-transform:none}select,[type=date],[type=datetime-local],[type=datetime],[type=email],[type=month],[type=number],[type=password],[type=search],[type=tel],[type=text],[type=time],[type=url],[type=week]{width:100%}[type=image],[type=checkbox],[type=radio]{cursor:pointer}[type=color]{min-height:2.125rem}select:not([multiple]):not([size]){-webkit-appearance:none;-moz-appearance:none;appearance:none;background-position:right .5rem center;background-repeat:no-repeat;padding-right:1.5rem}textarea{resize:vertical;width:100%}textarea:not([rows]){height:8rem}button{touch-action:manipulation}button,[type=button],[type=submit],[type=reset]{-webkit-appearance:button;text-align:center;white-space:nowrap;background:var(--b-btn-bg);color:var(--b-btn-txt);cursor:pointer;border:0;transition:opacity .25s;display:inline-block}button:hover,[type=button]:hover,[type=submit]:hover,[type=reset]:hover{opacity:.75}button[disabled],[type=button][disabled],[type=submit][disabled],[type=reset][disabled]{opacity:.5}progress{vertical-align:baseline}[type=search]{-webkit-appearance:none;outline-offset:-2px}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}::-webkit-input-placeholder{color:inherit;opacity:.5}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}::-moz-focus-inner{border-style:none;padding:0}:-moz-focusring{outline:1px dotted buttontext}:-moz-ui-invalid{box-shadow:none}[aria-busy=true]{cursor:progress}[aria-disabled=true],[disabled]{cursor:not-allowed}:focus,details:focus-within{box-shadow:0 0 0 2px var(--b-focus);outline:none}@media (prefers-reduced-motion:reduce){html:focus-within{scroll-behavior:auto}*,:before,:after{background-attachment:initial!important;scroll-behavior:auto!important;transition-delay:0!important;transition-duration:0!important;animation-duration:1ms!important;animation-iteration-count:1!important;animation-delay:-1ms!important}}select:not([multiple]):not([size]){background-image:url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23eceff4'%3E%3Cpath d='M5 6l5 5 5-5 2 1-7 7-7-7 2-1z'/%3E%3C/svg%3E")}.post-info,.center img{margin-bottom:1rem}a.none{color:inherit;opacity:1;border:none}a.none:hover{opacity:.6;background:0 0}.center{text-align:center}.center a{display:block}html.is-changing .transition-fade{view-transition-name:main}::view-transition-old(main){animation:.25s ease-in-out both fade}::view-transition-new(main){animation:.25s ease-in-out reverse both fade}@keyframes fade{0%{opacity:1}to{opacity:0}}html.is-changing:not(.swup-native) .transition-fade{will-change:opacity;opacity:1;transition:opacity .25s}html.is-animating:not(.swup-native) .transition-fade{opacity:0}.render-later{content-visibility:auto;contain-intrinsic-size:auto 166px}</style><style>.center img{max-width:100%;height:auto}pre code.language-diff span:nth-child(n+7){color:#50fa7b}iframe{border:0;min-height:300px;margin:0}.gist-iframe{filter:invert()hue-rotate(180deg)brightness();background-color:#fff}body table.highlight tr:nth-child(2n){background-color:#f6f8fa}body table.highlight td,body table.highlight th{border-color:#1b1f234d}</style><body><main class=transition-fade id=swup><header class=center><h1 itemprop="name headline">Bitbucket Weekly Reports Using Make (Integromat)</h1></header><hr><div itemscope itemtype=http://schema.org/BlogPosting><div><p><a title="Go Back Home" href=https://ohdoylerules.com>Go home</a><article><section class=post-info><span itemprop=datePublished> 🕒   <time datetime=2022-08-06T00:00:00>August 06, 2022</time> </span></section><div itemprop="ArticleBody text" class=main-content><p>At my job, we like to keep our team updated with all the dev work we do each week. This means we have meetings every Monday to review the work that has happened since the previous week.<p>I often like to review the work done over that time frame by looking at the projects git log for all the pull-requests merged during that previous week.<p>Now, I could open up the <code>develop</code> branch and run a <code>git shortlog --since "1 week ago"</code> every Monday, but I would much rather automate this task so I don't have to remember to do anything and it stays consistent. I can just wake up on Monday and see a pretty little report printed in the project Slack channel.<p>The way I accomplished this is using <a href="https://www.make.com/en?pc=jamesdoyle&fromImt=1" rel="noopener nofollow noreferrer" target=_blank>Make.com (formerly Integromat)</a>. This is a "no-code" tool that allows you to use visual programming to build tools and apps.<p>Let's break down the solution I came up with:<div class=center><a title="Bitbucket integromat make 01" href=/images/bb-integromat-make-01.png target=_blank> <img alt="Bitbucket integromat make 01" src=/images/bb-integromat-make-01.png> </a></div><p>With a final output something like this:<pre>
<h5><strong>BitBucket Reporter  [APP]  9:01 AM</strong></h5>
<strong>List of BitBucket PRs since 2022-07-25 [1 of 2]</strong>
#824 - Feature/events [MERGED] by James Doyle
#825 - Bugfix/appointments and invoices [MERGED] by Sr. Developer
#826 - Feature/auto submit changes [MERGED] by Sr. Developer
#827 - Feature/events [MERGED] by James Doyle
#828 - Fixed: case where missing was not correct [MERGED] by James Doyle
#829 - Fixed: another issue with the wrong conditions showing up [MERGED] by James Doyle
#830 - Bugfix/appointment and admin notes [MERGED] by Sr. Developer
#831 - Feature/user-profile-header [MERGED] by Jr. Developer
#832 - Feature/user profile treatment plan [OPEN] by Sr. Developer
#833 - Fixed: loading wrong classes and incorrect state [MERGED] by James Doyle
<strong>List of BitBucket PRs since 2022-07-25 [2 of 2]</strong>
#834 - Fix/users documents style tweaks [MERGED] by Jr. Developer
#835 - Feature/insurance claims [OPEN] by Jr. Developer
#836 - Feature/forms [MERGED] by James Doyle
#837 - Bugfix/user tickets [OPEN] by Jr. Developer
</pre><p>Here is the overall solution laid out. As you can see, it wasn't as simple as it might seem.<p>I will go through the solution step-by-step and explain each node. I will assume you already have Slack and BitBucket connected.<h3 id=step-1>Step 1</h3><div class=center><a title="Bitbucket integromat make 02" href=/images/bb-integromat-make-02.png target=_blank> <img alt="Bitbucket integromat make 02" src=/images/bb-integromat-make-02.png> </a></div><p>First we need set the schedule to run each Monday. Nothing fancy here. I set it to 9:01 just because I am usually on the computer by then so I will see the channel notification.<h3 id=step-2>Step 2</h3><div class=center><a title="Bitbucket integromat make 03" href=/images/bb-integromat-make-03.png target=_blank> <img alt="Bitbucket integromat make 03" src=/images/bb-integromat-make-03.png> </a></div><p>Here is the reason this is so complicated: the BitBucket API is paginated and there is no way to easily page through the results. So we need to loop through each page from the results and append them to a variable we eventually send to Slack.<p>In this request, we ask BitBucket for the "merged" and "open" pull-requests that happened last week. There was no nice way to calculate the previous weeks date, so we have this fun code to get the date of the previous Monday.<p>You can copy the text below for the query:<pre style=color:#c0c5ce;background-color:#2b303b><code><span>(state="merged" OR state="open") AND created_on>="{{formatDate(setDay(parseDate(timestamp - 604800; "X"); "monday"); "YYYY-MM-DD")}}"
</span></code></pre><p>The only reason we run this first request just so we can get the page count that we will then use to create a loop to make the real requests.<h3 id=step-3>Step 3</h3><div class=center><a title="Bitbucket integromat make 04" href=/images/bb-integromat-make-04.png target=_blank> <img alt="Bitbucket integromat make 04" src=/images/bb-integromat-make-04.png> </a></div><p>Here is the loop that we use to iterate over the pages in the results. We check the page size and make sure we repeat the right amount of times.<div class=center><a title="Bitbucket integromat make 04 A" href=/images/bb-integromat-make-04a.png target=_blank> <img alt="Bitbucket integromat make 04 A" src=/images/bb-integromat-make-04a.png> </a></div><p>Our first route (the top one) is the condition that the loop continues to run in. You can see the condition is a basic for loop that repeats for each page in the loop.<h3 id=step-4>Step 4</h3><div class=center><a title="Bitbucket integromat make 05" href=/images/bb-integromat-make-05.png target=_blank> <img alt="Bitbucket integromat make 05" src=/images/bb-integromat-make-05.png> </a></div><p>Here is the request that happens within the loop. It is identical to the first one but we have a page parameter so that we can get each page of the results.<h3 id=step-5>Step 5</h3><div class=center><a title="Bitbucket integromat make 06" href=/images/bb-integromat-make-06.png target=_blank> <img alt="Bitbucket integromat make 06" src=/images/bb-integromat-make-06.png> </a></div><p>All we are doing in this node is sorting the pull requests by their title. We do this because the PR number is in the title and not sorting it would look off.<h3 id=step-6>Step 6</h3><div class=center><a title="Bitbucket integromat make 07" href=/images/bb-integromat-make-07.png target=_blank> <img alt="Bitbucket integromat make 07" src=/images/bb-integromat-make-07.png> </a></div><p>Here we are defining the string template for the PR titles that will go into our bulleted list. The output of this will be a single variable that contains all the row strings.<h3 id=step-7>Step 7</h3><div class=center><a title="Bitbucket integromat make 08" href=/images/bb-integromat-make-08.png target=_blank> <img alt="Bitbucket integromat make 08" src=/images/bb-integromat-make-08.png> </a></div><p>Nothing fancy here. Just getting the variable the we will be pushing the results of our text aggregation to.<h3 id=step-8>Step 8</h3><div class=center><a title="Bitbucket integromat make 09" href=/images/bb-integromat-make-09.png target=_blank> <img alt="Bitbucket integromat make 09" src=/images/bb-integromat-make-09.png> </a></div><p>Here we are updating our actual results that will be sent to Slack. We break up the list with a nice header that is chunked by page.<p>Here is the code in the box for setting the variable:<pre style=color:#c0c5ce;background-color:#2b303b><code><span>{{21.results}}{{newline}}*List of Project PRs since {{formatDate(setDay(parseDate(timestamp - 604800; "X"); "monday"); "YYYY-MM-DD")}} [{{13.i}} of {{ceil(1.body.size / 1.body.pagelen)}}]*{{newline}}{{11.text}}
</span></code></pre><h3 id=step-9>Step 9</h3><div class=center><a title="Bitbucket integromat make 10" href=/images/bb-integromat-make-10.png target=_blank> <img alt="Bitbucket integromat make 10" src=/images/bb-integromat-make-10.png> </a></div><p>Here is the other condition in the router that will run at the end of the loop. It checks that the loop variable is larger that the page count.<div class=center><a title="Bitbucket integromat make 10 A" href=/images/bb-integromat-make-10a.png target=_blank> <img alt="Bitbucket integromat make 10 A" src=/images/bb-integromat-make-10a.png> </a></div><p>Our first step in the end case is to get the variable. We are passing this to the Slack body.<h3 id=step-10>Step 10</h3><div class=center><a title="bb integromat make 11" href=/images/bb-integromat-make-11.png target=_blank> <img alt="bb integromat make 11" src=/images/bb-integromat-make-11.png> </a></div><p>Our last step is to just shoot off that text to Slack. We have already formatted the text we are sending so we just slap it in.<h3 id=all-done>All Done!</h3><p>That is it! Hopefully this helps anyone that is trying to use the BitBucket in <a href="https://www.make.com/en?pc=jamesdoyle&fromImt=1" rel="noopener nofollow noreferrer" target=_blank>Make.com (Integromat)</a>.</div><p><a title="Go Back Home" href=https://ohdoylerules.com>Go home</a><hr><div class="media grid"><div class=media-left><a class=post-author-link href=https://twitter.com/james2doyle target=_blank> <img alt="James Doyle Profile Picture" src="https://www.gravatar.com/avatar/b7375c88e1864c4ddf0d7bdab58e4cca?s=120&d=mm&r=g" height=120 width=120> </a></div><div class="media-body cell -9of12"><div class=media-heading><h3 itemprop="author publisher creator provider">James Doyle</h3></div><div class=media-content><p>I'm a full-stack developer, co-organizer of <a title="PHP Vancouver" href=https://www.meetup.com/vancouver-php target=_blank>PHP Vancouver</a> meetup, and winner of a <a title="Canadian Developer 30 under 30 award" href=http://www.canadianbusiness.com/innovation/developer-30-under-30-gallery/image/20/ target=_blank>Canadian Developer 30 under 30 award</a>. I'm a huge Open Source advocate and contributor to a lot of projects in my community. When I am not sitting at a computer, I'm trying to perfect some other skill.</div></div></div></article></div></div></main><script defer src=https://unpkg.com/swup@4.8.1/dist/Swup.umd.js></script><script>var handleGists=(()=>{let c=`px`,b=16;const a=document.querySelectorAll(`.iframes`);[...a].forEach((a=>{a.onload=(()=>{a.style.height=a.contentWindow.document.body.scrollHeight+ b+ c});a.style.height=a.contentWindow.document.body.scrollHeight+ b+ c}))});document.addEventListener(`DOMContentLoaded`,(()=>{handleGists();const a=new Swup({native:!0});a.hooks.on(`visit:end`,handleGists,{priority:100})}))</script>