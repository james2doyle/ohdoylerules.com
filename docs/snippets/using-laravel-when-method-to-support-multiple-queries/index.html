<!doctype html><html lang=en><head><meta charset=utf-8><meta content=public http-equiv=Cache-control><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1,maximum-scale=5" name=viewport><title>Using Laravel `when` Method To Support Multiple Queries | OhDoyleRules</title><meta content="Using Laravel `when` Method To Support Multiple Queries | OhDoyleRules" name=twitter:title><meta content=KM-5h_iJ7JJsGeUp4ncEoYCBKft1ko1A4gBpjIzT0p4 name=google-site-verification><meta content="Using Laravel `when` Method To Support Multiple Queries" itemprop=name><meta content=OhDoyleRules property=og:site_name><meta content=https://ohdoylerules.com/snippets/using-laravel-when-method-to-support-multiple-queries/ itemprop=url><meta content=james2doyle@gmail.com itemprop=email><meta content=https://ohdoylerules.com/snippets/using-laravel-when-method-to-support-multiple-queries/ property=og:url><meta itemprop="image logo" content=/icons/logo.png><meta content=/icons/logo.png property=og:image><link href=/icons/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/icons/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/icons/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=/site.webmanifest rel=manifest><link color=#333333 href=/icons/safari-pinned-tab.svg rel=mask-icon><link href=/icons/favicon.ico rel=icon sizes=any><link href=/icons/favicon.svg rel=icon type=image/svg+xml><meta content=/browserconfig.xml name=msapplication-config><meta content=#ffffff name=msapplication-TileColor><meta content=#ffffff name=theme-color><meta content=summary name=twitter:card><meta content=@james2doyle name=twitter:site><meta content="Using Laravel `when` Method To Support Multiple Queries" name=twitter:title><meta content=@james2doyle name=twitter:creator><meta content=/icons/logo.png name=twitter:image><meta content=/ name=twitter:domain><link href=/icons/logo.svg rel=icon><meta content="How to use the `when` method on database collections in Laravel to create more flexible and readable code" name=description><meta content="How to use the `when` method on database collections in Laravel to create more flexible and readable code" itemprop=description><meta content="How to use the `when` method on database collections in Laravel to create more flexible and readable code" property=og:description><meta content="How to use the `when` method on database collections in Laravel to create more flexible and readable code" name=twitter:description><link href=https://c.disquscdn.com rel=dns-prefetch><meta content=article property=og:type><meta content="Using Laravel `when` Method To Support Multiple Queries | OhDoyleRules" property=og:title><meta content="james2doyle@gmail.com James Doyle" property=article:author><meta content="query, laravel, sqlite, postgres, sql, builder, search, when, switch, case" itemprop=keywords><meta content="query, laravel, sqlite, postgres, sql, builder, search, when, switch, case" property=article:tag><meta content="query, laravel, sqlite, postgres, sql, builder, search, when, switch, case" property=og:keywords><link href=https://www.google-analytics.com rel=dns-prefetch><link rel="shortcut icon" href=/favicon.ico><link href=https://ohdoylerules.com/snippets/using-laravel-when-method-to-support-multiple-queries/ rel=canonical><link href=https://ohdoylerules.com/atom.xml rel=alternate title=atom type=application/atom+xml><style>:root{--b-font-main:system-ui,sans-serif;--b-font-mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;--b-txt:#dcd7ba;--b-bg-1:#18171f;--b-bg-2:#2d4f67;--b-line:#727169;--b-link:#7fb4ca;--b-btn-bg:#2d4f67;--b-btn-txt:#c8c093;--b-focus:#2d4f67;--b-accent-1:#e6c384;--b-accent-2:#c34043;--b-selection-color:#c8c093;--b-selection-bg:#2d4f67}*,:after,:before{box-sizing:border-box}:selection{color:var(--b-selection-color);background-color:var(--b-selection-bg)}html:focus-within{scroll-behavior:smooth}body{max-width:70ch;padding:0 1rem;margin:auto;background:var(--b-bg-1);font-family:var(--b-font-main);font-feature-settings:"lnum" 1;font-variant-numeric:slashed-zero;text-rendering:geometricPrecision;line-height:1.5;color:var(--b-txt);-moz-tab-size:4;tab-size:4;word-break:break-word;overflow-wrap:break-word;-webkit-tap-highlight-color:rgba(0,0,0,0);-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}address,audio,blockquote,dd,details,dl,fieldset,figure,h1,h2,h3,h4,h5,h6,hr,iframe,ol,p,pre,table,ul,video{margin:0 0 1.5rem}h1,h2,h3,h4,h5,h6{line-height:1.25;margin-top:2rem;text-wrap:balance}h1{font-size:2rem}h2{font-size:1.5rem}h3{font-size:1.25rem}h4{font-size:1rem}h5{font-size:.875rem}h6{font-size:.75rem}a{color:var(--b-link);text-decoration:none}a:hover{text-decoration:underline}img,svg,video{max-width:100%;height:auto}embed,iframe,object{max-width:100%}iframe{border-style:none;width:100%;height:100%}abbr[title]{text-decoration:underline dotted}b,strong{font-weight:700}blockquote{margin-left:0;margin-trim:block;padding:.5rem 0 .5rem 1.5rem;border-left:.25rem solid var(--b-accent-2)}blockquote p{margin-bottom:0}small{font-size:.875rem}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-0.25em}sup{top:-0.5em}hr{height:0;border:0;border-bottom:1px solid var(--b-line)}mark{background:var(--b-bg-2);border-radius:.25rem;padding:.125rem .25rem;color:var(--b-txt)}code,kbd,pre,samp,tt,var{background:var(--b-bg-2);border-radius:.25rem;padding:.125rem .25rem;font-family:var(--b-font-mono);font-size:.875em}pre{padding:1rem;overflow:auto;white-space:pre}pre code{padding:0;background-color:inherit}p code{background-color:var(--b-bg-2);color:var(--b-accent-1)}details{display:block;padding:.5rem 1rem;background:var(--b-bg-2);border:1px solid var(--b-line);border-radius:.25rem;margin-trim:block}details[open]>summary{margin-bottom:1.5rem}summary{display:list-item;cursor:pointer;font-weight:700}summary:focus{box-shadow:none}table{border-collapse:collapse;width:100%;text-indent:0}table caption{margin-bottom:.5rem}tr{border-bottom:1px solid var(--b-line)}td,th{padding:.5rem 0 .5rem 1rem;word-break:normal}td:first-child,th:first-child{padding-left:0}th{text-align:left}dd,ol,ul{padding-left:2rem}li>ol,li>ul{margin-bottom:0}fieldset{padding:.5rem .75rem;border:1px solid var(--b-line);border-radius:.25rem}legend{padding:0 .25rem}label{cursor:pointer;display:block;margin-bottom:.25rem}button,input,select,textarea{margin:0;padding:.5rem .75rem;max-width:100%;background:var(--b-bg-2);border:0;border-radius:.25rem;font:inherit;line-height:1.125;color:var(--b-txt)}button,select{text-transform:none}[type=date],[type=datetime-local],[type=datetime],[type=email],[type=month],[type=number],[type=password],[type=search],[type=tel],[type=text],[type=time],[type=url],[type=week],select{width:100%}[type=checkbox],[type=image],[type=radio]{cursor:pointer}[type=color]{min-height:2.125rem}select:not([multiple]):not([size]){padding-right:1.5rem;background-repeat:no-repeat;background-position:right .5rem center;-moz-appearance:none;-webkit-appearance:none;appearance:none}textarea{width:100%;resize:vertical}textarea:not([rows]){height:8rem}button{touch-action:manipulation}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button;display:inline-block;text-align:center;white-space:nowrap;background:var(--b-btn-bg);color:var(--b-btn-txt);border:0;cursor:pointer;transition:opacity .25s}[type=button]:hover,[type=reset]:hover,[type=submit]:hover,button:hover{opacity:.75}[type=button][disabled],[type=reset][disabled],[type=submit][disabled],button[disabled]{opacity:.5}progress{vertical-align:baseline}[type=search]{-webkit-appearance:none;outline-offset:-2px}:-webkit-inner-spin-button,:-webkit-outer-spin-button{height:auto}:-webkit-input-placeholder{color:inherit;opacity:.5}:-webkit-search-decoration{-webkit-appearance:none}:-webkit-file-upload-button{-webkit-appearance:button;font:inherit}:-moz-focus-inner{border-style:none;padding:0}:-moz-focusring{outline:1px dotted ButtonText}:-moz-ui-invalid{box-shadow:none}[aria-busy=true]{cursor:progress}[aria-disabled=true],[disabled]{cursor:not-allowed}:focus,details:focus-within{outline:none;box-shadow:0 0 0 2px var(--b-focus)}@media (prefers-reduced-motion: reduce){html:focus-within{scroll-behavior:auto}*,:after,:before{animation-delay:-1ms!important;animation-duration:1ms!important;animation-iteration-count:1!important;background-attachment:initial!important;scroll-behavior:auto!important;transition-delay:0!important;transition-duration:0!important}}select:not([multiple]):not([size]){background-image:url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23eceff4'%3E%3Cpath d='M5 6l5 5 5-5 2 1-7 7-7-7 2-1z'/%3E%3C/svg%3E")}a.none{color:inherit;border:none;opacity:1}a.none:hover {background:none;opacity:.6}.center{text-align:center}html.is-changing .transition-fade{view-transition-name:main}:view-transition-old(main){animation:fade .25s ease-in-out both}:view-transition-new(main){animation:fade .25s ease-in-out both reverse}@keyframes fade{from{opacity:1}to{opacity:0}}html.is-changing:not(.swup-native) .transition-fade {will-change:opacity;transition:.25s opacity;opacity:1}html.is-animating:not(.swup-native) .transition-fade {opacity:0}</style><style>.post-info{margin-bottom:1rem}.center img{max-width:100%;height:auto}pre code.language-diff span:nth-child(1n + 7){color:#50fa7b}iframe{border:0;margin:0;min-height:300px}.gist-iframe{background-color:white;filter:invert(1) hue-rotate(180deg) brightness(1)}body table.highlight tr:nth-child(even){background-color:#f6f8fa}body table.highlight td,body table.highlight th{border-color:rgba(27,31,35,.3)}</style><body><main class=transition-fade id=swup><header class=center><h1 itemprop="name headline">Using Laravel `when` Method To Support Multiple Queries</h1></header><hr><div itemscope itemtype=http://schema.org/BlogPosting><div><p><a title="Go Back Home" href=https://ohdoylerules.com>Go home</a><article><section class=post-info><span itemprop=datePublished> 🕒   <time datetime=2022-08-14T00:00:00>August 14, 2022</time> </span></section><div itemprop="ArticleBody text" class=main-content><p>There is a method on Laravel collections called <a rel="noopener nofollow noreferrer" href=https://laravel.com/docs/8.x/collections#method-when target=_blank><code>when</code></a> that allows you to create a condition on your code without using an <code>if</code> statement. This can be really handy given we often have conditions on queries to deal with missing or present data, the session-specific environment, or even information in the config.<p>Let's look at the common pattern I was using in the past to put conditions on my queries:<pre class=language-php data-lang=php style=background:#2b303b;color:#c0c5ce><code class=language-php data-lang=php><span style=color:#ab7967>&LT?php
</span><span style=color:#65737e>/** </span><span style=color:#b48ead>@var</span><span style=color:#65737e> \Illuminate\Database\Eloquent\Builder|\App\Models\User */
</span><span>$</span><span style=color:#bf616a>query </span><span>= </span><span style=color:#ebcb8b>User</span><span>::</span><span style=color:#bf616a>query</span><span>();
</span><span>
</span><span style=color:#65737e>// get the filter from the request
</span><span>$</span><span style=color:#bf616a>filter </span><span>= $</span><span style=color:#bf616a>request</span><span>-></span><span style=color:#bf616a>input</span><span>('</span><span style=color:#a3be8c>role</span><span>');
</span><span>
</span><span style=color:#b48ead>if </span><span>(</span><span style=color:#bf616a>blank</span><span>($</span><span style=color:#bf616a>filter</span><span>)) {
</span><span>    $</span><span style=color:#bf616a>query</span><span>-></span><span style=color:#bf616a>where</span><span>('</span><span style=color:#a3be8c>role</span><span>', '</span><span style=color:#a3be8c>basic</span><span>');
</span><span>} </span><span style=color:#b48ead>else </span><span>{
</span><span>    $</span><span style=color:#bf616a>query</span><span>-></span><span style=color:#bf616a>where</span><span>('</span><span style=color:#a3be8c>role</span><span>', $</span><span style=color:#bf616a>filter</span><span>);
</span><span>}
</span></code></pre><p>This is a contrived example but it should remind you of code you have seen or written in the past. Now we can rewrite it using the <code>when</code> method:<pre class=language-php data-lang=php style=background:#2b303b;color:#c0c5ce><code class=language-php data-lang=php><span style=color:#ab7967>&LT?php
</span><span style=color:#65737e>/** </span><span style=color:#b48ead>@var</span><span style=color:#65737e> \Illuminate\Database\Eloquent\Builder|\App\Models\User */
</span><span>$</span><span style=color:#bf616a>query </span><span>= </span><span style=color:#ebcb8b>User</span><span>::</span><span style=color:#bf616a>query</span><span>();
</span><span>
</span><span style=color:#65737e>// get the filter from the request
</span><span>$</span><span style=color:#bf616a>filter </span><span>= $</span><span style=color:#bf616a>request</span><span>-></span><span style=color:#bf616a>input</span><span>('</span><span style=color:#a3be8c>role</span><span>');
</span><span>
</span><span>$</span><span style=color:#bf616a>query</span><span>-></span><span style=color:#bf616a>when</span><span>(
</span><span>    </span><span style=color:#bf616a>blank</span><span>($</span><span style=color:#bf616a>filter</span><span>),
</span><span>    </span><span style=color:#65737e>// case when the condition is true (the filter is blank)
</span><span>    </span><span style=color:#b48ead>function </span><span>($</span><span style=color:#bf616a>q</span><span>): </span><span style=color:#ebcb8b>void </span><span>{
</span><span>        $</span><span style=color:#bf616a>q</span><span>-></span><span style=color:#bf616a>where</span><span>('</span><span style=color:#a3be8c>role</span><span>', '</span><span style=color:#a3be8c>basic</span><span>');
</span><span>    },
</span><span>    </span><span style=color:#65737e>// case when condition is false (the filter is NOT blank)
</span><span>    </span><span style=color:#b48ead>function </span><span>($</span><span style=color:#bf616a>q</span><span>) </span><span style=color:#b48ead>use</span><span>($</span><span style=color:#bf616a>filter</span><span>): </span><span style=color:#ebcb8b>void </span><span>{
</span><span>        $</span><span style=color:#bf616a>q</span><span>-></span><span style=color:#bf616a>where</span><span>('</span><span style=color:#a3be8c>role</span><span>', $</span><span style=color:#bf616a>filter</span><span>);
</span><span>    });
</span></code></pre><p>This is a lot nicer in my mind. It will allow us to encapsulate code under the closure and not pollute the top level workspace. Sweet!<p>How about a more complicated example?<pre class=language-php data-lang=php style=background:#2b303b;color:#c0c5ce><code class=language-php data-lang=php><span style=color:#ab7967>&LT?php
</span><span style=color:#65737e>/** </span><span style=color:#b48ead>@var</span><span style=color:#65737e> \Illuminate\Database\Eloquent\Builder|\App\Models\User */
</span><span>$</span><span style=color:#bf616a>query </span><span>= </span><span style=color:#ebcb8b>User</span><span>::</span><span style=color:#bf616a>query</span><span>();
</span><span>
</span><span style=color:#65737e>// get the search query from the request
</span><span>$</span><span style=color:#bf616a>search </span><span>= $</span><span style=color:#bf616a>request</span><span>-></span><span style=color:#bf616a>input</span><span>('</span><span style=color:#a3be8c>query</span><span>');
</span><span>
</span><span style=color:#65737e>// when the database is not postgresql, use "like"
</span><span style=color:#b48ead>if </span><span>(</span><span style=color:#bf616a>config</span><span>('</span><span style=color:#a3be8c>database.default</span><span>') !== '</span><span style=color:#a3be8c>pgsql</span><span>') {
</span><span>    </span><span style=color:#65737e>// replace any spaces with the SQL wildcard `%` character
</span><span>    $</span><span style=color:#bf616a>likeReady </span><span>= </span><span style=color:#ebcb8b>Str</span><span>::</span><span style=color:#bf616a>of</span><span>($</span><span style=color:#bf616a>search</span><span>)-></span><span style=color:#bf616a>replace</span><span>(' ', '</span><span style=color:#a3be8c>%</span><span>')-></span><span style=color:#bf616a>append</span><span>('</span><span style=color:#a3be8c>%</span><span>')-></span><span style=color:#bf616a>prepend</span><span>('</span><span style=color:#a3be8c>%</span><span>');
</span><span>    $</span><span style=color:#bf616a>query</span><span>-></span><span style=color:#bf616a>where</span><span>('</span><span style=color:#a3be8c>name</span><span>', '</span><span style=color:#a3be8c>like</span><span>', $</span><span style=color:#bf616a>likeReady</span><span>);
</span><span>}
</span><span>
</span><span style=color:#65737e>// use advanced postgresql features for searching text
</span><span style=color:#b48ead>if </span><span>(</span><span style=color:#bf616a>config</span><span>('</span><span style=color:#a3be8c>database.default</span><span>') === '</span><span style=color:#a3be8c>pgsql</span><span>') {
</span><span>    </span><span style=color:#65737e>// use the function from the pg_trgm extension that adds special text search features
</span><span>    $</span><span style=color:#bf616a>query</span><span>-></span><span style=color:#bf616a>whereRaw</span><span>('</span><span style=color:#a3be8c>SIMILARITY("name"::text, ?) > 0.07</span><span>', [$</span><span style=color:#bf616a>search</span><span>]);
</span><span>}
</span></code></pre><p>This is actual code a wrote for an app that uses <code>sqlite</code> when testing but uses <code>postgresql</code> when running locally. This means some features just don't work unless the right code is running.<p>Let's rewrite this one as well to clean-up the top level:<pre class=language-php data-lang=php style=background:#2b303b;color:#c0c5ce><code class=language-php data-lang=php><span style=color:#ab7967>&LT?php
</span><span style=color:#65737e>/** </span><span style=color:#b48ead>@var</span><span style=color:#65737e> \Illuminate\Database\Eloquent\Builder|\App\Models\User */
</span><span>$</span><span style=color:#bf616a>query </span><span>= </span><span style=color:#ebcb8b>User</span><span>::</span><span style=color:#bf616a>query</span><span>();
</span><span>
</span><span style=color:#65737e>// get the search query from the request
</span><span>$</span><span style=color:#bf616a>search </span><span>= $</span><span style=color:#bf616a>request</span><span>-></span><span style=color:#bf616a>input</span><span>('</span><span style=color:#a3be8c>query</span><span>');
</span><span>
</span><span style=color:#65737e>// nicer way without using if statements
</span><span>$</span><span style=color:#bf616a>query</span><span>-></span><span style=color:#bf616a>when</span><span>(
</span><span>    </span><span style=color:#bf616a>config</span><span>('</span><span style=color:#a3be8c>database.default</span><span>') === '</span><span style=color:#a3be8c>pgsql</span><span>',
</span><span>    </span><span style=color:#b48ead>function </span><span>($</span><span style=color:#bf616a>q</span><span>) </span><span style=color:#b48ead>use </span><span>($</span><span style=color:#bf616a>search</span><span>): </span><span style=color:#ebcb8b>void </span><span>{
</span><span>        </span><span style=color:#65737e>// use the function from the pg_trgm extension that adds special text search features
</span><span>        $</span><span style=color:#bf616a>q</span><span>-></span><span style=color:#bf616a>whereRaw</span><span>('</span><span style=color:#a3be8c>SIMILARITY("name"::text, ?) > 0.07</span><span>', [$</span><span style=color:#bf616a>search</span><span>]);
</span><span>    },
</span><span>    </span><span style=color:#b48ead>function </span><span>($</span><span style=color:#bf616a>q</span><span>) </span><span style=color:#b48ead>use </span><span>($</span><span style=color:#bf616a>search</span><span>): </span><span style=color:#ebcb8b>void </span><span>{
</span><span>        </span><span style=color:#65737e>// replace any spaces with the SQL wildcard `%` character
</span><span>        $</span><span style=color:#bf616a>likeReady </span><span>= </span><span style=color:#ebcb8b>Str</span><span>::</span><span style=color:#bf616a>of</span><span>($</span><span style=color:#bf616a>search</span><span>)-></span><span style=color:#bf616a>replace</span><span>(' ', '</span><span style=color:#a3be8c>%</span><span>')-></span><span style=color:#bf616a>append</span><span>('</span><span style=color:#a3be8c>%</span><span>')-></span><span style=color:#bf616a>prepend</span><span>('</span><span style=color:#a3be8c>%</span><span>');
</span><span>        $</span><span style=color:#bf616a>q</span><span>-></span><span style=color:#bf616a>where</span><span>('</span><span style=color:#a3be8c>name</span><span>', '</span><span style=color:#a3be8c>like</span><span>', $</span><span style=color:#bf616a>likeReady</span><span>);
</span><span>    });
</span></code></pre><p>Great! Now we have the <code>pgsql</code> query nicely wrapped up.<p>This pattern is not just great for controllers. It works well in scoped queries too. I've used this in a scoped query to change the conditions based on the data in the model. Very handy!<p>If we use chaining, we can make a very nice flow:<pre class=language-php data-lang=php style=background:#2b303b;color:#c0c5ce><code class=language-php data-lang=php><span style=color:#ab7967>&LT?php
</span><span style=color:#65737e>/** </span><span style=color:#b48ead>@var</span><span style=color:#65737e> \Illuminate\Database\Eloquent\Builder|\App\Models\User */
</span><span>$</span><span style=color:#bf616a>query </span><span>= </span><span style=color:#ebcb8b>User</span><span>::</span><span style=color:#bf616a>query</span><span>();
</span><span>
</span><span>$</span><span style=color:#bf616a>search </span><span>= $</span><span style=color:#bf616a>request</span><span>-></span><span style=color:#bf616a>input</span><span>('</span><span style=color:#a3be8c>query</span><span>');
</span><span>$</span><span style=color:#bf616a>filter </span><span>= $</span><span style=color:#bf616a>request</span><span>-></span><span style=color:#bf616a>input</span><span>('</span><span style=color:#a3be8c>role</span><span>', '</span><span style=color:#a3be8c>basic</span><span>');
</span><span>$</span><span style=color:#bf616a>ordering </span><span>= [$</span><span style=color:#bf616a>request</span><span>-></span><span style=color:#bf616a>input</span><span>('</span><span style=color:#a3be8c>order_by</span><span>'), $</span><span style=color:#bf616a>request</span><span>-></span><span style=color:#bf616a>input</span><span>('</span><span style=color:#a3be8c>direction</span><span>')];
</span><span>
</span><span>$</span><span style=color:#bf616a>query</span><span>-></span><span style=color:#bf616a>where</span><span>('</span><span style=color:#a3be8c>role</span><span>', $</span><span style=color:#bf616a>filter</span><span>)
</span><span>    -></span><span style=color:#bf616a>when</span><span>(
</span><span>        </span><span style=color:#bf616a>config</span><span>('</span><span style=color:#a3be8c>database.default</span><span>') === '</span><span style=color:#a3be8c>pgsql</span><span>',
</span><span>        </span><span style=color:#b48ead>function </span><span>($</span><span style=color:#bf616a>q</span><span>) </span><span style=color:#b48ead>use </span><span>($</span><span style=color:#bf616a>search</span><span>): </span><span style=color:#ebcb8b>void </span><span>{
</span><span>            </span><span style=color:#65737e>// use the function from the pg_trgm extension that adds special text search features
</span><span>            $</span><span style=color:#bf616a>q</span><span>-></span><span style=color:#bf616a>whereRaw</span><span>('</span><span style=color:#a3be8c>SIMILARITY("name"::text, ?) > 0.07</span><span>', [$</span><span style=color:#bf616a>search</span><span>]);
</span><span>        },
</span><span>        </span><span style=color:#b48ead>function </span><span>($</span><span style=color:#bf616a>q</span><span>) </span><span style=color:#b48ead>use </span><span>($</span><span style=color:#bf616a>search</span><span>): </span><span style=color:#ebcb8b>void </span><span>{
</span><span>            </span><span style=color:#65737e>// replace any spaces with the SQL wildcard `%` character
</span><span>            $</span><span style=color:#bf616a>likeReady </span><span>= </span><span style=color:#ebcb8b>Str</span><span>::</span><span style=color:#bf616a>of</span><span>($</span><span style=color:#bf616a>search</span><span>)-></span><span style=color:#bf616a>replace</span><span>(' ', '</span><span style=color:#a3be8c>%</span><span>')-></span><span style=color:#bf616a>append</span><span>('</span><span style=color:#a3be8c>%</span><span>')-></span><span style=color:#bf616a>prepend</span><span>('</span><span style=color:#a3be8c>%</span><span>');
</span><span>            $</span><span style=color:#bf616a>q</span><span>-></span><span style=color:#bf616a>where</span><span>('</span><span style=color:#a3be8c>name</span><span>', '</span><span style=color:#a3be8c>like</span><span>', $</span><span style=color:#bf616a>likeReady</span><span>);
</span><span>        }
</span><span>    )-></span><span style=color:#bf616a>when</span><span>(
</span><span>        </span><span style=color:#96b5b4>empty</span><span>($</span><span style=color:#bf616a>ordering</span><span>),
</span><span>        </span><span style=color:#b48ead>function </span><span>($</span><span style=color:#bf616a>q</span><span>): </span><span style=color:#ebcb8b>void </span><span>{
</span><span>            $</span><span style=color:#bf616a>q</span><span>-></span><span style=color:#bf616a>orderBy</span><span>('</span><span style=color:#a3be8c>name</span><span>');
</span><span>        },
</span><span>        </span><span style=color:#b48ead>function </span><span>($</span><span style=color:#bf616a>q</span><span>) </span><span style=color:#b48ead>use </span><span>($</span><span style=color:#bf616a>ordering</span><span>): </span><span style=color:#ebcb8b>void </span><span>{
</span><span>            $</span><span style=color:#bf616a>q</span><span>-></span><span style=color:#bf616a>orderBy</span><span>($</span><span style=color:#bf616a>ordering</span><span>[</span><span style=color:#d08770>0</span><span>], $</span><span style=color:#bf616a>ordering</span><span>[</span><span style=color:#d08770>1</span><span>]);
</span><span>        }
</span><span>    );
</span></code></pre><p>Hopefully this inspires you to find some code and wrap it up to be a little clearer or cleaner.</div><p><a title="Go Back Home" href=https://ohdoylerules.com>Go home</a><hr><div class="media grid"><div class=media-left><a class=post-author-link href=https://twitter.com/james2doyle target=_blank> <img alt="James Doyle Profile Picture" src="https://www.gravatar.com/avatar/b7375c88e1864c4ddf0d7bdab58e4cca?s=120&d=mm&r=g" height=120 width=120> </a></div><div class="media-body cell -9of12"><div class=media-heading><h3 itemprop="author publisher creator provider">James Doyle</h3></div><div class=media-content><p>I'm a full-stack developer, co-organizer of <a title="PHP Vancouver" href=https://www.meetup.com/vancouver-php target=_blank>PHP Vancouver</a> meetup, and winner of a <a title="Canadian Developer 30 under 30 award" href=http://www.canadianbusiness.com/innovation/developer-30-under-30-gallery/image/20/ target=_blank>Canadian Developer 30 under 30 award</a>. I'm a huge Open Source advocate and contributor to a lot of projects in my community. When I am not sitting at a computer, I'm trying to perfect some other skill.</div></div></div></article></div></div></main><script defer src=https://unpkg.com/swup@4.8.1/dist/Swup.umd.js></script><script>function handleGists(){const a=document.querySelectorAll('.iframes');[...a].forEach(function(b){b.onload=function(){b.style.height=b.contentWindow.document.body.scrollHeight+ 16+ 'px'};b.style.height=b.contentWindow.document.body.scrollHeight+ 16+ 'px'})}document.addEventListener('DOMContentLoaded',function(){handleGists();const a=new Swup({native:true});a.hooks.on('visit:end',handleGists,{priority:100})})</script>