<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Cache-control" content="public">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5">
  
    <title>James Doyle | Create JSON Sections In Shopify</title>
  
  <meta name="google-site-verification" content="KM-5h_iJ7JJsGeUp4ncEoYCBKft1ko1A4gBpjIzT0p4" />
  <link href="https://plus.google.com/109231487156400680487" rel="author publisher" />
  
  <meta itemprop="name" content="James Doyle">
  <meta property="og:site_name" content="ohdoylerules">
  <meta itemprop="url" content="https://ohdoylerules.com/web/create-json-sections-in-shopify/">
  <meta itemprop="email" content="james2doyle@gmail.com">
  <meta property="og:url" content="https://ohdoylerules.com/web/create-json-sections-in-shopify/">
  <meta itemprop="image logo" content="https://ohdoylerules.com/icons/logo.png">
  <meta property="og:image" content="https://ohdoylerules.com/icons/logo.png">
  <link rel="apple-touch-icon" sizes="57x57" href="https://ohdoylerules.com/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="https://ohdoylerules.com/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="https://ohdoylerules.com/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="https://ohdoylerules.com/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="https://ohdoylerules.com/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="https://ohdoylerules.com/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="https://ohdoylerules.com/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="https://ohdoylerules.com/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://ohdoylerules.com/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="https://ohdoylerules.com/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://ohdoylerules.com/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="https://ohdoylerules.com/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://ohdoylerules.com/icons/favicon-16x16.png">
  <link rel="manifest" href="https://ohdoylerules.com/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="https://ohdoylerules.com/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#333333">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@james2doyle">
  <meta name="twitter:title" content="Create JSON Sections In Shopify">
  <meta name="twitter:creator" content="@james2doyle">
  <meta name="twitter:image" content="https://ohdoylerules.com/icons/logo.png">
  <meta name="twitter:domain" content="https://ohdoylerules.com/">
  <link rel="icon" href="https://ohdoylerules.com/icons/logo.svg">
  
  
    <link rel="dns-prefetch" href="https://c.disquscdn.com">
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Create JSON Sections In Shopify">
    <meta property="article:author" content="James Doyle" />
    <meta property="article:section" content="Web" />
    <meta property="article:tag" content="shopify, theme, editor, builder, section, JSON, render, liquid" />
    <meta itemprop="keywords" content="shopify, theme, editor, builder, section, JSON, render, liquid">
    <meta property="og:keywords" content="shopify, theme, editor, builder, section, JSON, render, liquid">
    
    
      <meta name="description" content="A demo on how to create a section in Shopify that returns JSON and HTML">
      <meta itemprop="description" content="A demo on how to create a section in Shopify that returns JSON and HTML">
      <meta property="og:description" content="A demo on how to create a section in Shopify that returns JSON and HTML">
      <meta name="twitter:description" content="A demo on how to create a section in Shopify that returns JSON and HTML">
    
  
  <link rel="dns-prefetch" href="https://www.google-analytics.com">
  <link rel="shortcut icon" href="https://ohdoylerules.com/favicon.ico" />
  <link rel="canonical" href="https://ohdoylerules.com/web/create-json-sections-in-shopify/">
  <link rel="sitemap" type="application/xml" title="Sitemap" href="https://ohdoylerules.com/sitemap.xml" />
  <meta id="themes" name="themes" content="https://ohdoylerules.com/css/new.light.css,https://ohdoylerules.com/css/new.dark.css">
  <link id="stylesheet" rel="stylesheet" href="https://ohdoylerules.com/css/new.light.css">
  <style type="text/css">
    body {
      font-feature-settings: 'lnum' 1;
      font-variant-numeric: slashed-zero;
      text-rendering: geometricPrecision;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
      -webkit-text-size-adjust: 100%;
      -ms-text-size-adjust: 100%;
      opacity: 0;
      transition: opacity 0.2s ease;
      will-change: opacity;
    }
    body.light, body.dark {
      opacity: 1;
    }
    .show-on-light,
    .show-on-dark {
      display: none;
    }
    .light .show-on-light,
    .dark .show-on-dark {
      display: block;
    }
    .post-info {
      margin-bottom: 1rem;
    }
    a.none {
      color: inherit;
      border: none;
      opacity: 1;
    }
    a.none:hover {
      background: none;
      opacity: 0.6;
    }
    .center {
      text-align: center;
    }
    .center img {
      max-width: 100%;
      height: auto;
    }
    pre {
      color: #f8f8f2;
      background-color: #282a36;
      -moz-tab-size: 4;
      -o-tab-size: 4;
      tab-size: 4;
    }
    pre code.language-diff span:nth-child(1n + 7) {
      color: #50fa7b;
    }
    .switch-wrapper {
      display: flex;
      align-items: center;
      position: absolute;
      top: 1rem;
      right: 2rem;
      font-size: 80%;
    }
    .switch {
      position: relative;
      margin: 0 0.4rem;
    }
    .switch input {
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: 1;
      opacity: 0;
      cursor: pointer;
    }
    .switch label {
      display: flex;
      border-radius: 9999px;
      height: 0.8rem;
      width: 1.8rem;
      background-color: rgba(0, 0, 0, .1);
      border: 1px solid rgba(0, 0, 0, .3);
    }
    .switch input:checked + label {
      background-color: #357edd;
      border: 1px solid #357edd;
      justify-content: flex-end;
    }
    .switch div {
      width: calc(0.8rem - 2px);
      height: calc(0.8rem - 2px);
      border-radius: 9999px;
      border: 1px solid rgba(0, 0, 0, .3);
      background-color: #FFF;
    }
     
    body.dark table.highlight tr:nth-child(even) {
      background-color: rgb(246, 248, 250);
    }
    body.dark table.highlight td,
    body.dark table.highlight th {
      border-color: rgba(27,31,35,.3);
    }
  </style>
  <script type="text/javascript" charset="utf-8" defer>
    document.addEventListener('DOMContentLoaded', function() {
      
      const defaultIndex = window.matchMedia('(prefers-color-scheme)').media !== 'not all' ? '1' : '0';
      
      const activeIndex = JSON.parse(window.localStorage.getItem('activeIndex') || defaultIndex);

      const themes = document.getElementById('themes').content.split(',');
      const stylesheet = document.getElementById('stylesheet');
      if (stylesheet.href !== themes[activeIndex]) {
        stylesheet.href = themes[activeIndex];
      }

      document.body.className = activeIndex === 0 ? 'light' : 'dark';

      const theSwitch = document.getElementById('switch');
      theSwitch.checked = Boolean(activeIndex);
      theSwitch.addEventListener('change', function() {
        const newIndex = Number(this.checked);
        stylesheet.href = themes[newIndex];
        document.body.className = newIndex === 0 ? 'light' : 'dark';
        window.localStorage.setItem('activeIndex', newIndex);
      });
    });
  </script>
</head>
<body>
<div class="switch-wrapper">
  <div>Light</div>
  <div class="switch">
    <input id="switch" type="checkbox" style="display: none" />
    <label for="switch">
      <div></div>
    </label>
  </div>
  <div>Dark</div>
</div>

<div itemscope itemtype="http://schema.org/BlogPosting">
  <div class="container">
    <header class="grid -middle">
      <div class="cell menu">
        <h1 itemprop="name headline">Create JSON Sections In Shopify</h1>
      </div>
    </header>
    <p><a href="https://ohdoylerules.com/" title="Go Back Home">Go home</a></p>
    <div class="the-loop">
      <p class="post-info">
        
        <span class="post-date" itemprop="datePublished">üïí January 5, 2020</span>
        
        
        &nbsp;&nbsp;&nbsp;
        
        <span class="post-category" itemprop="genre about">üè∑ Web</span>
        
      </p>
      <div itemprop="ArticleBody text" class="main-content"><p>If you&rsquo;re like me, you&rsquo;re probably constantly running into issues with the flexibility of Shopify themes. There are a lot of issues that come up when trying to squeeze in features and functionality that are &ldquo;shop-adjacent&rdquo;. Shopify does a good job at running a store but it can be difficult to reach beyond that and make some more interactive experiences.</p>
<p>Recently, I wanted to share the content from one section on one page to another section on another page. This isn&rsquo;t really possible using liquid because you can&rsquo;t pass variables to sections. So even including them both on the same page wouldn&rsquo;t work. You also can&rsquo;t include sections in other sections. So that also won&rsquo;t work.</p>
<p>So how can you pass data between sections? Well, I managed to get this done by using the <a href="https://help.shopify.com/en/themes/development/sections/section-rendering-api">Section Rendering API</a>. Now, this is not something in liquid, but it can be used as a JS API. Specifically, you can render a section in isolation and without the surrounding page content.</p>
<p>Now, since you can call this API in JS, how would you use this content? You can just go ahead and use it as HTML, but I wanted to use it as JSON. How do we do that? How can we make sure the section works normally when rendered on a page but returns &ldquo;JSON&rdquo; when rendered through the section API?</p>
<p>Well, this is possible by taking advantage of the &ldquo;page state&rdquo; when being called via the API.</p>
<p>Here is an example of the if statement required:</p>
<pre><code class="language-liquid" data-lang="liquid">{% comment %}https://help.shopify.com/en/themes/development/sections/section-rendering-api{% endcomment %}
{% comment %}request.page_type will be &quot;index&quot; when using the section rendering API{% endcomment %}
{% comment %}content_for_header will contain the query string in the request{% endcomment %}
{%- if request.page_type == 'index' and content_for_header contains 'section_id' -%}
{
  {%- for block in section.blocks -%}
    {%- assign slug = block.settings.title | downcase -%}
    &quot;{{ slug }}&quot;: {{- block.settings | json -}}{%- unless forloop.last -%},{%- endunless -%}
  {%- endfor -%}
}
{%- else -%}
  {%- for block in section.blocks -%}
    {%- assign slug = block.settings.title | downcase -%}
    &lt;div id=&quot;{{ slug }}&quot;&gt;{{ block.settings.title }}&lt;/div&gt;
  {%- endfor -%}
{%- endif -%}
</code></pre><p>As you can see from the comment, <code>request.page_type</code> will be equal to <code>&quot;index&quot;</code> and <code>content_for_header</code> will contain <code>&quot;section_id&quot;</code> when rendered via the API. This means, we can use that state to return a string of JSON.</p>
<p>When this is returned from the section API, it will still be treated as HTML and wrapped with markup. It will look something like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#ff79c6">div</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;my-section-id&#34;</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;shopify-section&#34;</span>&gt;
{
  &#34;my-block-title&#34;: {&#34;title&#34;: &#34;My Block Title&#34;, &#34;subtitle&#34;: &#34;This is my subtitle&#34;},
  &#34;second-block-title&#34;: {&#34;title&#34;: &#34;Second Block Title&#34;, &#34;subtitle&#34;: &#34;This is my second subtitle&#34;}
}
&lt;/<span style="color:#ff79c6">div</span>&gt;
</code></pre></div><p>As you can tell, you can&rsquo;t just <code>JSON.parse</code> this. It has text inside that will bust up our JSON parser. How can we confidently parse the content inside the <code>div</code> and get that sweet schema in the center?</p>
<p>Let me introduce the <a href="https://developer.mozilla.org/en-US/docs/Web/API/DOMParser">DOMParser API</a>. This is a <a href="https://caniuse.com/#feat=xml-serializer">well-supported</a> API that will allow you to parse different types of structured documents.</p>
<p>In this case we are going to treat this content as <code>text/html</code> (which it is) and then use other DOM APIs to extract the JSON from the wrapper <code>div</code> surrounding it.</p>
<p>Here is the little function I came up with to fetch the rendered section, parse the content as HTML, extract the JSON inside, and return the object it contains.</p>
<p>See below:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#6272a4">/**
</span><span style="color:#6272a4"> * Get section from the rendering API
</span><span style="color:#6272a4"> * @see https://help.shopify.com/en/themes/development/sections/section-rendering-api
</span><span style="color:#6272a4"> *
</span><span style="color:#6272a4"> * @param {string} section
</span><span style="color:#6272a4"> *
</span><span style="color:#6272a4"> * @returns {Promise&lt;Object&gt;}
</span><span style="color:#6272a4"> */</span>
<span style="color:#ff79c6">async</span> <span style="color:#8be9fd;font-style:italic">function</span> getSection(section) {
  <span style="color:#ff79c6">try</span> {
    <span style="color:#6272a4">// call the rendering API
</span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">const</span> data <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">await</span> (<span style="color:#ff79c6">await</span> fetch(<span style="color:#f1fa8c">`/?section_id=</span><span style="color:#f1fa8c">${</span>section<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">`</span>)).text();
    <span style="color:#6272a4">// create a DOMParser and get the inside content of the section
</span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">const</span> parser <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> DOMParser();
    <span style="color:#ff79c6">const</span> node <span style="color:#ff79c6">=</span> parser.parseFromString(data.toString(), <span style="color:#f1fa8c">&#39;text/html&#39;</span>).querySelector(<span style="color:#f1fa8c">&#39;.shopify-section&#39;</span>);
    <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>node) {
      console.error(<span style="color:#f1fa8c">&#39;No node found in&#39;</span>, data);

      <span style="color:#ff79c6">return</span> {};
    }

    <span style="color:#ff79c6">const</span> content <span style="color:#ff79c6">=</span> (node.textContent <span style="color:#ff79c6">||</span> <span style="color:#f1fa8c">&#39;&#39;</span>).trim();

    <span style="color:#6272a4">// parse that content as JSON
</span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">return</span> JSON.parse(content);
  } <span style="color:#ff79c6">catch</span> (e) {
    console.error(e);
  }

  <span style="color:#ff79c6">return</span> {};
}
</code></pre></div><p>Nice, right? Pretty simple! We pass a string that represents the file name of the section we want to render, pass that to our DOMParser parse method, fetch the wrapper <code>div</code>, grab the text content inside, and pass that all to <code>JSON.parse</code>.</p>
<p>This seems strange <em>but it really works!</em> It works really really well!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#6272a4">// usage:
</span><span style="color:#6272a4"></span>getSection(<span style="color:#f1fa8c">&#39;name-of-section-template-file&#39;</span>)
.then((data) =&gt; {
  <span style="color:#6272a4">// do stuff with the object...
</span><span style="color:#6272a4"></span>});
</code></pre></div><p>That is how you use this function. Just pass in the filename of the section template (without the <code>.liquid</code> on the end) and you will get JSON back! The best part about this is that it still works with the normal HTML. So you can use this in both cases without any issues. This whole setup allows website admins to visually design JSON output for your more complex features.</p>
<p><em>Side Note</em></p>
<p>Shopify likes to change things up every once in a while. They recently <a href="https://developers.shopify.com/changelog/deprecating-the-include-liquid-tag-and-introducing-the-render-tag">deprecated the <code>include</code> tag in favour of a new <code>render</code> tag</a>. So there is no promise this will work forever.</p>
<p><em>You have been warned!</em></p>
</div>
      <p><a href="https://ohdoylerules.com/" title="Go Back Home">Go home</a></p>
      <hr>
      <div class="media grid">
        <div class="media-left">
          <a href="https://twitter.com/james2doyle" target="_blank" class="post-author-link">
            <img src="https://www.gravatar.com/avatar/b7375c88e1864c4ddf0d7bdab58e4cca?s=120&amp;d=mm&amp;r=g" alt="James Doyle Profile Picture" width="120" height="120">
          </a>
        </div>
        <div class="media-body cell -9of12">
          <div class="media-heading"><h3 itemprop="author publisher creator provider">James Doyle</h3></div>
          <div class="media-content">
            <p>I'm a full-stack developer, co-organizer of <a href="https://www.meetup.com/vancouver-php" title="PHP Vancouver" target="_blank">PHP Vancouver</a> meetup, and winner of a <a href="http://www.canadianbusiness.com/innovation/developer-30-under-30-gallery/image/20/" title="Canadian Developer 30 under 30 award" target="_blank">Canadian Developer 30 under 30 award</a>. I'm a huge Open Source advocate and contributor to a lot of projects in my community. When I am not sitting at a computer, I'm trying to perfect some other skill.</p>
          </div>
        </div>
      </div>
      <hr>
      
        <div id="disqus_thread" itemprop="comment"></div>
        <script type="text/javascript">(function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//ohdoylerules.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })();</script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      
    </div>
  </div>
</div>
<script defer>
  
  
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js?2021-02-06');
  }
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-30413344-2']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'https://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
  
</script>
</body>
</html>

