<!doctype html><html lang=en><head><meta charset=utf-8><meta content=public http-equiv=Cache-control><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1,maximum-scale=5" name=viewport><title>Create JSON Sections In Shopify | OhDoyleRules</title><meta content="Create JSON Sections In Shopify | OhDoyleRules" name=twitter:title><meta content=KM-5h_iJ7JJsGeUp4ncEoYCBKft1ko1A4gBpjIzT0p4 name=google-site-verification><meta content="Create JSON Sections In Shopify" itemprop=name><meta content=OhDoyleRules property=og:site_name><meta content=https://ohdoylerules.com/web/create-json-sections-in-shopify/ itemprop=url><meta content=james2doyle@gmail.com itemprop=email><meta content=https://ohdoylerules.com/web/create-json-sections-in-shopify/ property=og:url><meta itemprop="image logo" content=/icons/logo.png><meta content=/icons/logo.png property=og:image><link href=/icons/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/icons/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/icons/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=/site.webmanifest rel=manifest><link color=#333333 href=/icons/safari-pinned-tab.svg rel=mask-icon><link href=/icons/favicon.ico rel=icon sizes=any><link href=/icons/favicon.svg rel=icon type=image/svg+xml><meta content=/browserconfig.xml name=msapplication-config><meta content=#ffffff name=msapplication-TileColor><meta content=#ffffff name=theme-color><meta content=summary name=twitter:card><meta content=@james2doyle name=twitter:site><meta content="Create JSON Sections In Shopify" name=twitter:title><meta content=@james2doyle name=twitter:creator><meta content=/icons/logo.png name=twitter:image><meta content=/ name=twitter:domain><link href=/icons/logo.svg rel=icon><meta content="A demo on how to create a section in Shopify that returns JSON and HTML" name=description><meta content="A demo on how to create a section in Shopify that returns JSON and HTML" itemprop=description><meta content="A demo on how to create a section in Shopify that returns JSON and HTML" property=og:description><meta content="A demo on how to create a section in Shopify that returns JSON and HTML" name=twitter:description><meta content=article property=og:type><meta content="Create JSON Sections In Shopify | OhDoyleRules" property=og:title><meta content="james2doyle@gmail.com James Doyle" property=article:author><meta content="shopify, theme, editor, builder, section, JSON, render, liquid" itemprop=keywords><meta content="shopify, theme, editor, builder, section, JSON, render, liquid" property=article:tag><meta content="shopify, theme, editor, builder, section, JSON, render, liquid" property=og:keywords><link href=https://www.google-analytics.com rel=dns-prefetch><link rel="shortcut icon" href=/favicon.ico><link href=https://ohdoylerules.com/web/create-json-sections-in-shopify/ rel=canonical><link href=https://ohdoylerules.com/atom.xml rel=alternate title=atom type=application/atom+xml><style>:root{--b-font-main:system-ui,sans-serif;--b-font-mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;--b-txt:#dcd7ba;--b-bg-1:#18171f;--b-bg-2:#2d4f67;--b-line:#727169;--b-link:#7fb4ca;--b-btn-bg:#2d4f67;--b-btn-txt:#c8c093;--b-focus:#2d4f67;--b-accent-1:#e6c384;--b-accent-2:#c34043;--b-selection-color:#c8c093;--b-selection-bg:#2d4f67}*,:before,:after{box-sizing:border-box}::selection{color:var(--b-selection-color);background-color:var(--b-selection-bg)}html:focus-within{scroll-behavior:smooth}body{background:var(--b-bg-1);font-family:var(--b-font-main);font-feature-settings:"lnum" 1;font-variant-numeric:slashed-zero;text-rendering:geometricprecision;color:var(--b-txt);-moz-tab-size:4;tab-size:4;word-break:break-word;overflow-wrap:break-word;-webkit-tap-highlight-color:#0000;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;max-width:70ch;margin:auto;padding:0 1rem;line-height:1.5}h1,h2,h3,h4,h5,h6,p,ul,ol,dl,dd,details,blockquote,pre,figure,table,address,hr,fieldset,iframe,audio,video{margin:0 0 1.5rem}h1,h2,h3,h4,h5,h6{text-wrap:balance;margin-top:2rem;line-height:1.25}h1{font-size:2rem}h2{font-size:1.5rem}h3{font-size:1.25rem}h4{font-size:1rem}h5{font-size:.875rem}h6{font-size:.75rem}a{color:var(--b-link);text-decoration:none}a:hover{text-decoration:underline}img,video,svg{max-width:100%;height:auto}embed,iframe,object{max-width:100%}iframe{border-style:none;width:100%;height:100%}abbr[title]{text-decoration:underline dotted}b,strong{font-weight:700}blockquote{margin-trim:block;border-left:.25rem solid var(--b-accent-2);margin-left:0;padding:.5rem 0 .5rem 1.5rem}blockquote p{margin-bottom:0}small{font-size:.875rem}sub,sup{vertical-align:baseline;font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}hr{border:0;border-bottom:1px solid var(--b-line);height:0}mark{background:var(--b-bg-2);color:var(--b-txt);border-radius:.25rem;padding:.125rem .25rem}pre,code,kbd,samp,tt,var{background:var(--b-bg-2);font-family:var(--b-font-mono);border-radius:.25rem;padding:.125rem .25rem;font-size:.875em}pre{white-space:pre;padding:1rem;overflow:auto}pre code{background-color:inherit;padding:0}p code{background-color:var(--b-bg-2);color:var(--b-accent-1)}details{background:var(--b-bg-2);border:1px solid var(--b-line);margin-trim:block;border-radius:.25rem;padding:.5rem 1rem;display:block}details[open]>summary{margin-bottom:1.5rem}summary{cursor:pointer;font-weight:700;display:list-item}summary:focus{box-shadow:none}table{border-collapse:collapse;text-indent:0;width:100%}table caption{margin-bottom:.5rem}tr{border-bottom:1px solid var(--b-line)}td,th{word-break:normal;padding:.5rem 0 .5rem 1rem}td:first-child,th:first-child{padding-left:0}th{text-align:left}ul,ol,dd{padding-left:2rem}li>ul,li>ol{margin-bottom:0}fieldset{border:1px solid var(--b-line);border-radius:.25rem;padding:.5rem .75rem}legend{padding:0 .25rem}label{cursor:pointer;margin-bottom:.25rem;display:block}button,input,select,textarea{background:var(--b-bg-2);font:inherit;color:var(--b-txt);border:0;border-radius:.25rem;max-width:100%;margin:0;padding:.5rem .75rem;line-height:1.125}button,select{text-transform:none}select,[type=date],[type=datetime-local],[type=datetime],[type=email],[type=month],[type=number],[type=password],[type=search],[type=tel],[type=text],[type=time],[type=url],[type=week]{width:100%}[type=image],[type=checkbox],[type=radio]{cursor:pointer}[type=color]{min-height:2.125rem}select:not([multiple]):not([size]){-webkit-appearance:none;-moz-appearance:none;appearance:none;background-position:right .5rem center;background-repeat:no-repeat;padding-right:1.5rem}textarea{resize:vertical;width:100%}textarea:not([rows]){height:8rem}button{touch-action:manipulation}button,[type=button],[type=submit],[type=reset]{-webkit-appearance:button;text-align:center;white-space:nowrap;background:var(--b-btn-bg);color:var(--b-btn-txt);cursor:pointer;border:0;transition:opacity .25s;display:inline-block}button:hover,[type=button]:hover,[type=submit]:hover,[type=reset]:hover{opacity:.75}button[disabled],[type=button][disabled],[type=submit][disabled],[type=reset][disabled]{opacity:.5}progress{vertical-align:baseline}[type=search]{-webkit-appearance:none;outline-offset:-2px}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}::-webkit-input-placeholder{color:inherit;opacity:.5}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}::-moz-focus-inner{border-style:none;padding:0}:-moz-focusring{outline:1px dotted buttontext}:-moz-ui-invalid{box-shadow:none}[aria-busy=true]{cursor:progress}[aria-disabled=true],[disabled]{cursor:not-allowed}:focus,details:focus-within{box-shadow:0 0 0 2px var(--b-focus);outline:none}@media (prefers-reduced-motion:reduce){html:focus-within{scroll-behavior:auto}*,:before,:after{background-attachment:initial!important;scroll-behavior:auto!important;transition-delay:0!important;transition-duration:0!important;animation-duration:1ms!important;animation-iteration-count:1!important;animation-delay:-1ms!important}}select:not([multiple]):not([size]){background-image:url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23eceff4'%3E%3Cpath d='M5 6l5 5 5-5 2 1-7 7-7-7 2-1z'/%3E%3C/svg%3E")}.post-info{margin-bottom:1rem}a.none{color:inherit;opacity:1;border:none}a.none:hover{opacity:.6;background:0 0}.center{text-align:center}html.is-changing .transition-fade{view-transition-name:main}::view-transition-old(main){animation:.25s ease-in-out both fade}::view-transition-new(main){animation:.25s ease-in-out reverse both fade}@keyframes fade{0%{opacity:1}to{opacity:0}}html.is-changing:not(.swup-native) .transition-fade{will-change:opacity;opacity:1;transition:opacity .25s}html.is-animating:not(.swup-native) .transition-fade{opacity:0}.render-later{content-visibility:auto;contain-intrinsic-size:auto 166px}</style><style>.center img{max-width:100%;height:auto}pre code.language-diff span:nth-child(n+7){color:#50fa7b}iframe{border:0;min-height:300px;margin:0}.gist-iframe{filter:invert()hue-rotate(180deg)brightness();background-color:#fff}body table.highlight tr:nth-child(2n){background-color:#f6f8fa}body table.highlight td,body table.highlight th{border-color:#1b1f234d}</style><body><main class=transition-fade id=swup><header class=center><h1 itemprop="name headline">Create JSON Sections In Shopify</h1></header><hr><div itemscope itemtype=http://schema.org/BlogPosting><div><p><a title="Go Back Home" href=https://ohdoylerules.com>Go home</a><article><section class=post-info><span itemprop=datePublished> ðŸ•’Â Â  <time datetime=2020-01-05T00:00:00>January 05, 2020</time> </span></section><div itemprop="ArticleBody text" class=main-content><p>If you're like me, you're probably constantly running into issues with the flexibility of Shopify themes. There are a lot of issues that come up when trying to squeeze in features and functionality that are "shop-adjacent". Shopify does a good job at running a store but it can be difficult to reach beyond that and make some more interactive experiences.<p>Recently, I wanted to share the content from one section on one page to another section on another page. This isn't really possible using liquid because you can't pass variables to sections. So even including them both on the same page wouldn't work. You also can't include sections in other sections. So that also won't work.<p>So how can you pass data between sections? Well, I managed to get this done by using the <a rel="noopener nofollow noreferrer" href=https://help.shopify.com/en/themes/development/sections/section-rendering-api target=_blank>Section Rendering API</a>. Now, this is not something in liquid, but it can be used as a JS API. Specifically, you can render a section in isolation and without the surrounding page content.<p>Now, since you can call this API in JS, how would you use this content? You can just go ahead and use it as HTML, but I wanted to use it as JSON. How do we do that? How can we make sure the section works normally when rendered on a page but returns "JSON" when rendered through the section API?<p>Well, this is possible by taking advantage of the "page state" when being called via the API.<p>Here is an example of the if statement required:<pre class=language-jinja2 data-lang=jinja2 style=color:#c0c5ce;background-color:#2b303b><code class=language-jinja2 data-lang=jinja2><span>{% </span><span style=color:#b48ead>comment </span><span>%}https://help.shopify.com/en/themes/development/sections/section-rendering-api{% </span><span style=color:#b48ead>endcomment </span><span>%}
</span><span>{% </span><span style=color:#b48ead>comment </span><span>%}request.page_type will be "index" when using the section rendering API{% </span><span style=color:#b48ead>endcomment </span><span>%}
</span><span>{% </span><span style=color:#b48ead>comment </span><span>%}content_for_header will contain the query string in the request{% </span><span style=color:#b48ead>endcomment </span><span>%}
</span><span>{%- </span><span style=color:#b48ead>if </span><span style=color:#bf616a>request</span><span>.</span><span style=color:#bf616a>page_type </span><span>== '</span><span style=color:#a3be8c>index</span><span>' </span><span style=color:#b48ead>and </span><span style=color:#bf616a>content_for_header contains </span><span>'</span><span style=color:#a3be8c>section_id</span><span>' -%}
</span><span>{
</span><span>  {%- </span><span style=color:#b48ead>for block </span><span style=color:#bf616a>in section</span><span>.</span><span style=color:#bf616a>blocks </span><span>-%}
</span><span>    {%- </span><span style=color:#b48ead>assign </span><span style=color:#bf616a>slug </span><span>= </span><span style=color:#bf616a>block</span><span>.</span><span style=color:#bf616a>settings</span><span>.</span><span style=color:#bf616a>title </span><span>| </span><span style=color:#bf616a>downcase </span><span>-%}
</span><span>    "{{ </span><span style=color:#bf616a>slug </span><span>}}": {{- </span><span style=color:#bf616a>block</span><span>.</span><span style=color:#bf616a>settings </span><span>| </span><span style=color:#bf616a>json </span><span>-}}{%- </span><span style=color:#b48ead>unless </span><span style=color:#bf616a>forloop</span><span>.</span><span style=color:#bf616a>last </span><span>-%},{%- </span><span style=color:#b48ead>endunless </span><span>-%}
</span><span>  {%- </span><span style=color:#b48ead>endfor </span><span>-%}
</span><span>}
</span><span>{%- </span><span style=color:#b48ead>else </span><span>-%}
</span><span>  {%- </span><span style=color:#b48ead>for block </span><span style=color:#bf616a>in section</span><span>.</span><span style=color:#bf616a>blocks </span><span>-%}
</span><span>    {%- </span><span style=color:#b48ead>assign </span><span style=color:#bf616a>slug </span><span>= </span><span style=color:#bf616a>block</span><span>.</span><span style=color:#bf616a>settings</span><span>.</span><span style=color:#bf616a>title </span><span>| </span><span style=color:#bf616a>downcase </span><span>-%}
</span><span>    &LTdiv id="{{ </span><span style=color:#bf616a>slug </span><span>}}">{{ </span><span style=color:#bf616a>block</span><span>.</span><span style=color:#bf616a>settings</span><span>.</span><span style=color:#bf616a>title </span><span>}}&LT/div>
</span><span>  {%- </span><span style=color:#b48ead>endfor </span><span>-%}
</span><span>{%- </span><span style=color:#b48ead>endif </span><span>-%}
</span></code></pre><p>As you can see from the comment, <code>request.page_type</code> will be equal to <code>"index"</code> and <code>content_for_header</code> will contain <code>"section_id"</code> when rendered via the API. This means, we can use that state to return a string of JSON.<p>When this is returned from the section API, it will still be treated as HTML and wrapped with markup. It will look something like this:<pre class=language-html data-lang=html style=color:#c0c5ce;background-color:#2b303b><code class=language-html data-lang=html><span><</span><span style=color:#bf616a>div </span><span style=color:#8fa1b3>id</span><span>="</span><span style=color:#a3be8c>my-section-id</span><span>" </span><span style=color:#d08770>class</span><span>="</span><span style=color:#a3be8c>shopify-section</span><span>">
</span><span>{
</span><span>  "my-block-title": {"title": "My Block Title", "subtitle": "This is my subtitle"},
</span><span>  "second-block-title": {"title": "Second Block Title", "subtitle": "This is my second subtitle"}
</span><span>}
</span><span>&LT/</span><span style=color:#bf616a>div</span><span>>
</span></code></pre><p>As you can tell, you can't just <code>JSON.parse</code> this. It has text inside that will bust up our JSON parser. How can we confidently parse the content inside the <code>div</code> and get that sweet schema in the center?<p>Let me introduce the <a rel="noopener nofollow noreferrer" href=https://developer.mozilla.org/en-US/docs/Web/API/DOMParser target=_blank>DOMParser API</a>. This is a <a href="https://caniuse.com/#feat=xml-serializer" rel="noopener nofollow noreferrer" target=_blank>well-supported</a> API that will allow you to parse different types of structured documents.<p>In this case we are going to treat this content as <code>text/html</code> (which it is) and then use other DOM APIs to extract the JSON from the wrapper <code>div</code> surrounding it.<p>Here is the little function I came up with to fetch the rendered section, parse the content as HTML, extract the JSON inside, and return the object it contains.<p>See below:<pre class=language-js data-lang=js style=color:#c0c5ce;background-color:#2b303b><code class=language-js data-lang=js><span style=color:#65737e>/**
</span><span style=color:#65737e> * Get section from the rendering API
</span><span style=color:#65737e> * </span><span style=color:#b48ead>@see </span><span style=color:#bf616a>https://help.shopify.com/en/themes/development/sections/section-rendering-api
</span><span style=color:#65737e> *
</span><span style=color:#65737e> * </span><span style=color:#b48ead>@param </span><span style=color:#65737e>{string} </span><span style=color:#bf616a>section
</span><span style=color:#65737e> *
</span><span style=color:#65737e> * </span><span style=color:#b48ead>@returns </span><span style=color:#65737e>{Promise&LTObject>}
</span><span style=color:#65737e> */
</span><span style=color:#b48ead>async function </span><span style=color:#8fa1b3>getSection</span><span>(</span><span style=color:#bf616a>section</span><span>) {
</span><span>  </span><span style=color:#b48ead>try </span><span>{
</span><span>    </span><span style=color:#65737e>// call the rendering API
</span><span>    </span><span style=color:#b48ead>const </span><span style=color:#bf616a>data </span><span>= </span><span style=color:#b48ead>await </span><span>(</span><span style=color:#b48ead>await </span><span style=color:#8fa1b3>fetch</span><span>(`</span><span style=color:#a3be8c>/?section_id=${</span><span style=color:#bf616a>section</span><span style=color:#a3be8c>}</span><span>`)).</span><span style=color:#8fa1b3>text</span><span>();
</span><span>    </span><span style=color:#65737e>// create a DOMParser and get the inside content of the section
</span><span>    </span><span style=color:#b48ead>const </span><span style=color:#bf616a>parser </span><span>= new DOMParser();
</span><span>    </span><span style=color:#b48ead>const </span><span style=color:#bf616a>node </span><span>= </span><span style=color:#bf616a>parser</span><span>.</span><span style=color:#8fa1b3>parseFromString</span><span>(</span><span style=color:#bf616a>data</span><span>.</span><span style=color:#96b5b4>toString</span><span>(), '</span><span style=color:#a3be8c>text/html</span><span>').</span><span style=color:#96b5b4>querySelector</span><span>('</span><span style=color:#a3be8c>.shopify-section</span><span>');
</span><span>    </span><span style=color:#b48ead>if </span><span>(!</span><span style=color:#bf616a>node</span><span>) {
</span><span>      </span><span style=color:#ebcb8b>console</span><span>.</span><span style=color:#96b5b4>error</span><span>('</span><span style=color:#a3be8c>No node found in</span><span>', </span><span style=color:#bf616a>data</span><span>);
</span><span>
</span><span>      </span><span style=color:#b48ead>return </span><span>{};
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#b48ead>const </span><span style=color:#bf616a>content </span><span>= (</span><span style=color:#bf616a>node</span><span>.</span><span style=color:#bf616a>textContent </span><span>|| '').</span><span style=color:#8fa1b3>trim</span><span>();
</span><span>
</span><span>    </span><span style=color:#65737e>// parse that content as JSON
</span><span>    </span><span style=color:#b48ead>return </span><span>JSON.</span><span style=color:#96b5b4>parse</span><span>(</span><span style=color:#bf616a>content</span><span>);
</span><span>  } </span><span style=color:#b48ead>catch </span><span>(</span><span style=color:#bf616a>e</span><span>) {
</span><span>    </span><span style=color:#ebcb8b>console</span><span>.</span><span style=color:#96b5b4>error</span><span>(</span><span style=color:#bf616a>e</span><span>);
</span><span>  }
</span><span>
</span><span>  </span><span style=color:#b48ead>return </span><span>{};
</span><span>}
</span></code></pre><p>Nice, right? Pretty simple! We pass a string that represents the file name of the section we want to render, pass that to our DOMParser parse method, fetch the wrapper <code>div</code>, grab the text content inside, and pass that all to <code>JSON.parse</code>.<p>This seems strange <em>but it really works!</em> It works really really well!<pre class=language-js data-lang=js style=color:#c0c5ce;background-color:#2b303b><code class=language-js data-lang=js><span style=color:#65737e>// usage:
</span><span style=color:#8fa1b3>getSection</span><span>('</span><span style=color:#a3be8c>name-of-section-template-file</span><span>')
</span><span>.</span><span style=color:#96b5b4>then</span><span>((</span><span style=color:#bf616a>data</span><span>) </span><span style=color:#b48ead>=> </span><span>{
</span><span>  </span><span style=color:#65737e>// do stuff with the object...
</span><span>});
</span></code></pre><p>That is how you use this function. Just pass in the filename of the section template (without the <code>.liquid</code> on the end) and you will get JSON back! The best part about this is that it still works with the normal HTML. So you can use this in both cases without any issues. This whole setup allows website admins to visually design JSON output for your more complex features.<p><em>Side Note</em><p>Shopify likes to change things up every once in a while. They recently <a rel="noopener nofollow noreferrer" href=https://developers.shopify.com/changelog/deprecating-the-include-liquid-tag-and-introducing-the-render-tag target=_blank>deprecated the <code>include</code> tag in favour of a new <code>render</code> tag</a>. So there is no promise this will work forever.<p><em>You have been warned!</em></div><p><a title="Go Back Home" href=https://ohdoylerules.com>Go home</a><hr><div class="media grid"><div class=media-left><a class=post-author-link href=https://twitter.com/james2doyle target=_blank> <img alt="James Doyle Profile Picture" src="https://www.gravatar.com/avatar/b7375c88e1864c4ddf0d7bdab58e4cca?s=120&d=mm&r=g" height=120 width=120> </a></div><div class="media-body cell -9of12"><div class=media-heading><h3 itemprop="author publisher creator provider">James Doyle</h3></div><div class=media-content><p>I'm a full-stack developer, co-organizer of <a title="PHP Vancouver" href=https://www.meetup.com/vancouver-php target=_blank>PHP Vancouver</a> meetup, and winner of a <a title="Canadian Developer 30 under 30 award" href=http://www.canadianbusiness.com/innovation/developer-30-under-30-gallery/image/20/ target=_blank>Canadian Developer 30 under 30 award</a>. I'm a huge Open Source advocate and contributor to a lot of projects in my community. When I am not sitting at a computer, I'm trying to perfect some other skill.</div></div></div></article></div></div></main><script defer src=https://unpkg.com/swup@4.8.1/dist/Swup.umd.js></script><script>var handleGists=(()=>{let b=16,c=`px`;const a=document.querySelectorAll(`.iframes`);[...a].forEach((a=>{a.onload=(()=>{a.style.height=a.contentWindow.document.body.scrollHeight+ b+ c});a.style.height=a.contentWindow.document.body.scrollHeight+ b+ c}))});document.addEventListener(`DOMContentLoaded`,(()=>{handleGists();const a=new Swup({native:!0});a.hooks.on(`visit:end`,handleGists,{priority:100})}))</script>