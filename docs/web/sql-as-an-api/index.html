<!doctype html><html lang=en><head><meta charset=utf-8><meta content=public http-equiv=Cache-control><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1,maximum-scale=5" name=viewport><title>SQL As An API | OhDoyleRules</title><meta content="SQL As An API | OhDoyleRules" name=twitter:title><meta content=KM-5h_iJ7JJsGeUp4ncEoYCBKft1ko1A4gBpjIzT0p4 name=google-site-verification><meta content="SQL As An API" itemprop=name><meta content=OhDoyleRules property=og:site_name><meta content=https://ohdoylerules.com/web/sql-as-an-api/ itemprop=url><meta content=james2doyle@gmail.com itemprop=email><meta content=https://ohdoylerules.com/web/sql-as-an-api/ property=og:url><meta itemprop="image logo" content=/icons/logo.png><meta content=/icons/logo.png property=og:image><link href=/icons/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/icons/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/icons/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=/site.webmanifest rel=manifest><link color=#333333 href=/icons/safari-pinned-tab.svg rel=mask-icon><link href=/icons/favicon.ico rel=icon sizes=any><link href=/icons/favicon.svg rel=icon type=image/svg+xml><meta content=/browserconfig.xml name=msapplication-config><meta content=#ffffff name=msapplication-TileColor><meta content=#ffffff name=theme-color><meta content=summary name=twitter:card><meta content=@james2doyle name=twitter:site><meta content="SQL As An API" name=twitter:title><meta content=@james2doyle name=twitter:creator><meta content=/icons/logo.png name=twitter:image><meta content=/ name=twitter:domain><link href=/icons/logo.svg rel=icon><meta content="An example of how to use SQL as an API instead of reaching for something like GraphQL" name=description><meta content="An example of how to use SQL as an API instead of reaching for something like GraphQL" itemprop=description><meta content="An example of how to use SQL as an API instead of reaching for something like GraphQL" property=og:description><meta content="An example of how to use SQL as an API instead of reaching for something like GraphQL" name=twitter:description><link href=https://c.disquscdn.com rel=dns-prefetch><meta content=article property=og:type><meta content="SQL As An API | OhDoyleRules" property=og:title><meta content="james2doyle@gmail.com James Doyle" property=article:author><meta content="sql, graphql, api, sqlite, json, query, php" itemprop=keywords><meta content="sql, graphql, api, sqlite, json, query, php" property=article:tag><meta content="sql, graphql, api, sqlite, json, query, php" property=og:keywords><link href=https://www.google-analytics.com rel=dns-prefetch><link rel="shortcut icon" href=/favicon.ico><link href=https://ohdoylerules.com/web/sql-as-an-api/ rel=canonical><link href=https://ohdoylerules.com/atom.xml rel=alternate title=atom type=application/atom+xml><style>body{font-feature-settings:'lnum' 1;font-variant-numeric:slashed-zero;text-rendering:geometricPrecision;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}.post-info{margin-bottom:1rem}a.none{color:inherit;border:none;opacity:1}a.none:hover {background:none;opacity:.6}.center{text-align:center}.center img{max-width:100%;height:auto}pre{color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4}pre code.language-diff span:nth-child(1n + 7){color:#50fa7b}body.dark table.highlight tr:nth-child(even){background-color:#f6f8fa}body.dark table.highlight td,body.dark table.highlight th{border-color:rgba(27,31,35,.3)}html.is-changing .transition-fade{view-transition-name:main}:view-transition-old(main){animation:fade .25s ease-in-out both}:view-transition-new(main){animation:fade .25s ease-in-out both reverse}@keyframes fade{from{opacity:1}to{opacity:0}}html.is-changing:not(.swup-native) .transition-fade {will-change:opacity;transition:.25s opacity;opacity:1}html.is-animating:not(.swup-native) .transition-fade {opacity:0}:root{--nc-font-sans:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,'Open Sans','Helvetica Neue',sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--nc-font-mono:Consolas,monaco,'Ubuntu Mono','Liberation Mono','Courier New',Courier,monospace;--nc-tx-1:#fff;--nc-tx-2:#eee;--nc-bg-1:#000;--nc-bg-2:#111;--nc-bg-3:#222;--nc-lk-1:#3291ff;--nc-lk-2:#0070f3;--nc-lk-tx:#fff;--nc-ac-1:#7928ca;--nc-ac-tx:#fff}@media (prefers-color-scheme:dark){:root{--nc-tx-1:#fff;--nc-tx-2:#eee;--nc-bg-1:#000;--nc-bg-2:#111;--nc-bg-3:#222;--nc-lk-1:#3291ff;--nc-lk-2:#0070f3;--nc-lk-tx:#fff;--nc-ac-1:#7928ca;--nc-ac-tx:#fff}}*{margin:0;padding:0}address,area,article,aside,audio,blockquote,datalist,details,dl,fieldset,figure,form,iframe,img,input,meter,nav,ol,optgroup,option,output,p,pre,progress,ruby,section,table,textarea,ul,video{margin-bottom:1rem}button,html,input,select{font-family:var(--nc-font-sans)}body{margin:0 auto;max-width:750px;padding:2rem;border-radius:6px;overflow-x:hidden;word-break:break-word;overflow-wrap:break-word;background:var(--nc-bg-1);color:var(--nc-tx-2);font-size:1.03rem;line-height:1.5}:selection{background:var(--nc-ac-1);color:var(--nc-ac-tx)}h1,h2,h3,h4,h5,h6{line-height:1;color:var(--nc-tx-1);padding-top:.875rem}h1,h2,h3{color:var(--nc-tx-1);padding-bottom:2px;margin-bottom:8px;border-bottom:1px solid var(--nc-bg-2)}h4,h5,h6{margin-bottom:.3rem}h1{font-size:2.25rem}h2{font-size:1.85rem}h3{font-size:1.55rem}h4{font-size:1.25rem}h5{font-size:1rem}h6{font-size:.875rem}a{color:var(--nc-lk-1)}a:hover{color:var(--nc-lk-2)}abbr:hover{cursor:help}blockquote{padding:1.5rem;background:var(--nc-bg-2);border-left:5px solid var(--nc-bg-3)}abbr{cursor:help}blockquote:last-child{padding-bottom:0;margin-bottom:0}header{background:var(--nc-bg-2);border-bottom:1px solid var(--nc-bg-3);padding:2rem 1.5rem;margin:-2rem calc(0px - (50vw - 50%)) 2rem;padding-left:calc(50vw - 50%);padding-right:calc(50vw - 50%)}header h1,header h2,header h3{padding-bottom:0;border-bottom:0}header>:first-child{margin-top:0;padding-top:0}header>:last-child{margin-bottom:0}a button,button,input[type=button],input[type=reset],input[type=submit]{font-size:1rem;display:inline-block;padding:6px 12px;text-align:center;text-decoration:none;white-space:nowrap;background:var(--nc-lk-1);color:var(--nc-lk-tx);border:0;border-radius:4px;box-sizing:border-box;cursor:pointer}a button[disabled],button[disabled],input[type=button][disabled],input[type=reset][disabled],input[type=submit][disabled]{cursor:not-allowed;opacity:.5}.button:focus,.button:hover,button:focus,button:hover,input[type=button]:focus,input[type=button]:hover,input[type=reset]:focus,input[type=reset]:hover,input[type=submit]:focus,input[type=submit]:hover{background:var(--nc-lk-2)}code,kbd,pre,samp{font-family:var(--nc-font-mono)}code,kbd,pre,samp{background:var(--nc-bg-2);border:1px solid var(--nc-bg-3);border-radius:4px;padding:3px 6px;font-size:.9rem}kbd{border-bottom:3px solid var(--nc-bg-3)}pre{padding:1rem 1.4rem;max-width:100%;overflow:auto}pre code{background:inherit;font-size:inherit;color:inherit;border:0;padding:0;margin:0}code pre{display:inline;background:inherit;font-size:inherit;color:inherit;border:0;padding:0;margin:0}details{padding:.6rem 1rem;background:var(--nc-bg-2);border:1px solid var(--nc-bg-3);border-radius:4px}summary{cursor:pointer;font-weight:700}details[open]{padding-bottom:.75rem}details[open] summary{margin-bottom:6px}details[open]>:last-child{margin-bottom:0}dt{font-weight:700}dd:before{content:'â†’ '}hr{border:0;border-bottom:1px solid var(--nc-bg-3);margin:1rem auto}fieldset{margin-top:1rem;padding:2rem;border:1px solid var(--nc-bg-3);border-radius:4px}legend{padding:auto .5rem}table{border-collapse:collapse;width:100%}td,th{border:1px solid var(--nc-bg-3);text-align:left;padding:.5rem}th{background:var(--nc-bg-2)}tr:nth-child(even){background:var(--nc-bg-2)}table caption{font-weight:700;margin-bottom:.5rem}textarea{max-width:100%}ol,ul{padding-left:2rem}li{margin-top:.4rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}mark{padding:3px 6px;background:var(--nc-ac-1);color:var(--nc-ac-tx)}input,select,textarea{padding:6px 12px;margin-bottom:.5rem;background:var(--nc-bg-2);color:var(--nc-tx-2);border:1px solid var(--nc-bg-3);border-radius:4px;box-shadow:none;box-sizing:border-box}img{max-width:100%}iframe{border:0;width:100%;height:100%;min-height:300px}</style><style media=screen>body .gist table.highlight tr:nth-child(even){background-color:inherit}.gist{font-size:18px}.clone-url-button > .clone-url-link,.gist-file,.gist-meta,.octotree_toggle,a.button,a.minibutton,button.button,button.minibutton,span.button,span.minibutton,ul.comparison-list > li.title{background:linear-gradient(#202020,#181818)!important;border-color:#383838!important;border-radius:0 0 3px 3px!important;text-shadow:none!important;color:#b5b5b5!important}#facebox pre,#notebook .input_area,.CodeMirror,.api code,.api pre,.blob-code-context,.blob-expanded,.copyable-terminal,.highlight,.markdown-body .highlight pre,.markdown-body pre,.markdown-format .highlight pre,.markdown-format code,.markdown-format pre,.terminal,body.blog pre,body.blog pre > code{background-color:#1d1f21!important;color:#c5c8c6!important}.gist .blob-code{padding:1px 10px!important;text-align:left;background:#000;border:0}:selection{background:#24890d;color:#fff;text-shadow:none}:-moz-selection{background:#24890d;color:#fff;text-shadow:none}.blob-num{padding:10px 8px 9px;text-align:right;color:#6b6b6b!important;border:0}.blob-code,.blob-code-inner{color:#c5c8c6!important}.pl-c,.pl-c span{color:#969896!important;font-style:italic!important}.pl-c1{color:#de935f!important}.pl-cce{color:#de935f!important}.pl-cn{color:#de935f!important}.pl-coc{color:#de935f!important}.pl-cos{color:#b5bd68!important}.pl-e{color:#f0c674!important}.pl-ef{color:#f0c674!important}.pl-en{color:#f0c674!important}.pl-enc{color:#de935f!important}.pl-enf{color:#f0c674!important}.pl-enm{color:#f0c674!important}.pl-ens{color:#de935f!important}.pl-ent{color:#b294bb!important}.pl-entc{color:#f0c674!important}.pl-enti{color:#f0c674!important;font-weight:700!important}.pl-entm{color:#c66!important}.pl-eoa{color:#b294bb!important}.pl-eoac{color:#c66!important}.pl-eoac .pl-pde{color:#c66!important}.pl-eoai{color:#b294bb!important}.pl-eoai .pl-pde{color:#b294bb!important}.pl-eoi{color:#f0c674!important}.pl-k{color:#b294bb!important}.pl-ko{color:#b294bb!important}.pl-kolp{color:#b294bb!important}.pl-kos{color:#de935f!important}.pl-kou{color:#de935f!important}.pl-mai .pl-sf{color:#c66!important}.pl-mb{color:#b5bd68!important;font-weight:700!important}.pl-mc{color:#b294bb!important}.pl-mh .pl-pdh{color:#de935f!important}.pl-mi{color:#b294bb!important;font-style:italic!important}.pl-ml{color:#b5bd68!important}.pl-mm{color:#c66!important}.pl-mp{color:#81a2be!important}.pl-mp1 .pl-sf{color:#81a2be!important}.pl-mq{color:#de935f!important}.pl-mr{color:#b294bb!important}.pl-ms{color:#b294bb!important}.pl-pdb{color:#b5bd68!important;font-weight:700!important}.pl-pdc{color:#969896!important;font-style:italic!important}.pl-pdc1{color:#de935f!important}.pl-pde{color:#de935f!important}.pl-pdi{color:#b294bb!important;font-style:italic!important}.pl-pds{color:#b5bd68!important}.pl-pdv{color:#c66!important}.pl-pse{color:#de935f!important}.pl-pse .pl-s2{color:#de935f!important}.pl-s{color:#b294bb!important}.pl-s1{color:#b5bd68!important}.pl-s2{color:#c5c8c6!important}.pl-mp .pl-s3{color:#b294bb!important}.pl-s3{color:#81a2be!important}.pl-sc{color:#c5c8c6!important}.pl-scp{color:#de935f!important}.pl-sf{color:#dad085!important}.pl-smc{color:#f0c674!important}.pl-smi{color:#c5c8c6!important}.pl-smp{color:#c5c8c6!important}.pl-sok{color:#b294bb!important}.pl-sol{color:#b5bd68!important}.pl-som{color:#c66!important}.pl-sr{color:#c66!important}.pl-sra{color:#b294bb!important}.pl-src{color:#b294bb!important}.pl-sre{color:#b294bb!important}.pl-st{color:#b294bb!important}.pl-stj{color:#c5c8c6!important}.pl-stp{color:#de935f!important}.pl-sv{color:#de935f!important}.pl-v{color:#de935f!important}.pl-vi{color:#de935f!important}.pl-vo{color:#c66!important}.pl-vpf{color:#de935f!important}.pl-mi1{color:#8f9d6a!important;background:rgba(0,64,0,.5)!important}.pl-mdht{color:#8f9d6a!important;background:rgba(0,64,0,.5)!important}.pl-md{color:#c66!important;background:rgba(64,0,0,.5)!important}.pl-mdhf{color:#c66!important;background:rgba(64,0,0,.5)!important}.pl-mdr{color:#de935f!important;font-weight:400!important}.pl-mdh{color:#c66!important;font-weight:400!important}.pl-mdi{color:#c66!important;font-weight:400!important}.pl-ib{background-color:#c66!important}.pl-id{background-color:#c66!important;color:#fff!important}.pl-ii{background-color:#c66!important;color:#fff!important}.pl-iu{background-color:#c66!important}.pl-mo{color:#c5c8c6!important}.pl-mri{color:#de935f!important}.pl-ms1{background-color:#c5c8c6!important}.pl-va{color:#de935f!important}.pl-vpu{color:#de935f!important}.pl-entl{color:#c5c8c6!important}.CodeMirror-gutters{background:#222!important;border-right:1px solid #484848!important}.CodeMirror-guttermarker{color:#fff!important}.CodeMirror-guttermarker-subtle{color:#aaa!important}.CodeMirror-linenumber{color:#aaa!important}.CodeMirror-cursor{border-left:1px solid #fff!important}.CodeMirror-activeline-background{background:#27282e!important}.CodeMirror-matchingbracket{outline:1px solid grey!important;color:#fff!important}.cm-keyword{color:#f9ee98!important}.cm-atom{color:#fc0!important}.cm-number{color:#ca7841!important}.cm-def{color:#8da6ce!important}.cm-variable-2,span.cm-tag{color:#607392!important}.cm-variable-3,span.cm-def{color:#607392!important}.cm-operator{color:#cda869!important}.cm-comment{color:#777!important;font-style:italic!important;font-weight:400!important}.cm-string{color:#8f9d6a!important}.cm-string-2{color:#bd6b18!important}.cm-meta{background-color:#141414!important;color:#f7f7f7!important}.cm-builtin{color:#cda869!important}.cm-tag{color:#997643!important}.cm-attribute{color:#d6bb6d!important}.cm-header{color:#ff6400!important}.cm-hr{color:#aeaeae!important}.cm-link{color:#ad9361!important;font-style:italic!important;text-decoration:none!important}.cm-error{border-bottom:1px solid red!important}#notebook .highlight table{background:#1d1f21!important;color:#c5c8c6!important}.highlight .hll{background-color:#373b41!important}.highlight .c{color:#969896!important}.highlight .err{color:#c66!important}.highlight .k{color:#b294bb!important}.highlight .l{color:#de935f!important}.highlight .h,.highlight .n{color:#c5c8c6!important}.highlight .o{color:#8abeb7!important}.highlight .p{color:#c5c8c6!important}.highlight .cm{color:#969896!important}.highlight .cp{color:#969896!important}.highlight .c1{color:#969896!important}.highlight .cs{color:#969896!important}.highlight .gd{color:#c66!important}.highlight .ge{font-style:italic!important}.highlight .gh{color:#c5c8c6!important;font-weight:700!important}.highlight .gi{color:#b5bd68!important}.highlight .gp{color:#969896!important;font-weight:700!important}.highlight .gs{font-weight:700!important}.highlight .gu{color:#8abeb7!important;font-weight:700!important}.highlight .kc{color:#b294bb!important}.highlight .kd{color:#b294bb!important}.highlight .kn{color:#8abeb7!important}.highlight .kp{color:#b294bb!important}.highlight .kr{color:#b294bb!important}.highlight .kt{color:#f0c674!important}.highlight .ld{color:#b5bd68!important}.highlight .m{color:#de935f!important}.highlight .s{color:#b5bd68!important}.highlight .na{color:#81a2be!important}.highlight .nb{color:#c5c8c6!important}.highlight .nc{color:#f0c674!important}.highlight .no{color:#c66!important}.highlight .nd{color:#8abeb7!important}.highlight .ni{color:#c5c8c6!important}.highlight .ne{color:#c66!important}.highlight .nf{color:#81a2be!important}.highlight .nl{color:#c5c8c6!important}.highlight .nn{color:#f0c674!important}.highlight .nx{color:#81a2be!important}.highlight .py{color:#c5c8c6!important}.highlight .nt{color:#8abeb7!important}.highlight .nv{color:#c66!important}.highlight .ow{color:#8abeb7!important}.highlight .w{color:#c5c8c6!important}.highlight .mf{color:#de935f!important}.highlight .mh{color:#de935f!important}.highlight .mi{color:#de935f!important}.highlight .mo{color:#de935f!important}.highlight .sb{color:#b5bd68!important}.highlight .sc{color:#c5c8c6!important}.highlight .sd{color:#969896!important}.highlight .s2{color:#b5bd68!important}.highlight .se{color:#de935f!important}.highlight .sh{color:#b5bd68!important}.highlight .si{color:#de935f!important}.highlight .sx{color:#b5bd68!important}.highlight .sr{color:#b5bd68!important}.highlight .s1{color:#b5bd68!important}.highlight .ss{color:#b5bd68!important}.highlight .bp{color:#c5c8c6!important}.highlight .vc{color:#c66!important}.highlight .vg{color:#c66!important}.highlight .vi{color:#c66!important}.highlight .il{color:#de935f!important}</style><body><div class="container transition-fade" id=swup><div itemscope itemtype=http://schema.org/BlogPosting><div class=container><header class="grid center"><div class="cell menu"><h1 itemprop="name headline">SQL As An API</h1></div></header><p><a title="Go Back Home" href=https://ohdoylerules.com>Go home</a><div class=the-loop><p class=post-info><span class=post-date itemprop=datePublished>ðŸ•’Â Â <span>May 12, 2019</span></span><div itemprop="ArticleBody text" class=main-content><p>There has been a lot of fanfare around the idea of <a href=https://graphql.org/>GraphQL</a> lately. For good reason in my opinion.<p>GraphQL allows you to essentially define your API with your query. For example, if you want to only include a single field then you can do that. If you want to nest related items, or not, you can do that as well.<p>If you take a quick look at the GraphQL website (as it is today) you can see how they lay this out:<pre style=background:#2b303b;color:#c0c5ce><code><span># Describe your data
</span><span>type Project {
</span><span>  name: String
</span><span>  tagline: String
</span><span>  created_at: Int
</span><span>}
</span><span>
</span><span># Ask for what you want
</span><span>{
</span><span>  project(name: "My Project") {
</span><span>    tagline
</span><span>  }
</span><span>}
</span><span>
</span><span># Get predictable results
</span><span>{
</span><span>  "project": {
</span><span>    "tagline": "A query language for APIs"
</span><span>  }
</span><span>}
</span></code></pre><p>Pretty straightforward. You create a model of your data that describes it, write a query that matches the model, and get the results.<p>Although, this should already look familiar to anyone that has used a relational database before. What if we massage this example so it fits a more classic datastore:<pre style=background:#2b303b;color:#c0c5ce><code><span># Describe your data
</span><span>CREATE TABLE "project"
</span><span>(
</span><span>    [name] NVARCHAR(40),
</span><span>    [tagline] NVARCHAR(120),
</span><span>    [created_at] INTEGER NOT NULL
</span><span>);
</span><span>
</span><span># Ask for what you want
</span><span>SELECT `tagline` FROM `projects` WHERE `name` = "My Project"
</span><span>
</span><span># Get predictable results
</span><span>[
</span><span>  {
</span><span>    "tagline": "A query language for APIs"
</span><span>  }
</span><span>]
</span></code></pre><p>So this really is just another way to store and query your data. We describe the structure, query it using the specified query language with our expected structure, and print out the results.<blockquote><p>So can we create a GraphQL experience using just SQL?</blockquote><p>So can we create a GraphQL experience using just SQL? Short answer, yes. This isn't a new concept though. There is a tool called <a href=https://simonwillison.net/2017/Nov/13/datasette/#Arbitrary_SQL_55>datasette</a> that does just this.<p>So where do we start? Well, we don't want users to be able to modify our database. We want to safely expose SQL to the internet. Crazy idea but it just might work.<p>So what we want to do is open a Sqlite database using the "ro" (read only) mode (see <a href=http://www.sqlite.org/draft/c3ref/open.html>mode details here</a>). This mode means that you <em>cannot modify the database</em>. You can only run queries that are reads. This is a great feature as we need to expose this database to the public internet if we are going to use it as an API.<p>Once we have a mounted sqlite database that is set to "read only" mode, we can then pass queries right to it and return the results.<h3 id=basic-example>Basic Example</h3><p>We are going to whip up this example using PHP and the <code>chinook</code> database <a href=http://www.sqlitetutorial.net/sqlite-sample-database/>from this site</a>. It is insanely easy to get this working using the <code>SQLite3</code> class and a single <code>json_encode</code> call.<p>Let's see how to get this done:<pre class=language-php data-lang=php style=background:#2b303b;color:#c0c5ce><code class=language-php data-lang=php><span style=color:#ab7967>&LT?php
</span><span style=color:#65737e>// be sure to open with `SQLITE3_OPEN_READONLY`
</span><span>$</span><span style=color:#bf616a>db </span><span>= </span><span style=color:#b48ead>new </span><span style=color:#ebcb8b>SQLite3</span><span>('</span><span style=color:#a3be8c>chinook.sqlite</span><span>', SQLITE3_OPEN_READONLY);
</span><span style=color:#65737e>// pull out the query from the POST request
</span><span>$</span><span style=color:#bf616a>rows </span><span>= $</span><span style=color:#bf616a>db</span><span>-></span><span style=color:#bf616a>query</span><span>($</span><span style=color:#bf616a>_POST</span><span>['</span><span style=color:#a3be8c>query</span><span>']);
</span><span>$</span><span style=color:#bf616a>results </span><span>= [];
</span><span style=color:#b48ead>while </span><span>($</span><span style=color:#bf616a>row </span><span>= $</span><span style=color:#bf616a>rows</span><span>-></span><span style=color:#bf616a>fetchArray</span><span>(SQLITE3_ASSOC)) {
</span><span>    $</span><span style=color:#bf616a>results</span><span>[] = $</span><span style=color:#bf616a>row</span><span>;
</span><span>}
</span><span style=color:#96b5b4>echo json_encode</span><span>($</span><span style=color:#bf616a>results</span><span>);
</span></code></pre><p>OK. That was easy. This is all we need to support calls to this "server". Let's save this to <code>index.php</code>. And start a webserver on port <code>8000</code>. If you didn't know this, PHP has a built-in server just like the one python has. We can start it like so:<pre class=language-sh data-lang=sh style=background:#2b303b;color:#c0c5ce><code class=language-sh data-lang=sh><span style=color:#bf616a>php -S</span><span> localhost:8000
</span></code></pre><p>You should see some output information about what the server is doing. Now we can make calls to this API:<pre class=language-sh data-lang=sh style=background:#2b303b;color:#c0c5ce><code class=language-sh data-lang=sh><span style=color:#bf616a>curl --request</span><span> POST \
</span><span style=color:#bf616a>  --url</span><span> http://localhost:8000 \
</span><span style=color:#bf616a>  --header </span><span>'</span><span style=color:#a3be8c>Content-Type: application/x-www-form-urlencoded</span><span>' \
</span><span style=color:#bf616a>  --data </span><span>'</span><span style=color:#a3be8c>query=SELECT LastName FROM employees</span><span>'
</span></code></pre><p>We should see the following output in our console:<pre class=language-json data-lang=json style=background:#2b303b;color:#c0c5ce><code class=language-json data-lang=json><span>[
</span><span>  {
</span><span>    "</span><span style=color:#a3be8c>LastName</span><span>": "</span><span style=color:#a3be8c>Adams</span><span>"
</span><span>  },
</span><span>  {
</span><span>    "</span><span style=color:#a3be8c>LastName</span><span>": "</span><span style=color:#a3be8c>Edwards</span><span>"
</span><span>  },
</span><span>  {
</span><span>    "</span><span style=color:#a3be8c>LastName</span><span>": "</span><span style=color:#a3be8c>Peacock</span><span>"
</span><span>  },
</span><span>  {
</span><span>    "</span><span style=color:#a3be8c>LastName</span><span>": "</span><span style=color:#a3be8c>Park</span><span>"
</span><span>  },
</span><span>  {
</span><span>    "</span><span style=color:#a3be8c>LastName</span><span>": "</span><span style=color:#a3be8c>Johnson</span><span>"
</span><span>  },
</span><span>  {
</span><span>    "</span><span style=color:#a3be8c>LastName</span><span>": "</span><span style=color:#a3be8c>Mitchell</span><span>"
</span><span>  },
</span><span>  {
</span><span>    "</span><span style=color:#a3be8c>LastName</span><span>": "</span><span style=color:#a3be8c>King</span><span>"
</span><span>  },
</span><span>  {
</span><span>    "</span><span style=color:#a3be8c>LastName</span><span>": "</span><span style=color:#a3be8c>Callahan</span><span>"
</span><span>  }
</span><span>]
</span></code></pre><h3 id=getting-fancier>Getting fancier</h3><p>Nice! So this works. Let's try to do something a little more fancy:<pre class=language-sh data-lang=sh style=background:#2b303b;color:#c0c5ce><code class=language-sh data-lang=sh><span style=color:#bf616a>curl --request</span><span> POST \
</span><span style=color:#bf616a>  --url</span><span> http://localhost:8000 \
</span><span style=color:#bf616a>  --header </span><span>'</span><span style=color:#a3be8c>Content-Type: application/x-www-form-urlencoded</span><span>' \
</span><span style=color:#bf616a>  --data </span><span>'</span><span style=color:#a3be8c>query=SELECT printf("%s %s", FirstName, LastName) AS FullName, FirstName, LastName FROM employees</span><span>'
</span></code></pre><p>Our output:<pre class=language-json data-lang=json style=background:#2b303b;color:#c0c5ce><code class=language-json data-lang=json><span>[
</span><span>  {
</span><span>    "</span><span style=color:#a3be8c>FullName</span><span>": "</span><span style=color:#a3be8c>Andrew Adams</span><span>",
</span><span>    "</span><span style=color:#a3be8c>FirstName</span><span>": "</span><span style=color:#a3be8c>Andrew</span><span>",
</span><span>    "</span><span style=color:#a3be8c>LastName</span><span>": "</span><span style=color:#a3be8c>Adams</span><span>"
</span><span>  },
</span><span>  {
</span><span>    "</span><span style=color:#a3be8c>FullName</span><span>": "</span><span style=color:#a3be8c>Nancy Edwards</span><span>",
</span><span>    "</span><span style=color:#a3be8c>FirstName</span><span>": "</span><span style=color:#a3be8c>Nancy</span><span>",
</span><span>    "</span><span style=color:#a3be8c>LastName</span><span>": "</span><span style=color:#a3be8c>Edwards</span><span>"
</span><span>  },
</span><span>  {
</span><span>    "</span><span style=color:#a3be8c>FullName</span><span>": "</span><span style=color:#a3be8c>Jane Peacock</span><span>",
</span><span>    "</span><span style=color:#a3be8c>FirstName</span><span>": "</span><span style=color:#a3be8c>Jane</span><span>",
</span><span>    "</span><span style=color:#a3be8c>LastName</span><span>": "</span><span style=color:#a3be8c>Peacock</span><span>"
</span><span>  },
</span><span>  {
</span><span>    "</span><span style=color:#a3be8c>FullName</span><span>": "</span><span style=color:#a3be8c>Margaret Park</span><span>",
</span><span>    "</span><span style=color:#a3be8c>FirstName</span><span>": "</span><span style=color:#a3be8c>Margaret</span><span>",
</span><span>    "</span><span style=color:#a3be8c>LastName</span><span>": "</span><span style=color:#a3be8c>Park</span><span>"
</span><span>  },
</span><span>  {
</span><span>    "</span><span style=color:#a3be8c>FullName</span><span>": "</span><span style=color:#a3be8c>Steve Johnson</span><span>",
</span><span>    "</span><span style=color:#a3be8c>FirstName</span><span>": "</span><span style=color:#a3be8c>Steve</span><span>",
</span><span>    "</span><span style=color:#a3be8c>LastName</span><span>": "</span><span style=color:#a3be8c>Johnson</span><span>"
</span><span>  },
</span><span>  {
</span><span>    "</span><span style=color:#a3be8c>FullName</span><span>": "</span><span style=color:#a3be8c>Michael Mitchell</span><span>",
</span><span>    "</span><span style=color:#a3be8c>FirstName</span><span>": "</span><span style=color:#a3be8c>Michael</span><span>",
</span><span>    "</span><span style=color:#a3be8c>LastName</span><span>": "</span><span style=color:#a3be8c>Mitchell</span><span>"
</span><span>  },
</span><span>  {
</span><span>    "</span><span style=color:#a3be8c>FullName</span><span>": "</span><span style=color:#a3be8c>Robert King</span><span>",
</span><span>    "</span><span style=color:#a3be8c>FirstName</span><span>": "</span><span style=color:#a3be8c>Robert</span><span>",
</span><span>    "</span><span style=color:#a3be8c>LastName</span><span>": "</span><span style=color:#a3be8c>King</span><span>"
</span><span>  },
</span><span>  {
</span><span>    "</span><span style=color:#a3be8c>FullName</span><span>": "</span><span style=color:#a3be8c>Laura Callahan</span><span>",
</span><span>    "</span><span style=color:#a3be8c>FirstName</span><span>": "</span><span style=color:#a3be8c>Laura</span><span>",
</span><span>    "</span><span style=color:#a3be8c>LastName</span><span>": "</span><span style=color:#a3be8c>Callahan</span><span>"
</span><span>  }
</span><span>]
</span></code></pre><p>How about a little example that searches a users name?<pre class=language-sh data-lang=sh style=background:#2b303b;color:#c0c5ce><code class=language-sh data-lang=sh><span style=color:#bf616a>curl --request</span><span> POST \
</span><span style=color:#bf616a>  --url</span><span> http://localhost:8000 \
</span><span style=color:#bf616a>  --header </span><span>'</span><span style=color:#a3be8c>Content-Type: application/x-www-form-urlencoded</span><span>' \
</span><span style=color:#bf616a>  --data </span><span>'</span><span style=color:#a3be8c>query=SELECT printf ("%s %s", employees.FirstName, employees.LastName) AS full_name FROM employees WHERE full_name LIKE "an%"</span><span>'
</span></code></pre><p>We see that we found the user:<pre class=language-json data-lang=json style=background:#2b303b;color:#c0c5ce><code class=language-json data-lang=json><span>[
</span><span>  {
</span><span>    "</span><span style=color:#a3be8c>full_name</span><span>": "</span><span style=color:#a3be8c>Andrew Adams</span><span>"
</span><span>  }
</span><span>]
</span></code></pre><p>Let's do an even more sophisticated example:<pre class=language-sh data-lang=sh style=background:#2b303b;color:#c0c5ce><code class=language-sh data-lang=sh><span style=color:#bf616a>curl --request</span><span> POST \
</span><span style=color:#bf616a>  --url</span><span> http://localhost:8000 \
</span><span style=color:#bf616a>  --header </span><span>'</span><span style=color:#a3be8c>Content-Type: application/x-www-form-urlencoded</span><span>' \
</span><span style=color:#bf616a>  --data </span><span>'</span><span style=color:#a3be8c>query=SELECT e2.EmployeeId AS employee_id, e2.ReportsTo AS reports_to, printf ("%s %s", e2.FirstName, e2.LastName) AS employee_full_name, printf ("%s %s", e1.FirstName, e1.LastName) AS reports_to_full_name FROM employees e1 INNER JOIN employees e2 ON e1.EmployeeId = e2.ReportsTo WHERE e1.ReportsTo IS NOT NULL</span><span>'
</span></code></pre><p>And our output:<pre class=language-json data-lang=json style=background:#2b303b;color:#c0c5ce><code class=language-json data-lang=json><span>[
</span><span>  {
</span><span>    "</span><span style=color:#a3be8c>employee_id</span><span>": </span><span style=color:#d08770>3</span><span>,
</span><span>    "</span><span style=color:#a3be8c>reports_to</span><span>": </span><span style=color:#d08770>2</span><span>,
</span><span>    "</span><span style=color:#a3be8c>employee_full_name</span><span>": "</span><span style=color:#a3be8c>Jane Peacock</span><span>",
</span><span>    "</span><span style=color:#a3be8c>reports_to_full_name</span><span>": "</span><span style=color:#a3be8c>Nancy Edwards</span><span>"
</span><span>  },
</span><span>  {
</span><span>    "</span><span style=color:#a3be8c>employee_id</span><span>": </span><span style=color:#d08770>4</span><span>,
</span><span>    "</span><span style=color:#a3be8c>reports_to</span><span>": </span><span style=color:#d08770>2</span><span>,
</span><span>    "</span><span style=color:#a3be8c>employee_full_name</span><span>": "</span><span style=color:#a3be8c>Margaret Park</span><span>",
</span><span>    "</span><span style=color:#a3be8c>reports_to_full_name</span><span>": "</span><span style=color:#a3be8c>Nancy Edwards</span><span>"
</span><span>  },
</span><span>  {
</span><span>    "</span><span style=color:#a3be8c>employee_id</span><span>": </span><span style=color:#d08770>5</span><span>,
</span><span>    "</span><span style=color:#a3be8c>reports_to</span><span>": </span><span style=color:#d08770>2</span><span>,
</span><span>    "</span><span style=color:#a3be8c>employee_full_name</span><span>": "</span><span style=color:#a3be8c>Steve Johnson</span><span>",
</span><span>    "</span><span style=color:#a3be8c>reports_to_full_name</span><span>": "</span><span style=color:#a3be8c>Nancy Edwards</span><span>"
</span><span>  },
</span><span>  {
</span><span>    "</span><span style=color:#a3be8c>employee_id</span><span>": </span><span style=color:#d08770>7</span><span>,
</span><span>    "</span><span style=color:#a3be8c>reports_to</span><span>": </span><span style=color:#d08770>6</span><span>,
</span><span>    "</span><span style=color:#a3be8c>employee_full_name</span><span>": "</span><span style=color:#a3be8c>Robert King</span><span>",
</span><span>    "</span><span style=color:#a3be8c>reports_to_full_name</span><span>": "</span><span style=color:#a3be8c>Michael Mitchell</span><span>"
</span><span>  },
</span><span>  {
</span><span>    "</span><span style=color:#a3be8c>employee_id</span><span>": </span><span style=color:#d08770>8</span><span>,
</span><span>    "</span><span style=color:#a3be8c>reports_to</span><span>": </span><span style=color:#d08770>6</span><span>,
</span><span>    "</span><span style=color:#a3be8c>employee_full_name</span><span>": "</span><span style=color:#a3be8c>Laura Callahan</span><span>",
</span><span>    "</span><span style=color:#a3be8c>reports_to_full_name</span><span>": "</span><span style=color:#a3be8c>Michael Mitchell</span><span>"
</span><span>  }
</span><span>]
</span></code></pre><p>Awesome! As you can see this is pretty great! We have a basic API that we can use not only to read but to handle relationships as well. Sweet!<h3 id=handling-malicious-queries>Handling malicious queries</h3><p>Let's try to execute a bad command:<pre class=language-sh data-lang=sh style=background:#2b303b;color:#c0c5ce><code class=language-sh data-lang=sh><span style=color:#bf616a>curl --request</span><span> POST \
</span><span style=color:#bf616a>  --url</span><span> http://localhost:8000 \
</span><span style=color:#bf616a>  --header </span><span>'</span><span style=color:#a3be8c>Content-Type: application/x-www-form-urlencoded</span><span>' \
</span><span style=color:#bf616a>  --data </span><span>'</span><span style=color:#a3be8c>query=INSERT INTO "artists" ("Name") VALUES ("Philip Glass Ensemble")</span><span>'
</span></code></pre><p>We should see this output from the server:<pre class=language-html data-lang=html style=background:#2b303b;color:#c0c5ce><code class=language-html data-lang=html><span><</span><span style=color:#bf616a>br </span><span>/>
</span><span><</span><span style=color:#bf616a>b</span><span>>Warning&LT/</span><span style=color:#bf616a>b</span><span>>:  SQLite3::query(): Unable to execute statement: attempt to write a readonly database in <</span><span style=color:#bf616a>b</span><span>>/Users/james/Sites/sqliteapi/index.php&LT/</span><span style=color:#bf616a>b</span><span>> on line <</span><span style=color:#bf616a>b</span><span>>6&LT/</span><span style=color:#bf616a>b</span><span>><</span><span style=color:#bf616a>br </span><span>/>
</span><span><</span><span style=color:#bf616a>br </span><span>/>
</span><span><</span><span style=color:#bf616a>b</span><span>>Fatal error&LT/</span><span style=color:#bf616a>b</span><span>>:  Uncaught Error: Call to a member function fetchArray() on bool in /Users/james/Sites/sqliteapi/index.php:8
</span><span>Stack trace:
</span><span>#0 {main}
</span><span>  thrown in <</span><span style=color:#bf616a>b</span><span>>/Users/james/Sites/sqliteapi/index.php&LT/</span><span style=color:#bf616a>b</span><span>> on line <</span><span style=color:#bf616a>b</span><span>>8&LT/</span><span style=color:#bf616a>b</span><span>><</span><span style=color:#bf616a>br </span><span>/>
</span></code></pre><p>As you can see, we try to execute a bad query that would manipulate the data and we get blocked.<h3 id=super-example>Super example</h3><p>Here is a much more robust example with some error handling, proper status codes, parsing of JSON input, and it also allows you to put the <code>query</code> in a <code>GET</code> or a <code>POST</code> request.</p><iframe srcdoc="`<script src='https://gist.github.com/james2doyle/9e4b2b4f17e33bfb236fbdaf96c41a4c.js'></script>`" class=iframes id=https://gist.github.com/james2doyle/9e4b2b4f17e33bfb236fbdaf96c41a4c.js src=about:blank></iframe><p>Try running the example above and giving things a test. Here is our new request that uses JSON instead:<pre class=language-sh data-lang=sh style=background:#2b303b;color:#c0c5ce><code class=language-sh data-lang=sh><span style=color:#bf616a>curl -X</span><span> POST \
</span><span>  http://localhost:8000 \
</span><span style=color:#bf616a>  -H </span><span>'</span><span style=color:#a3be8c>Content-Type: application/json</span><span>' \
</span><span style=color:#bf616a>  -d </span><span>'</span><span style=color:#a3be8c>{ "query": "SELECT LastName FROM employees" }</span><span>'
</span></code></pre><p>Now we have the following output:<pre class=language-json data-lang=json style=background:#2b303b;color:#c0c5ce><code class=language-json data-lang=json><span>{
</span><span>  "</span><span style=color:#a3be8c>data</span><span>": [
</span><span>    {
</span><span>      "</span><span style=color:#a3be8c>LastName</span><span>": "</span><span style=color:#a3be8c>Adams</span><span>"
</span><span>    },
</span><span>    {
</span><span>      "</span><span style=color:#a3be8c>LastName</span><span>": "</span><span style=color:#a3be8c>Edwards</span><span>"
</span><span>    },
</span><span>    {
</span><span>      "</span><span style=color:#a3be8c>LastName</span><span>": "</span><span style=color:#a3be8c>Peacock</span><span>"
</span><span>    },
</span><span>    {
</span><span>      "</span><span style=color:#a3be8c>LastName</span><span>": "</span><span style=color:#a3be8c>Park</span><span>"
</span><span>    },
</span><span>    {
</span><span>      "</span><span style=color:#a3be8c>LastName</span><span>": "</span><span style=color:#a3be8c>Johnson</span><span>"
</span><span>    },
</span><span>    {
</span><span>      "</span><span style=color:#a3be8c>LastName</span><span>": "</span><span style=color:#a3be8c>Mitchell</span><span>"
</span><span>    },
</span><span>    {
</span><span>      "</span><span style=color:#a3be8c>LastName</span><span>": "</span><span style=color:#a3be8c>King</span><span>"
</span><span>    },
</span><span>    {
</span><span>      "</span><span style=color:#a3be8c>LastName</span><span>": "</span><span style=color:#a3be8c>Callahan</span><span>"
</span><span>    }
</span><span>  ],
</span><span>  "</span><span style=color:#a3be8c>meta</span><span>": {
</span><span>    "</span><span style=color:#a3be8c>query</span><span>": "</span><span style=color:#a3be8c>SELECT LastName FROM employees</span><span>",
</span><span>    "</span><span style=color:#a3be8c>total</span><span>": </span><span style=color:#d08770>8
</span><span>  }
</span><span>}
</span></code></pre><p>So there you go. A pretty robust solution that has excellent performance, a simple and well-known query language, and supports almost any combination of data.<h3 id=in-summation>In summation</h3><p>So this could be a great option for a lot of applications. You can quickly imagine how this could be used for something like a simple search API. You could have an application hook to add data to this special database when your data is changed. Sqlite is a really viable option for a lot of things as it can grow to 140 TB, supports <a href=https://www.sqlite.org/json1.html><code>json_</code> functions</a>, and even <a href=https://effbot.org/zone/sqlite-blob.htm>binary data</a>.<p>Keep in mind that you can't really nest the same way you can in GraphQL. But you might be ok with that depending on your use case.</div><p><a title="Go Back Home" href=https://ohdoylerules.com>Go home</a><hr><div class="media grid"><div class=media-left><a class=post-author-link href=https://twitter.com/james2doyle target=_blank> <img alt="James Doyle Profile Picture" src="https://www.gravatar.com/avatar/b7375c88e1864c4ddf0d7bdab58e4cca?s=120&d=mm&r=g" height=120 width=120> </a></div><div class="media-body cell -9of12"><div class=media-heading><h3 itemprop="author publisher creator provider">James Doyle</h3></div><div class=media-content><p>I'm a full-stack developer, co-organizer of <a title="PHP Vancouver" href=https://www.meetup.com/vancouver-php target=_blank>PHP Vancouver</a> meetup, and winner of a <a title="Canadian Developer 30 under 30 award" href=http://www.canadianbusiness.com/innovation/developer-30-under-30-gallery/image/20/ target=_blank>Canadian Developer 30 under 30 award</a>. I'm a huge Open Source advocate and contributor to a lot of projects in my community. When I am not sitting at a computer, I'm trying to perfect some other skill.</div></div></div><hr><div id=disqus_thread itemprop=comment></div><script>(function(){var a=document.createElement('script');a.type='text/javascript';a.async=true;a.src='//ohdoylerules.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a class=dsq-brlink href=https://disqus.com>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></div></div><script src=https://unpkg.com/swup@4.6.1/dist/Swup.umd.js></script><script>const swup=new Swup({native:true});function handleGists(){const a=document.querySelectorAll('.iframes');[...a].forEach(function(b){b.onload=function(){b.style.height=b.contentWindow.document.body.scrollHeight+ 'px'};b.style.height=b.contentWindow.document.body.scrollHeight+ 'px'})}document.addEventListener('DOMContentLoaded',handleGists);swup.hooks.on('visit:end',handleGists,{priority:100})</script>