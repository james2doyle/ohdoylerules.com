<!doctype html><html lang=en><head><meta charset=utf-8><meta content=public http-equiv=Cache-control><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1,maximum-scale=5" name=viewport><title>Using Sqlite As A Cache In Laravel | OhDoyleRules</title><meta content="Using Sqlite As A Cache In Laravel | OhDoyleRules" name=twitter:title><meta content=KM-5h_iJ7JJsGeUp4ncEoYCBKft1ko1A4gBpjIzT0p4 name=google-site-verification><meta content="Using Sqlite As A Cache In Laravel" itemprop=name><meta content=OhDoyleRules property=og:site_name><meta content=https://ohdoylerules.com/web/laravel-sqlite-cache/ itemprop=url><meta content=james2doyle@gmail.com itemprop=email><meta content=https://ohdoylerules.com/web/laravel-sqlite-cache/ property=og:url><meta itemprop="image logo" content=/icons/logo.png><meta content=/icons/logo.png property=og:image><link href=/icons/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/icons/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/icons/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=/site.webmanifest rel=manifest><link color=#333333 href=/icons/safari-pinned-tab.svg rel=mask-icon><link href=/icons/favicon.ico rel=icon sizes=any><link href=/icons/favicon.svg rel=icon type=image/svg+xml><meta content=/browserconfig.xml name=msapplication-config><meta content=#ffffff name=msapplication-TileColor><meta content=#ffffff name=theme-color><meta content=summary name=twitter:card><meta content=@james2doyle name=twitter:site><meta content="Using Sqlite As A Cache In Laravel" name=twitter:title><meta content=@james2doyle name=twitter:creator><meta content=/icons/logo.png name=twitter:image><meta content=/ name=twitter:domain><link href=/icons/logo.svg rel=icon><meta content="How to use Sqlite as a cache in Laravel" name=description><meta content="How to use Sqlite as a cache in Laravel" itemprop=description><meta content="How to use Sqlite as a cache in Laravel" property=og:description><meta content="How to use Sqlite as a cache in Laravel" name=twitter:description><meta content=article property=og:type><meta content="Using Sqlite As A Cache In Laravel | OhDoyleRules" property=og:title><meta content="james2doyle@gmail.com James Doyle" property=article:author><meta content="cache, laravel, sqlite, store" itemprop=keywords><meta content="cache, laravel, sqlite, store" property=article:tag><meta content="cache, laravel, sqlite, store" property=og:keywords><link href=https://www.google-analytics.com rel=dns-prefetch><link rel="shortcut icon" href=/favicon.ico><link href=https://ohdoylerules.com/web/laravel-sqlite-cache/ rel=canonical><link href=https://ohdoylerules.com/atom.xml rel=alternate title=atom type=application/atom+xml><style>:root{--b-font-main:system-ui,sans-serif;--b-font-mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;--b-txt:#dcd7ba;--b-bg-1:#18171f;--b-bg-2:#2d4f67;--b-line:#727169;--b-link:#ffa066;--b-heading:#fff;--b-btn-bg:#2d4f67;--b-btn-txt:#c8c093;--b-focus:#2d4f67;--b-accent-1:#e6c384;--b-accent-2:#c34043;--b-selection-color:#c8c093;--b-selection-bg:#2d4f67}*,:before,:after{box-sizing:border-box}::selection{color:var(--b-selection-color);background-color:var(--b-selection-bg)}html:focus-within{scroll-behavior:smooth}body{background:var(--b-bg-1);font-family:var(--b-font-main);font-feature-settings:"lnum" 1;font-variant-numeric:slashed-zero;text-rendering:geometricprecision;color:var(--b-txt);-moz-tab-size:4;tab-size:4;word-break:break-word;overflow-wrap:break-word;-webkit-tap-highlight-color:#0000;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;max-width:70ch;margin:auto;padding:0 1rem;line-height:1.5}h1,h2,h3,h4,h5,h6,p,ul,ol,dl,dd,details,blockquote,pre,figure,table,address,hr,fieldset,iframe,audio,video{margin:0 0 1.5rem}h1,h2,h3,h4,h5,h6{text-wrap:balance;color:var(--b-heading);margin-top:2rem;line-height:1.25}h1{font-size:2rem}h2{font-size:1.5rem}h3{font-size:1.25rem}h4{font-size:1rem}h5{font-size:.875rem}h6{font-size:.75rem}a{color:var(--b-link);text-decoration:underline}a:hover{text-decoration:underline}img,video,svg{max-width:100%;height:auto}embed,iframe,object{max-width:100%}iframe{border-style:none;width:100%;height:100%}abbr[title]{text-decoration:underline dotted}b,strong{font-weight:700}blockquote{border-left:.25rem solid var(--b-accent-2);margin-left:0;padding:.5rem 0 .5rem 1.5rem}blockquote p{margin-bottom:0}small{font-size:.875rem}sub,sup{vertical-align:baseline;font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}hr{border:0;border-bottom:1px solid var(--b-line);height:0}mark{background:var(--b-bg-2);color:var(--b-txt);border-radius:.25rem;padding:.125rem .25rem}pre,code,kbd,samp,tt,var{background:var(--b-bg-2);font-family:var(--b-font-mono);border-radius:.25rem;padding:.125rem .25rem;font-size:.875em}pre{white-space:pre;padding:1rem;overflow:auto}pre code{background-color:inherit;padding:0}p code{background-color:var(--b-bg-2);color:var(--b-accent-1)}details{background:var(--b-bg-2);border:1px solid var(--b-line);border-radius:.25rem;padding:.5rem 1rem;display:block}details[open]>summary{margin-bottom:1.5rem}summary{cursor:pointer;font-weight:700;display:list-item}summary:focus{box-shadow:none}table{border-collapse:collapse;text-indent:0;width:100%}table caption{margin-bottom:.5rem}tr{border-bottom:1px solid var(--b-line)}td,th{word-break:normal;padding:.5rem 0 .5rem 1rem}td:first-child,th:first-child{padding-left:0}th{text-align:left}ul,ol,dd{padding-left:2rem}li>ul,li>ol{margin-bottom:0}fieldset{border:1px solid var(--b-line);border-radius:.25rem;padding:.5rem .75rem}legend{padding:0 .25rem}label{cursor:pointer;margin-bottom:.25rem;display:block}button,input,select,textarea{background:var(--b-bg-2);font:inherit;color:var(--b-txt);border:0;border-radius:.25rem;max-width:100%;margin:0;padding:.5rem .75rem;line-height:1.125}button,select{text-transform:none}select,[type=date],[type=datetime-local],[type=datetime],[type=email],[type=month],[type=number],[type=password],[type=search],[type=tel],[type=text],[type=time],[type=url],[type=week]{width:100%}[type=image],[type=checkbox],[type=radio]{cursor:pointer}[type=color]{min-height:2.125rem}select:not([multiple]):not([size]){-webkit-appearance:none;-moz-appearance:none;appearance:none;background-position:right .5rem center;background-repeat:no-repeat;padding-right:1.5rem}textarea{resize:vertical;width:100%}textarea:not([rows]){height:8rem}button{touch-action:manipulation}button,[type=button],[type=submit],[type=reset]{-webkit-appearance:button;text-align:center;white-space:nowrap;background:var(--b-btn-bg);color:var(--b-btn-txt);cursor:pointer;border:0;transition:opacity .25s;display:inline-block}button:hover,[type=button]:hover,[type=submit]:hover,[type=reset]:hover{opacity:.75}button[disabled],[type=button][disabled],[type=submit][disabled],[type=reset][disabled]{opacity:.5}progress{vertical-align:baseline}[type=search]{-webkit-appearance:none;outline-offset:-2px}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}::-webkit-input-placeholder{color:inherit;opacity:.5}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}::-moz-focus-inner{border-style:none;padding:0}:-moz-focusring{outline:1px dotted buttontext}:-moz-ui-invalid{box-shadow:none}[aria-busy=true]{cursor:progress}[aria-disabled=true],[disabled]{cursor:not-allowed}:focus,details:focus-within{box-shadow:0 0 0 2px var(--b-focus);outline:none}@media (prefers-reduced-motion:reduce){html:focus-within{scroll-behavior:auto}*,:before,:after{background-attachment:initial!important;scroll-behavior:auto!important;transition-delay:0!important;transition-duration:0!important;animation-duration:1ms!important;animation-iteration-count:1!important;animation-delay:-1ms!important}}select:not([multiple]):not([size]){background-image:url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23eceff4'%3E%3Cpath d='M5 6l5 5 5-5 2 1-7 7-7-7 2-1z'/%3E%3C/svg%3E")}.post-info,.center img{margin-bottom:1rem}a.none{color:inherit;opacity:1;border:none}a.none:hover{opacity:.6;background:0 0}.center{text-align:center}html.is-changing .transition-fade{view-transition-name:main}::view-transition-old(main){animation:.25s ease-in-out both fade}::view-transition-new(main){animation:.25s ease-in-out reverse both fade}@keyframes fade{0%{opacity:1}to{opacity:0}}html.is-changing:not(.swup-native) .transition-fade{will-change:opacity;opacity:1;transition:opacity .25s}html.is-animating:not(.swup-native) .transition-fade{opacity:0}.render-later{content-visibility:auto;contain-intrinsic-size:auto 166px}</style><style>.center img{max-width:100%;height:auto}pre code.language-diff span:nth-child(n+7){color:#50fa7b}iframe{border:0;min-height:300px;margin:0}.gist-iframe{filter:invert()hue-rotate(180deg)brightness();background-color:#fff}body table.highlight tr:nth-child(2n){background-color:#f6f8fa}body table.highlight td,body table.highlight th{border-color:#1b1f234d}</style><body><main class=transition-fade id=swup><header class=center><h1 itemprop="name headline">Using Sqlite As A Cache In Laravel</h1></header><hr><div itemscope itemtype=http://schema.org/BlogPosting><div><p><a title="Go Back Home" href=https://ohdoylerules.com>Go home</a><article><section class=post-info><span itemprop=datePublished> ðŸ•’Â Â  <time datetime=2018-10-04T00:00:00>October 04, 2018</time> </span></section><div itemprop="ArticleBody text" class=main-content><p>I was playing with a new project using <a rel="noopener nofollow noreferrer" href=https://laravel.com/docs/5.7 target=_blank>Laravel 5.7</a> and I wanted to use <a rel="noopener nofollow noreferrer" href=https://www.sqlite.org/index.html target=_blank>sqlite</a> for the <a rel="noopener nofollow noreferrer" href=https://laravel.com/docs/5.7/cache target=_blank>cache feature</a> that comes with the framework. If you didn't know, Laravel allows you to choose a cache "driver" and Laravel will handle writes, reads, and even locks, using that cache.<p>By default, Laravel includes drivers for "database", "redis", "memcached", "file", and "array". In typical Laravel fashion, you can even <a rel="noopener nofollow noreferrer" href=https://laravel.com/docs/5.7/cache#adding-custom-cache-drivers target=_blank>write your own drivers</a>. All you need to do is implement the <code>Illuminate\Contracts\Cache\Store</code> interface using the technology you wish to turn into a cache driver.<p>To my surprise, the "database" cache driver does not support multiple database connections. Which means whatever <code>DB_CONNECTION</code> you are using is also going to be used for the cache database driver when it is selected. I took a look to see how the "database" driver was implemented (it's in the <code>Illuminate\Cache\DatabaseStore</code> class) to see if there is any way I can make the database driver use a different connection than the one set in <code>DB_CONNECTION</code>. Looking deeper, it turns out that by extending <code>Illuminate\Cache\DatabaseStore</code>, I was able to put together a "sqlite" cache driver really quickly.<p>Before you set this all up, make sure you create the empty database. From the root of your project run: <code>touch database/cache.sqlite</code>. This creates an empty file that sqlite will mount as the database. To learn more about sqlite and how the file works, check out the page at the sqlite site about the <a rel="noopener nofollow noreferrer" href=https://www.sqlite.org/onefile.html target=_blank>Single-file Cross-platform Database</a>.<p>For the next step, you will need to make sure that the <code>sqlite3</code> command line tool is installed. If you need help getting that going, <a rel="noopener nofollow noreferrer" href=https://www.sqlite.org/download.html target=_blank>check out the download page for the tool</a>. Once that is installed, or if you already have it, you can then connect to the database file via the sqlite cli: <code>sqlite3 database/cache.sqlite</code>. If you want more info about the CLI tool, <a rel="noopener nofollow noreferrer" href=https://www.sqlite.org/cli.html target=_blank>check out the sqlite docs</a>.<p>Finally, you need to setup that sqlite database by executing the following SQL statement:<pre class=language-sql data-lang=sql style=color:#c0c5ce;background-color:#2b303b><code class=language-sql data-lang=sql><span style=color:#b48ead>CREATE TABLE </span><span>`</span><span style=color:#8fa1b3>cache</span><span>` (
</span><span>   `</span><span style=color:#a3be8c>key</span><span>` STRING </span><span style=color:#b48ead>PRIMARY KEY</span><span>,
</span><span>   `</span><span style=color:#a3be8c>value</span><span>` </span><span style=color:#b48ead>TEXT </span><span>NOT </span><span style=color:#d08770>NULL</span><span>,
</span><span>   `</span><span style=color:#a3be8c>expiration</span><span>` </span><span style=color:#b48ead>INT DEFAULT </span><span style=color:#d08770>0
</span><span>);
</span></code></pre><p>This statement will update the sqlite database with the required table and columns. This SQL is the same statement that runs when the cache migrations are created via the <code>artisan</code> command. To see that the SQL statement worked, you can run the <code>.tables</code> command. You should see <code>cache</code> in the list. To close out of the sqlite cli, run <code>.exit</code>.<p>Now that everything is all setup, here is the class that implements the <code>SqliteStore</code> that allows for a sqlite driver:<pre class=language-php data-lang=php style=color:#c0c5ce;background-color:#2b303b><code class=language-php data-lang=php><span style=color:#ab7967>&LT?php
</span><span style=color:#65737e>// put in app\Extensions
</span><span style=color:#b48ead>namespace </span><span>App\Extensions;
</span><span>
</span><span style=color:#b48ead>use </span><span>Illuminate\Cache\</span><span style=color:#ebcb8b>DatabaseStore</span><span>;
</span><span style=color:#b48ead>use </span><span>Illuminate\Support\Facades\</span><span style=color:#ebcb8b>Config</span><span>;
</span><span>
</span><span style=color:#65737e>/**
</span><span style=color:#65737e> * SqliteStore delegates to DatabaseStore but with an sqlite connection instead
</span><span style=color:#65737e> */
</span><span style=color:#b48ead>class </span><span style=color:#ebcb8b>SqliteStore </span><span style=color:#b48ead>extends </span><span style=color:#a3be8c>DatabaseStore
</span><span style=color:#eff1f5>{
</span><span style=color:#eff1f5>    </span><span style=color:#b48ead>public function </span><span style=color:#96b5b4>__construct</span><span style=color:#eff1f5>()
</span><span style=color:#eff1f5>    {
</span><span style=color:#eff1f5>        </span><span style=color:#65737e>// load the config or use the default
</span><span style=color:#eff1f5>        </span><span>$</span><span style=color:#bf616a>config </span><span>= </span><span style=color:#bf616a>config</span><span style=color:#eff1f5>(</span><span>'</span><span style=color:#a3be8c>cache.stores.sqlite</span><span>'</span><span style=color:#eff1f5>, [
</span><span style=color:#eff1f5>            </span><span>'</span><span style=color:#a3be8c>driver</span><span>' => '</span><span style=color:#a3be8c>sqlite</span><span>'</span><span style=color:#eff1f5>,
</span><span style=color:#eff1f5>            </span><span>'</span><span style=color:#a3be8c>table</span><span>' => '</span><span style=color:#a3be8c>cache</span><span>'</span><span style=color:#eff1f5>,
</span><span style=color:#eff1f5>            </span><span>'</span><span style=color:#a3be8c>database</span><span>' => </span><span style=color:#bf616a>env</span><span style=color:#eff1f5>(</span><span>'</span><span style=color:#a3be8c>CACHE_DATABASE</span><span>'</span><span style=color:#eff1f5>, </span><span style=color:#bf616a>database_path</span><span style=color:#eff1f5>(</span><span>'</span><span style=color:#a3be8c>cache.sqlite</span><span>'</span><span style=color:#eff1f5>)),
</span><span style=color:#eff1f5>            </span><span>'</span><span style=color:#a3be8c>prefix</span><span>' => ''</span><span style=color:#eff1f5>,
</span><span style=color:#eff1f5>        ]);
</span><span style=color:#eff1f5>
</span><span style=color:#eff1f5>        </span><span style=color:#65737e>// Set the temporary configuration
</span><span style=color:#eff1f5>        </span><span style=color:#ebcb8b>Config</span><span style=color:#eff1f5>::</span><span style=color:#bf616a>set</span><span style=color:#eff1f5>(</span><span>'</span><span style=color:#a3be8c>database.connections.sqlite_cache</span><span>'</span><span style=color:#eff1f5>, [
</span><span style=color:#eff1f5>            </span><span>'</span><span style=color:#a3be8c>driver</span><span>' => '</span><span style=color:#a3be8c>sqlite</span><span>'</span><span style=color:#eff1f5>,
</span><span style=color:#eff1f5>            </span><span>'</span><span style=color:#a3be8c>database</span><span>' => $</span><span style=color:#bf616a>config</span><span style=color:#eff1f5>[</span><span>'</span><span style=color:#a3be8c>database</span><span>'</span><span style=color:#eff1f5>],
</span><span style=color:#eff1f5>            </span><span>'</span><span style=color:#a3be8c>prefix</span><span>' => $</span><span style=color:#bf616a>config</span><span style=color:#eff1f5>[</span><span>'</span><span style=color:#a3be8c>prefix</span><span>'</span><span style=color:#eff1f5>],
</span><span style=color:#eff1f5>        ]);
</span><span style=color:#eff1f5>
</span><span style=color:#eff1f5>        </span><span>$</span><span style=color:#bf616a>connection </span><span>= </span><span style=color:#bf616a>app</span><span style=color:#eff1f5>(</span><span>'</span><span style=color:#a3be8c>db</span><span>'</span><span style=color:#eff1f5>)-></span><span style=color:#bf616a>connection</span><span style=color:#eff1f5>(</span><span>'</span><span style=color:#a3be8c>sqlite_cache</span><span>'</span><span style=color:#eff1f5>);
</span><span style=color:#eff1f5>        </span><span style=color:#bf616a>parent</span><span style=color:#eff1f5>::</span><span style=color:#bf616a>__construct</span><span style=color:#eff1f5>(</span><span>$</span><span style=color:#bf616a>connection</span><span style=color:#eff1f5>, </span><span>$</span><span style=color:#bf616a>config</span><span style=color:#eff1f5>[</span><span>'</span><span style=color:#a3be8c>table</span><span>'</span><span style=color:#eff1f5>], </span><span>$</span><span style=color:#bf616a>config</span><span style=color:#eff1f5>[</span><span>'</span><span style=color:#a3be8c>prefix</span><span>'</span><span style=color:#eff1f5>]);
</span><span style=color:#eff1f5>    }
</span><span style=color:#eff1f5>}
</span></code></pre><p>You may need to run <code>composer dumpautoload</code> in order for the new class to be picked up if you are creating the <code>app/Extensions</code> folder for the first time.<p>Then, add the following to your <code>AppServiceProvider@boot</code>:<pre class=language-php data-lang=php style=color:#c0c5ce;background-color:#2b303b><code class=language-php data-lang=php><span>// AppServiceProvider@boot
</span><span>\Cache::extend('sqlite', function ($app) {
</span><span>    return \Cache::repository(new \App\Extensions\SqliteStore);
</span><span>});
</span></code></pre><p>That's it for the code side. But we still need to setup the config so the driver details exist. Open up the <code>config/cache.php</code> file. Add these details so the config can be properly loaded:<pre class=language-php data-lang=php style=color:#c0c5ce;background-color:#2b303b><code class=language-php data-lang=php><span>// ... the rest of config/cache.php
</span><span>'sqlite' => [
</span><span>    'driver' => 'sqlite',
</span><span>    'table' => 'cache',
</span><span>    'database' => env('CACHE_DATABASE', database_path('cache.sqlite')),
</span><span>    'prefix' => '',
</span><span>],
</span></code></pre><p>You can then update your <code>.env</code> to have <code>CACHE_DRIVER=sqlite</code> and everything should be good!</div><p><a title="Go Back Home" href=https://ohdoylerules.com>Go home</a><hr><div class="media grid"><div class=media-left><a class=post-author-link href=https://twitter.com/james2doyle target=_blank> <img alt="James Doyle Profile Picture" src="https://www.gravatar.com/avatar/b7375c88e1864c4ddf0d7bdab58e4cca?s=120&d=mm&r=g" height=120 width=120> </a></div><div class="media-body cell -9of12"><div class=media-heading><h3 itemprop="author publisher creator provider">James Doyle</h3></div><div class=media-content><p>I'm a full-stack developer, co-organizer of <a title="PHP Vancouver" href=https://www.meetup.com/vancouver-php target=_blank>PHP Vancouver</a> meetup, and winner of a <a title="Canadian Developer 30 under 30 award" href=http://www.canadianbusiness.com/innovation/developer-30-under-30-gallery/image/20/ target=_blank>Canadian Developer 30 under 30 award</a>. I'm a huge Open Source advocate and contributor to a lot of projects in my community. When I am not sitting at a computer, I'm trying to perfect some other skill.</div></div></div></article></div></div></main><script defer src=https://unpkg.com/swup@4.8.1/dist/Swup.umd.js></script><script>var handleGists=(()=>{let b=16,c=`px`;const a=document.querySelectorAll(`.iframes`);[...a].forEach((a=>{a.onload=(()=>{a.style.height=a.contentWindow.document.body.scrollHeight+ b+ c});a.style.height=a.contentWindow.document.body.scrollHeight+ b+ c}))});document.addEventListener(`DOMContentLoaded`,(()=>{handleGists();const a=new Swup({native:!0});a.hooks.on(`visit:end`,handleGists,{priority:100})}))</script>