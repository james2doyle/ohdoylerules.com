<!doctype html><html lang=en><head><meta charset=utf-8><meta content=public http-equiv=Cache-control><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1,maximum-scale=5" name=viewport><title>Build A Multi-lingual Laravel Site With Subdomains | OhDoyleRules</title><meta content="Build A Multi-lingual Laravel Site With Subdomains | OhDoyleRules" name=twitter:title><meta content=KM-5h_iJ7JJsGeUp4ncEoYCBKft1ko1A4gBpjIzT0p4 name=google-site-verification><meta content="Build A Multi-lingual Laravel Site With Subdomains" itemprop=name><meta content=OhDoyleRules property=og:site_name><meta content=https://ohdoylerules.com/web/build-a-multi-lingual-laravel-site-with-subdomains/ itemprop=url><meta content=james2doyle@gmail.com itemprop=email><meta content=https://ohdoylerules.com/web/build-a-multi-lingual-laravel-site-with-subdomains/ property=og:url><meta itemprop="image logo" content=/icons/logo.png><meta content=/icons/logo.png property=og:image><link href=/icons/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/icons/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/icons/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=/site.webmanifest rel=manifest><link color=#333333 href=/icons/safari-pinned-tab.svg rel=mask-icon><link href=/icons/favicon.ico rel=icon sizes=any><link href=/icons/favicon.svg rel=icon type=image/svg+xml><meta content=/browserconfig.xml name=msapplication-config><meta content=#ffffff name=msapplication-TileColor><meta content=#ffffff name=theme-color><meta content=summary name=twitter:card><meta content=@james2doyle name=twitter:site><meta content="Build A Multi-lingual Laravel Site With Subdomains" name=twitter:title><meta content=@james2doyle name=twitter:creator><meta content=/icons/logo.png name=twitter:image><meta content=/ name=twitter:domain><link href=/icons/logo.svg rel=icon><meta content="Have you ever wanted to use subdomains in Laravel to control logic, locale, or other functionality? Well, this example might help." name=description><meta content="Have you ever wanted to use subdomains in Laravel to control logic, locale, or other functionality? Well, this example might help." itemprop=description><meta content="Have you ever wanted to use subdomains in Laravel to control logic, locale, or other functionality? Well, this example might help." property=og:description><meta content="Have you ever wanted to use subdomains in Laravel to control logic, locale, or other functionality? Well, this example might help." name=twitter:description><link href=https://c.disquscdn.com rel=dns-prefetch><meta content=article property=og:type><meta content="Build A Multi-lingual Laravel Site With Subdomains | OhDoyleRules" property=og:title><meta content="james2doyle@gmail.com James Doyle" property=article:author><meta content="laravel, php, locale, subdomain, routing, switch, multisite, multilingual, translation" itemprop=keywords><meta content="laravel, php, locale, subdomain, routing, switch, multisite, multilingual, translation" property=article:tag><meta content="laravel, php, locale, subdomain, routing, switch, multisite, multilingual, translation" property=og:keywords><link href=https://www.google-analytics.com rel=dns-prefetch><link rel="shortcut icon" href=/favicon.ico><link href=https://ohdoylerules.com/web/build-a-multi-lingual-laravel-site-with-subdomains/ rel=canonical><link href=https://ohdoylerules.com/atom.xml rel=alternate title=atom type=application/atom+xml><style>body{font-feature-settings:'lnum' 1;font-variant-numeric:slashed-zero;text-rendering:geometricPrecision;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}.post-info{margin-bottom:1rem}a.none{color:inherit;border:none;opacity:1}a.none:hover {background:none;opacity:.6}.center{text-align:center}.center img{max-width:100%;height:auto}pre{color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4}pre code.language-diff span:nth-child(1n + 7){color:#50fa7b}body.dark table.highlight tr:nth-child(even){background-color:#f6f8fa}body.dark table.highlight td,body.dark table.highlight th{border-color:rgba(27,31,35,.3)}html.is-changing .transition-fade{view-transition-name:main}:view-transition-old(main){animation:fade .25s ease-in-out both}:view-transition-new(main){animation:fade .25s ease-in-out both reverse}@keyframes fade{from{opacity:1}to{opacity:0}}html.is-changing:not(.swup-native) .transition-fade {will-change:opacity;transition:.25s opacity;opacity:1}html.is-animating:not(.swup-native) .transition-fade {opacity:0}:root{--nc-font-sans:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,'Open Sans','Helvetica Neue',sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--nc-font-mono:Consolas,monaco,'Ubuntu Mono','Liberation Mono','Courier New',Courier,monospace;--nc-tx-1:#fff;--nc-tx-2:#eee;--nc-bg-1:#000;--nc-bg-2:#111;--nc-bg-3:#222;--nc-lk-1:#3291ff;--nc-lk-2:#0070f3;--nc-lk-tx:#fff;--nc-ac-1:#7928ca;--nc-ac-tx:#fff}@media (prefers-color-scheme:dark){:root{--nc-tx-1:#fff;--nc-tx-2:#eee;--nc-bg-1:#000;--nc-bg-2:#111;--nc-bg-3:#222;--nc-lk-1:#3291ff;--nc-lk-2:#0070f3;--nc-lk-tx:#fff;--nc-ac-1:#7928ca;--nc-ac-tx:#fff}}*{margin:0;padding:0}address,area,article,aside,audio,blockquote,datalist,details,dl,fieldset,figure,form,iframe,img,input,meter,nav,ol,optgroup,option,output,p,pre,progress,ruby,section,table,textarea,ul,video{margin-bottom:1rem}button,html,input,select{font-family:var(--nc-font-sans)}body{margin:0 auto;max-width:750px;padding:2rem;border-radius:6px;overflow-x:hidden;word-break:break-word;overflow-wrap:break-word;background:var(--nc-bg-1);color:var(--nc-tx-2);font-size:1.03rem;line-height:1.5}:selection{background:var(--nc-ac-1);color:var(--nc-ac-tx)}h1,h2,h3,h4,h5,h6{line-height:1;color:var(--nc-tx-1);padding-top:.875rem}h1,h2,h3{color:var(--nc-tx-1);padding-bottom:2px;margin-bottom:8px;border-bottom:1px solid var(--nc-bg-2)}h4,h5,h6{margin-bottom:.3rem}h1{font-size:2.25rem}h2{font-size:1.85rem}h3{font-size:1.55rem}h4{font-size:1.25rem}h5{font-size:1rem}h6{font-size:.875rem}a{color:var(--nc-lk-1)}a:hover{color:var(--nc-lk-2)}abbr:hover{cursor:help}blockquote{padding:1.5rem;background:var(--nc-bg-2);border-left:5px solid var(--nc-bg-3)}abbr{cursor:help}blockquote:last-child{padding-bottom:0;margin-bottom:0}header{background:var(--nc-bg-2);border-bottom:1px solid var(--nc-bg-3);padding:2rem 1.5rem;margin:-2rem calc(0px - (50vw - 50%)) 2rem;padding-left:calc(50vw - 50%);padding-right:calc(50vw - 50%)}header h1,header h2,header h3{padding-bottom:0;border-bottom:0}header>:first-child{margin-top:0;padding-top:0}header>:last-child{margin-bottom:0}a button,button,input[type=button],input[type=reset],input[type=submit]{font-size:1rem;display:inline-block;padding:6px 12px;text-align:center;text-decoration:none;white-space:nowrap;background:var(--nc-lk-1);color:var(--nc-lk-tx);border:0;border-radius:4px;box-sizing:border-box;cursor:pointer}a button[disabled],button[disabled],input[type=button][disabled],input[type=reset][disabled],input[type=submit][disabled]{cursor:not-allowed;opacity:.5}.button:focus,.button:hover,button:focus,button:hover,input[type=button]:focus,input[type=button]:hover,input[type=reset]:focus,input[type=reset]:hover,input[type=submit]:focus,input[type=submit]:hover{background:var(--nc-lk-2)}code,kbd,pre,samp{font-family:var(--nc-font-mono)}code,kbd,pre,samp{background:var(--nc-bg-2);border:1px solid var(--nc-bg-3);border-radius:4px;padding:3px 6px;font-size:.9rem}kbd{border-bottom:3px solid var(--nc-bg-3)}pre{padding:1rem 1.4rem;max-width:100%;overflow:auto}pre code{background:inherit;font-size:inherit;color:inherit;border:0;padding:0;margin:0}code pre{display:inline;background:inherit;font-size:inherit;color:inherit;border:0;padding:0;margin:0}details{padding:.6rem 1rem;background:var(--nc-bg-2);border:1px solid var(--nc-bg-3);border-radius:4px}summary{cursor:pointer;font-weight:700}details[open]{padding-bottom:.75rem}details[open] summary{margin-bottom:6px}details[open]>:last-child{margin-bottom:0}dt{font-weight:700}dd:before{content:'â†’ '}hr{border:0;border-bottom:1px solid var(--nc-bg-3);margin:1rem auto}fieldset{margin-top:1rem;padding:2rem;border:1px solid var(--nc-bg-3);border-radius:4px}legend{padding:auto .5rem}table{border-collapse:collapse;width:100%}td,th{border:1px solid var(--nc-bg-3);text-align:left;padding:.5rem}th{background:var(--nc-bg-2)}tr:nth-child(even){background:var(--nc-bg-2)}table caption{font-weight:700;margin-bottom:.5rem}textarea{max-width:100%}ol,ul{padding-left:2rem}li{margin-top:.4rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}mark{padding:3px 6px;background:var(--nc-ac-1);color:var(--nc-ac-tx)}input,select,textarea{padding:6px 12px;margin-bottom:.5rem;background:var(--nc-bg-2);color:var(--nc-tx-2);border:1px solid var(--nc-bg-3);border-radius:4px;box-shadow:none;box-sizing:border-box}img{max-width:100%}iframe{border:0;width:100%;height:100%;min-height:300px}</style><style media=screen>body .gist table.highlight tr:nth-child(even){background-color:inherit}.gist{font-size:18px}.clone-url-button > .clone-url-link,.gist-file,.gist-meta,.octotree_toggle,a.button,a.minibutton,button.button,button.minibutton,span.button,span.minibutton,ul.comparison-list > li.title{background:linear-gradient(#202020,#181818)!important;border-color:#383838!important;border-radius:0 0 3px 3px!important;text-shadow:none!important;color:#b5b5b5!important}#facebox pre,#notebook .input_area,.CodeMirror,.api code,.api pre,.blob-code-context,.blob-expanded,.copyable-terminal,.highlight,.markdown-body .highlight pre,.markdown-body pre,.markdown-format .highlight pre,.markdown-format code,.markdown-format pre,.terminal,body.blog pre,body.blog pre > code{background-color:#1d1f21!important;color:#c5c8c6!important}.gist .blob-code{padding:1px 10px!important;text-align:left;background:#000;border:0}:selection{background:#24890d;color:#fff;text-shadow:none}:-moz-selection{background:#24890d;color:#fff;text-shadow:none}.blob-num{padding:10px 8px 9px;text-align:right;color:#6b6b6b!important;border:0}.blob-code,.blob-code-inner{color:#c5c8c6!important}.pl-c,.pl-c span{color:#969896!important;font-style:italic!important}.pl-c1{color:#de935f!important}.pl-cce{color:#de935f!important}.pl-cn{color:#de935f!important}.pl-coc{color:#de935f!important}.pl-cos{color:#b5bd68!important}.pl-e{color:#f0c674!important}.pl-ef{color:#f0c674!important}.pl-en{color:#f0c674!important}.pl-enc{color:#de935f!important}.pl-enf{color:#f0c674!important}.pl-enm{color:#f0c674!important}.pl-ens{color:#de935f!important}.pl-ent{color:#b294bb!important}.pl-entc{color:#f0c674!important}.pl-enti{color:#f0c674!important;font-weight:700!important}.pl-entm{color:#c66!important}.pl-eoa{color:#b294bb!important}.pl-eoac{color:#c66!important}.pl-eoac .pl-pde{color:#c66!important}.pl-eoai{color:#b294bb!important}.pl-eoai .pl-pde{color:#b294bb!important}.pl-eoi{color:#f0c674!important}.pl-k{color:#b294bb!important}.pl-ko{color:#b294bb!important}.pl-kolp{color:#b294bb!important}.pl-kos{color:#de935f!important}.pl-kou{color:#de935f!important}.pl-mai .pl-sf{color:#c66!important}.pl-mb{color:#b5bd68!important;font-weight:700!important}.pl-mc{color:#b294bb!important}.pl-mh .pl-pdh{color:#de935f!important}.pl-mi{color:#b294bb!important;font-style:italic!important}.pl-ml{color:#b5bd68!important}.pl-mm{color:#c66!important}.pl-mp{color:#81a2be!important}.pl-mp1 .pl-sf{color:#81a2be!important}.pl-mq{color:#de935f!important}.pl-mr{color:#b294bb!important}.pl-ms{color:#b294bb!important}.pl-pdb{color:#b5bd68!important;font-weight:700!important}.pl-pdc{color:#969896!important;font-style:italic!important}.pl-pdc1{color:#de935f!important}.pl-pde{color:#de935f!important}.pl-pdi{color:#b294bb!important;font-style:italic!important}.pl-pds{color:#b5bd68!important}.pl-pdv{color:#c66!important}.pl-pse{color:#de935f!important}.pl-pse .pl-s2{color:#de935f!important}.pl-s{color:#b294bb!important}.pl-s1{color:#b5bd68!important}.pl-s2{color:#c5c8c6!important}.pl-mp .pl-s3{color:#b294bb!important}.pl-s3{color:#81a2be!important}.pl-sc{color:#c5c8c6!important}.pl-scp{color:#de935f!important}.pl-sf{color:#dad085!important}.pl-smc{color:#f0c674!important}.pl-smi{color:#c5c8c6!important}.pl-smp{color:#c5c8c6!important}.pl-sok{color:#b294bb!important}.pl-sol{color:#b5bd68!important}.pl-som{color:#c66!important}.pl-sr{color:#c66!important}.pl-sra{color:#b294bb!important}.pl-src{color:#b294bb!important}.pl-sre{color:#b294bb!important}.pl-st{color:#b294bb!important}.pl-stj{color:#c5c8c6!important}.pl-stp{color:#de935f!important}.pl-sv{color:#de935f!important}.pl-v{color:#de935f!important}.pl-vi{color:#de935f!important}.pl-vo{color:#c66!important}.pl-vpf{color:#de935f!important}.pl-mi1{color:#8f9d6a!important;background:rgba(0,64,0,.5)!important}.pl-mdht{color:#8f9d6a!important;background:rgba(0,64,0,.5)!important}.pl-md{color:#c66!important;background:rgba(64,0,0,.5)!important}.pl-mdhf{color:#c66!important;background:rgba(64,0,0,.5)!important}.pl-mdr{color:#de935f!important;font-weight:400!important}.pl-mdh{color:#c66!important;font-weight:400!important}.pl-mdi{color:#c66!important;font-weight:400!important}.pl-ib{background-color:#c66!important}.pl-id{background-color:#c66!important;color:#fff!important}.pl-ii{background-color:#c66!important;color:#fff!important}.pl-iu{background-color:#c66!important}.pl-mo{color:#c5c8c6!important}.pl-mri{color:#de935f!important}.pl-ms1{background-color:#c5c8c6!important}.pl-va{color:#de935f!important}.pl-vpu{color:#de935f!important}.pl-entl{color:#c5c8c6!important}.CodeMirror-gutters{background:#222!important;border-right:1px solid #484848!important}.CodeMirror-guttermarker{color:#fff!important}.CodeMirror-guttermarker-subtle{color:#aaa!important}.CodeMirror-linenumber{color:#aaa!important}.CodeMirror-cursor{border-left:1px solid #fff!important}.CodeMirror-activeline-background{background:#27282e!important}.CodeMirror-matchingbracket{outline:1px solid grey!important;color:#fff!important}.cm-keyword{color:#f9ee98!important}.cm-atom{color:#fc0!important}.cm-number{color:#ca7841!important}.cm-def{color:#8da6ce!important}.cm-variable-2,span.cm-tag{color:#607392!important}.cm-variable-3,span.cm-def{color:#607392!important}.cm-operator{color:#cda869!important}.cm-comment{color:#777!important;font-style:italic!important;font-weight:400!important}.cm-string{color:#8f9d6a!important}.cm-string-2{color:#bd6b18!important}.cm-meta{background-color:#141414!important;color:#f7f7f7!important}.cm-builtin{color:#cda869!important}.cm-tag{color:#997643!important}.cm-attribute{color:#d6bb6d!important}.cm-header{color:#ff6400!important}.cm-hr{color:#aeaeae!important}.cm-link{color:#ad9361!important;font-style:italic!important;text-decoration:none!important}.cm-error{border-bottom:1px solid red!important}#notebook .highlight table{background:#1d1f21!important;color:#c5c8c6!important}.highlight .hll{background-color:#373b41!important}.highlight .c{color:#969896!important}.highlight .err{color:#c66!important}.highlight .k{color:#b294bb!important}.highlight .l{color:#de935f!important}.highlight .h,.highlight .n{color:#c5c8c6!important}.highlight .o{color:#8abeb7!important}.highlight .p{color:#c5c8c6!important}.highlight .cm{color:#969896!important}.highlight .cp{color:#969896!important}.highlight .c1{color:#969896!important}.highlight .cs{color:#969896!important}.highlight .gd{color:#c66!important}.highlight .ge{font-style:italic!important}.highlight .gh{color:#c5c8c6!important;font-weight:700!important}.highlight .gi{color:#b5bd68!important}.highlight .gp{color:#969896!important;font-weight:700!important}.highlight .gs{font-weight:700!important}.highlight .gu{color:#8abeb7!important;font-weight:700!important}.highlight .kc{color:#b294bb!important}.highlight .kd{color:#b294bb!important}.highlight .kn{color:#8abeb7!important}.highlight .kp{color:#b294bb!important}.highlight .kr{color:#b294bb!important}.highlight .kt{color:#f0c674!important}.highlight .ld{color:#b5bd68!important}.highlight .m{color:#de935f!important}.highlight .s{color:#b5bd68!important}.highlight .na{color:#81a2be!important}.highlight .nb{color:#c5c8c6!important}.highlight .nc{color:#f0c674!important}.highlight .no{color:#c66!important}.highlight .nd{color:#8abeb7!important}.highlight .ni{color:#c5c8c6!important}.highlight .ne{color:#c66!important}.highlight .nf{color:#81a2be!important}.highlight .nl{color:#c5c8c6!important}.highlight .nn{color:#f0c674!important}.highlight .nx{color:#81a2be!important}.highlight .py{color:#c5c8c6!important}.highlight .nt{color:#8abeb7!important}.highlight .nv{color:#c66!important}.highlight .ow{color:#8abeb7!important}.highlight .w{color:#c5c8c6!important}.highlight .mf{color:#de935f!important}.highlight .mh{color:#de935f!important}.highlight .mi{color:#de935f!important}.highlight .mo{color:#de935f!important}.highlight .sb{color:#b5bd68!important}.highlight .sc{color:#c5c8c6!important}.highlight .sd{color:#969896!important}.highlight .s2{color:#b5bd68!important}.highlight .se{color:#de935f!important}.highlight .sh{color:#b5bd68!important}.highlight .si{color:#de935f!important}.highlight .sx{color:#b5bd68!important}.highlight .sr{color:#b5bd68!important}.highlight .s1{color:#b5bd68!important}.highlight .ss{color:#b5bd68!important}.highlight .bp{color:#c5c8c6!important}.highlight .vc{color:#c66!important}.highlight .vg{color:#c66!important}.highlight .vi{color:#c66!important}.highlight .il{color:#de935f!important}</style><body><div class="container transition-fade" id=swup><div itemscope itemtype=http://schema.org/BlogPosting><div class=container><header class="grid center"><div class="cell menu"><h1 itemprop="name headline">Build A Multi-lingual Laravel Site With Subdomains</h1></div></header><p><a title="Go Back Home" href=https://ohdoylerules.com>Go home</a><div class=the-loop><p class=post-info><span class=post-date itemprop=datePublished>ðŸ•’Â Â <span>August 25, 2019</span></span><div itemprop="ArticleBody text" class=main-content><p>OK, so you want to make Laravel a multi-lingual (or just multi-functional) site based off the subdomain? Cool. Must be an interesting project.<p>In order to test this on local development, we are going to use <a rel="noopener nofollow noreferrer" href=https://laravel.com/docs/5.8/valet target=_blank>Valet</a>. Let's say our Laravel project folder is in <code>~/Sites/multisite</code>. We can use that as our base path moving forward. With Valet, we can set up subdomains with <code>valet link</code>.<p>I'm going to pretend that we want to add support for a new subdomain for the French version of our site. I'm also going to assume that your valet TLD is <code>.localhost</code> and your project is called <code>multisite.localhost</code>. The domain we are adding in this case, it will be <code>fr.multisite.localhost</code>.<p>So in order to get that subdomain setup locally, we just go to our site folder and run <code>valet link fr.multisite</code>. This will allow <code>fr.multisite.localhost</code> to route to the same Laravel setup as <code>multisite.localhost</code>. Beauty!<p>Well, first things first. Let's make a helper to grab the subdomain from the request. This will come in handy for a lot of the future logic switching or setting application state on a per-request basis.<p>Let's use a <code>macro</code> to add a new method to the <code>Request</code>:<pre class=language-diff data-lang=diff style=background:#2b303b;color:#c0c5ce><code class=language-diff data-lang=diff><span>--- a/app/Providers/AppServiceProvider.php
</span><span>+++ b/app/Providers/AppServiceProvider.php
</span><span>@@ -3,6 +3,7 @@
</span><span> namespace App\Providers;
</span><span>
</span><span> use Illuminate\Support\ServiceProvider;
</span><span style=color:#a3be8c>+use Illuminate\Http\Request;
</span><span>
</span><span> class AppServiceProvider extends ServiceProvider
</span><span> {
</span><span>@@ -13,7 +14,14 @@ </span><span style=color:#8fa1b3>class AppServiceProvider extends ServiceProvider
</span><span>      */
</span><span>     public function register()
</span><span>     {
</span><span style=color:#bf616a>-        //
</span><span style=color:#a3be8c>+        // nice helper for getting the current subdomain
</span><span style=color:#a3be8c>+        Request::macro('subdomain', function () {
</span><span style=color:#a3be8c>+            $domain = request()->server->get('HTTP_HOST');
</span><span style=color:#a3be8c>+            $split = explode('.', $domain, 3);
</span><span style=color:#a3be8c>+
</span><span style=color:#a3be8c>+            // get the subdomain or return null
</span><span style=color:#a3be8c>+            return array_get($split, '0', '');
</span><span style=color:#a3be8c>+        });
</span><span>     }
</span></code></pre><p>Now any "request" instance will have a new <code>subdomain</code> method that we can call.<p>We need a way to organize the details of each domain. We can use a <code>config</code> for this. So we are going to make a new one and fill it with some details:<pre class=language-diff data-lang=diff style=background:#2b303b;color:#c0c5ce><code class=language-diff data-lang=diff><span>--- /dev/null
</span><span>+++ b/config/multisite.php
</span><span>@@ -0,0 +1,25 @@
</span><span style=color:#a3be8c>+&LT?php
</span><span style=color:#a3be8c>+
</span><span style=color:#a3be8c>+return [
</span><span style=color:#a3be8c>+    // we are going to set this in a future middleware
</span><span style=color:#a3be8c>+    'active' => null,
</span><span style=color:#a3be8c>+    'sites' => [
</span><span style=color:#a3be8c>+        'en' => [
</span><span style=color:#a3be8c>+            'default' => true,
</span><span style=color:#a3be8c>+            'locale' => 'en',
</span><span style=color:#a3be8c>+            'domain' => 'http://multisite.localhost',
</span><span style=color:#a3be8c>+            'label' => 'English',
</span><span style=color:#a3be8c>+        ],
</span><span style=color:#a3be8c>+        'fr' => [
</span><span style=color:#a3be8c>+            'locale' => 'fr',
</span><span style=color:#a3be8c>+            'domain' => 'http://fr.multisite.localhost',
</span><span style=color:#a3be8c>+            'label' => 'FranÃ§ais',
</span><span style=color:#a3be8c>+        ],
</span><span style=color:#a3be8c>+    ],
</span><span style=color:#a3be8c>+];
</span></code></pre><p>Now, we need a way to map the requested domain to the correct locale. We take in our subdomain and then map it to the correct config item. In order to make this happen, we need to make a middleware. A middleware manipulates the request as it moves through our app. We aren't going to manipulate the request, we are just going to use the details in the request to set up more config settings.<p>Here we go:<pre class=language-diff data-lang=diff style=background:#2b303b;color:#c0c5ce><code class=language-diff data-lang=diff><span>--- /dev/null
</span><span>+++ b/app/Http/Middleware/MultisiteMiddleware.php
</span><span>@@ -0,0 +1,36 @@
</span><span style=color:#a3be8c>+&LT?php
</span><span style=color:#a3be8c>+
</span><span style=color:#a3be8c>+namespace App\Http\Middleware;
</span><span style=color:#a3be8c>+
</span><span style=color:#a3be8c>+use Illuminate\Support\Facades\App;
</span><span style=color:#a3be8c>+use Closure;
</span><span style=color:#a3be8c>+
</span><span style=color:#a3be8c>+class MultisiteMiddleware
</span><span style=color:#a3be8c>+{
</span><span style=color:#a3be8c>+    /**
</span><span style=color:#a3be8c>+     * Handle an incoming request.
</span><span style=color:#a3be8c>+     *
</span><span style=color:#a3be8c>+     * @param  \Illuminate\Http\Request  $request
</span><span style=color:#a3be8c>+     * @param  \Closure  $next
</span><span style=color:#a3be8c>+     * @return mixed
</span><span style=color:#a3be8c>+     */
</span><span style=color:#a3be8c>+    public function handle($request, Closure $next)
</span><span style=color:#a3be8c>+    {
</span><span style=color:#a3be8c>+        $sites = collect(config('multisite.sites'));
</span><span style=color:#a3be8c>+
</span><span style=color:#a3be8c>+        $defaultSite = $sites->firstWhere('default', true);
</span><span style=color:#a3be8c>+
</span><span style=color:#a3be8c>+        $currentSite = $sites->get($request->subdomain(), $defaultSite);
</span><span style=color:#a3be8c>+
</span><span style=color:#a3be8c>+        // put this subdomain in the `env`
</span><span style=color:#a3be8c>+        putenv('SUBDOMAIN=' . $currentSite['domain']);
</span><span style=color:#a3be8c>+
</span><span style=color:#a3be8c>+        // make it easier to access the current site config
</span><span style=color:#a3be8c>+        config()->set('multisite.active', $currentSite);
</span><span style=color:#a3be8c>+
</span><span style=color:#a3be8c>+        // finally, set the app locale so translations load correctly
</span><span style=color:#a3be8c>+        App::setLocale($currentSite['locale']);
</span><span style=color:#a3be8c>+
</span><span style=color:#a3be8c>+        return $next($request);
</span><span style=color:#a3be8c>+    }
</span><span style=color:#a3be8c>+}
</span></code></pre><p>We got our new middleware, so we can enable it in the HTTP kernel array:<pre class=language-diff data-lang=diff style=background:#2b303b;color:#c0c5ce><code class=language-diff data-lang=diff><span>--- a/app/Http/Kernel.php
</span><span>+++ b/app/Http/Kernel.php
</span><span>@@ -14,6 +14,7 @@ </span><span style=color:#8fa1b3>class Kernel extends HttpKernel
</span><span>      * @var array
</span><span>      */
</span><span>     protected $middleware = [
</span><span style=color:#a3be8c>+        \App\Http\Middleware\MultisiteMiddleware::class,
</span><span>         \App\Http\Middleware\TrustProxies::class,
</span><span>         \App\Http\Middleware\CheckForMaintenanceMode::class,
</span><span>         \Illuminate\Foundation\Http\Middleware\ValidatePostSize::class,
</span></code></pre><p>Great! When we make requests now, the <code>config('multisite.active')</code> is going to return a matched value from the multisite config. If the subdomain doesn't match, it will just return the default site config. In our case, the <code>en</code> one.<p>Since we are setting the locale, we are going to need to make sure there are translations available for all our text. We do this by adding new language files. These files are PHP files that just return plain arrays. These files go under <code>resources/lang/{locale}</code>. So for English (locale is <code>en</code>) we put our files under <code>resources/lang/en</code> and for French (or <code>fr</code>), we put the files under <code>resources/lang/fr</code>.<pre class=language-diff data-lang=diff style=background:#2b303b;color:#c0c5ce><code class=language-diff data-lang=diff><span>--- /dev/null
</span><span>+++ b/resources/lang/en/multisite.php
</span><span>@@ -0,0 +1,11 @@
</span><span style=color:#a3be8c>+&LT?php
</span><span style=color:#a3be8c>+
</span><span style=color:#a3be8c>+return [
</span><span style=color:#a3be8c>+    'site_title' => 'English Multisite',
</span><span style=color:#a3be8c>+    'site_label' => 'English',
</span><span style=color:#a3be8c>+    'welcome' => 'Welcome',
</span><span style=color:#a3be8c>+    'welcome_message' => 'Welcome to the site. You can change the locale by changing to a supported subdomain.',
</span><span style=color:#a3be8c>+    'switch_site' => 'Switch site',
</span><span style=color:#a3be8c>+];
</span></code></pre><pre class=language-diff data-lang=diff style=background:#2b303b;color:#c0c5ce><code class=language-diff data-lang=diff><span>--- /dev/null
</span><span>+++ b/resources/lang/fr/multisite.php
</span><span>@@ -0,0 +1,11 @@
</span><span style=color:#a3be8c>+&LT?php
</span><span style=color:#a3be8c>+
</span><span style=color:#a3be8c>+return [
</span><span style=color:#a3be8c>+    'site_title' => 'Multisite FranÃ§ais',
</span><span style=color:#a3be8c>+    'site_label' => 'FranÃ§ais',
</span><span style=color:#a3be8c>+    'welcome' => 'Bienvenue',
</span><span style=color:#a3be8c>+    'welcome_message' => 'Bienvenue sur le site. Vous pouvez changer les paramÃ¨tres rÃ©gionaux avec le sous-domaine.',
</span><span style=color:#a3be8c>+    'switch_site' => 'Changer de site',
</span><span style=color:#a3be8c>+];
</span></code></pre><p>We access these files in a similar way to a <code>config</code> value. We can use the <code>trans</code> function, or we can use the <code>@lang</code> blade directive. Either way, they take a string that represents the path to our array value that we want.<p>So, if I want to display the <code>site_title</code> from our <code>resources/lang/{locale}/multisite.php</code>, I would need to run <code>trans('multisite.site_title')</code>. Laravel will take care of the rest. If we are in a valid locale, great! We will get the correct language. If we are missing a translation for that key, it will fallback to whatever locale we have set in the <code>config/app.php</code> under the <code>fallback_locale</code> key. The default is <code>en</code>.<p>So how about the javascript side? How do we deal with JSON when working with this setup?<h4 id=javascript-and-json>JavaScript and JSON</h4><p>Well, if we set things up correctly, the domain should set the locale for us and as long as the URL is correct, we should be good to go!<p>We need to add an endpoint to get our JSON from. Let's just toss it into <code>routes/web.php</code> because we are animals like that:<pre class=language-diff data-lang=diff style=background:#2b303b;color:#c0c5ce><code class=language-diff data-lang=diff><span>--- a/routes/web.php
</span><span>+++ b/routes/web.php
</span><span>@@ -14,3 +14,7 @@
</span><span> Route::get('/', function () {
</span><span>     return view('welcome');
</span><span> });
</span><span style=color:#a3be8c>+
</span><span style=color:#a3be8c>+Route::get('/locale', function () {
</span><span style=color:#a3be8c>+    return response()->json(config('multisite.active'), 200);
</span><span style=color:#a3be8c>+});
</span></code></pre><p>Here, you can see we are just returning whatever the active site is. This will be a JSON object of the active site config. Nice!<h4 id=in-summation>In Summation</h4><p>Finally, let's update the <code>welcome.blade.php</code> just so we can see our changes in progress:<pre class=language-html data-lang=html style=background:#2b303b;color:#c0c5ce><code class=language-html data-lang=html><span>&LT!</span><span style=color:#b48ead>DOCTYPE </span><span style=color:#d08770>html</span><span>>
</span><span><</span><span style=color:#bf616a>html </span><span style=color:#d08770>lang</span><span>="</span><span style=color:#a3be8c>{{ str_replace('_', '-', app()->getLocale()) }}</span><span>">
</span><span>    <</span><span style=color:#bf616a>head</span><span>>
</span><span>        <</span><span style=color:#bf616a>meta </span><span style=color:#d08770>charset</span><span>="</span><span style=color:#a3be8c>utf-8</span><span>">
</span><span>        <</span><span style=color:#bf616a>meta </span><span style=color:#d08770>name</span><span>="</span><span style=color:#a3be8c>viewport</span><span>" </span><span style=color:#d08770>content</span><span>="</span><span style=color:#a3be8c>width=device-width, initial-scale=1</span><span>">
</span><span>        <</span><span style=color:#bf616a>title</span><span>>@lang('multisite.site_title')&LT/</span><span style=color:#bf616a>title</span><span>>
</span><span>    &LT/</span><span style=color:#bf616a>head</span><span>>
</span><span>    <</span><span style=color:#bf616a>body</span><span>>
</span><span>        <</span><span style=color:#bf616a>p</span><span>>
</span><span>            @foreach (config('multisite.sites') as $site)
</span><span>                <</span><span style=color:#bf616a>a </span><span style=color:#d08770>href</span><span>="</span><span style=color:#a3be8c>{{ $site['domain'] }}</span><span>">{{ $site['label'] }}&LT/</span><span style=color:#bf616a>a</span><span>>
</span><span>            @endforeach
</span><span>        &LT/</span><span style=color:#bf616a>p</span><span>>
</span><span>        <</span><span style=color:#bf616a>h1</span><span>>@lang('multisite.welcome')&LT/</span><span style=color:#bf616a>h1</span><span>>
</span><span>        <</span><span style=color:#bf616a>p</span><span>>@lang('multisite.welcome_message')&LT/</span><span style=color:#bf616a>p</span><span>>
</span><span>
</span><span>        <</span><span style=color:#bf616a>pre </span><span style=color:#8fa1b3>id</span><span>="</span><span style=color:#a3be8c>ajax</span><span>">&LT/</span><span style=color:#bf616a>pre</span><span>>
</span><span>
</span><span>        <</span><span style=color:#bf616a>script</span><span>>
</span><span>            document.</span><span style=color:#bf616a>addEventListener</span><span>('</span><span style=color:#a3be8c>DOMContentLoaded</span><span>', () </span><span style=color:#b48ead>=> </span><span>{
</span><span>                </span><span style=color:#65737e>// call that endpoint we created in our route
</span><span>                </span><span style=color:#bf616a>fetch</span><span>('</span><span style=color:#a3be8c>/locale</span><span>', {
</span><span>                    credentials: '</span><span style=color:#a3be8c>include</span><span>',
</span><span>                    headers: {
</span><span>                        accept: '</span><span style=color:#a3be8c>application/json</span><span>',
</span><span>                        </span><span style=color:#65737e>// make sure we set the language explicitly
</span><span>                        '</span><span style=color:#a3be8c>accept-language</span><span>': document.documentElement.lang
</span><span>                    }
</span><span>                })
</span><span>                </span><span style=color:#65737e>// do the fetch dance...
</span><span>                .</span><span style=color:#bf616a>then</span><span>((res) </span><span style=color:#b48ead>=> </span><span style=color:#bf616a>res</span><span>.</span><span style=color:#bf616a>json</span><span>())
</span><span>                .</span><span style=color:#bf616a>then</span><span>((data) </span><span style=color:#b48ead>=> </span><span>{
</span><span>                    </span><span style=color:#b48ead>const </span><span style=color:#bf616a>ajaxField </span><span>= document.</span><span style=color:#bf616a>getElementById</span><span>('</span><span style=color:#a3be8c>ajax</span><span>');
</span><span>
</span><span>                    </span><span style=color:#65737e>// prepend this to the output
</span><span>                    </span><span style=color:#bf616a>ajaxField</span><span>.innerHTML = '</span><span style=color:#a3be8c>// loaded via ajax</span><span style=color:#96b5b4>\n</span><span>';
</span><span>                    </span><span style=color:#65737e>// put our JSON in but format it with 2 spaces
</span><span>                    </span><span style=color:#bf616a>ajaxField</span><span>.innerHTML += JSON.</span><span style=color:#96b5b4>stringify</span><span>(</span><span style=color:#bf616a>data</span><span>, </span><span style=color:#d08770>null</span><span>, </span><span style=color:#d08770>2</span><span>);
</span><span>                });
</span><span>            });
</span><span>        &LT/</span><span style=color:#bf616a>script</span><span>>
</span><span>    &LT/</span><span style=color:#bf616a>body</span><span>>
</span><span>&LT/</span><span style=color:#bf616a>html</span><span>>
</span></code></pre><p>We should see something like this when we load up <code>multisite.localhost</code>:<div class=center><a title="laravel multi-lingual site demo" href=/images/multisite-demo.gif target=_blank><img alt="laravel multi-lingual site demo" src=/images/multisite-demo.gif></a></div><p>Wow! Amazing. So it works! Very nice. We now have the basis for a multilingual site based completely off subdomains and we didn't need to install any packages or do any weird magic!</div><p><a title="Go Back Home" href=https://ohdoylerules.com>Go home</a><hr><div class="media grid"><div class=media-left><a class=post-author-link href=https://twitter.com/james2doyle target=_blank> <img alt="James Doyle Profile Picture" src="https://www.gravatar.com/avatar/b7375c88e1864c4ddf0d7bdab58e4cca?s=120&d=mm&r=g" height=120 width=120> </a></div><div class="media-body cell -9of12"><div class=media-heading><h3 itemprop="author publisher creator provider">James Doyle</h3></div><div class=media-content><p>I'm a full-stack developer, co-organizer of <a title="PHP Vancouver" href=https://www.meetup.com/vancouver-php target=_blank>PHP Vancouver</a> meetup, and winner of a <a title="Canadian Developer 30 under 30 award" href=http://www.canadianbusiness.com/innovation/developer-30-under-30-gallery/image/20/ target=_blank>Canadian Developer 30 under 30 award</a>. I'm a huge Open Source advocate and contributor to a lot of projects in my community. When I am not sitting at a computer, I'm trying to perfect some other skill.</div></div></div><hr><div id=disqus_thread itemprop=comment></div><script>(function(){var a=document.createElement('script');a.type='text/javascript';a.async=true;a.src='//ohdoylerules.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a class=dsq-brlink href=https://disqus.com>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></div></div><script src=https://unpkg.com/swup@4.6.1/dist/Swup.umd.js></script><script>const swup=new Swup({native:true});function handleGists(){const a=document.querySelectorAll('.iframes');[...a].forEach(function(b){b.onload=function(){b.style.height=b.contentWindow.document.body.scrollHeight+ 'px'};b.style.height=b.contentWindow.document.body.scrollHeight+ 'px'})}document.addEventListener('DOMContentLoaded',handleGists);swup.hooks.on('visit:end',handleGists,{priority:100})</script>