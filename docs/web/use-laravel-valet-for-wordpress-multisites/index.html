<!doctype html><html lang=en><head><meta charset=utf-8><meta content=public http-equiv=Cache-control><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1,maximum-scale=5" name=viewport><title>Use Laravel Valet for WordPress Multisites | OhDoyleRules</title><meta content="Use Laravel Valet for WordPress Multisites | OhDoyleRules" name=twitter:title><meta content=KM-5h_iJ7JJsGeUp4ncEoYCBKft1ko1A4gBpjIzT0p4 name=google-site-verification><meta content="Use Laravel Valet for WordPress Multisites" itemprop=name><meta content=OhDoyleRules property=og:site_name><meta content=https://ohdoylerules.com/web/use-laravel-valet-for-wordpress-multisites/ itemprop=url><meta content=james2doyle@gmail.com itemprop=email><meta content=https://ohdoylerules.com/web/use-laravel-valet-for-wordpress-multisites/ property=og:url><meta itemprop="image logo" content=/icons/logo.png><meta content=/icons/logo.png property=og:image><link href=/icons/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/icons/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/icons/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=/site.webmanifest rel=manifest><link color=#333333 href=/icons/safari-pinned-tab.svg rel=mask-icon><link href=/icons/favicon.ico rel=icon sizes=any><link href=/icons/favicon.svg rel=icon type=image/svg+xml><meta content=/browserconfig.xml name=msapplication-config><meta content=#ffffff name=msapplication-TileColor><meta content=#ffffff name=theme-color><meta content=summary name=twitter:card><meta content=@james2doyle name=twitter:site><meta content="Use Laravel Valet for WordPress Multisites" name=twitter:title><meta content=@james2doyle name=twitter:creator><meta content=/icons/logo.png name=twitter:image><meta content=/ name=twitter:domain><link href=/icons/logo.svg rel=icon><meta content="Use Laravel Valet for developing local WordPress multisites" name=description><meta content="Use Laravel Valet for developing local WordPress multisites" itemprop=description><meta content="Use Laravel Valet for developing local WordPress multisites" property=og:description><meta content="Use Laravel Valet for developing local WordPress multisites" name=twitter:description><link href=https://c.disquscdn.com rel=dns-prefetch><meta content=article property=og:type><meta content="Use Laravel Valet for WordPress Multisites | OhDoyleRules" property=og:title><meta content="james2doyle@gmail.com James Doyle" property=article:author><meta content="laravel, valet, php, subdomain, wordpress, multisite, setup" itemprop=keywords><meta content="laravel, valet, php, subdomain, wordpress, multisite, setup" property=article:tag><meta content="laravel, valet, php, subdomain, wordpress, multisite, setup" property=og:keywords><link href=https://www.google-analytics.com rel=dns-prefetch><link rel="shortcut icon" href=/favicon.ico><link href=https://ohdoylerules.com/web/use-laravel-valet-for-wordpress-multisites/ rel=canonical><link href=https://ohdoylerules.com/atom.xml rel=alternate title=atom type=application/atom+xml><style>body{font-feature-settings:'lnum' 1;font-variant-numeric:slashed-zero;text-rendering:geometricPrecision;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}.post-info{margin-bottom:1rem}a.none{color:inherit;border:none;opacity:1}a.none:hover {background:none;opacity:.6}.center{text-align:center}html.is-changing .transition-fade{view-transition-name:main}:view-transition-old(main){animation:fade .25s ease-in-out both}:view-transition-new(main){animation:fade .25s ease-in-out both reverse}@keyframes fade{from{opacity:1}to{opacity:0}}html.is-changing:not(.swup-native) .transition-fade {will-change:opacity;transition:.25s opacity;opacity:1}html.is-animating:not(.swup-native) .transition-fade {opacity:0}:root{--nc-font-sans:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,'Open Sans','Helvetica Neue',sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--nc-font-mono:Consolas,monaco,'Ubuntu Mono','Liberation Mono','Courier New',Courier,monospace;--nc-tx-1:#fff;--nc-tx-2:#eee;--nc-bg-1:#000;--nc-bg-2:#111;--nc-bg-3:#222;--nc-lk-1:#3291ff;--nc-lk-2:#0070f3;--nc-lk-tx:#fff;--nc-ac-1:#7928ca;--nc-ac-tx:#fff}@media (prefers-color-scheme:dark){:root{--nc-tx-1:#fff;--nc-tx-2:#eee;--nc-bg-1:#000;--nc-bg-2:#111;--nc-bg-3:#222;--nc-lk-1:#3291ff;--nc-lk-2:#0070f3;--nc-lk-tx:#fff;--nc-ac-1:#7928ca;--nc-ac-tx:#fff}}*{margin:0;padding:0}address,area,article,aside,audio,blockquote,datalist,details,dl,fieldset,figure,form,iframe,img,input,meter,nav,ol,optgroup,option,output,p,pre,progress,ruby,section,table,textarea,ul,video{margin-bottom:1rem}button,html,input,select{font-family:var(--nc-font-sans)}body{margin:0 auto;max-width:750px;padding:2rem;border-radius:6px;overflow-x:hidden;word-break:break-word;overflow-wrap:break-word;background:var(--nc-bg-1);color:var(--nc-tx-2);font-size:1.03rem;line-height:1.5}:selection{background:var(--nc-ac-1);color:var(--nc-ac-tx)}h1,h2,h3,h4,h5,h6{line-height:1;color:var(--nc-tx-1);padding-top:.875rem}h1,h2,h3{color:var(--nc-tx-1);padding-bottom:2px;margin-bottom:8px;border-bottom:1px solid var(--nc-bg-2)}h4,h5,h6{margin-bottom:.3rem}h1{font-size:2.25rem}h2{font-size:1.85rem}h3{font-size:1.55rem}h4{font-size:1.25rem}h5{font-size:1rem}h6{font-size:.875rem}a{color:var(--nc-lk-1)}a:hover{color:var(--nc-lk-2)}abbr:hover{cursor:help}blockquote{padding:1.5rem;background:var(--nc-bg-2);border-left:5px solid var(--nc-bg-3)}abbr{cursor:help}blockquote:last-child{padding-bottom:0;margin-bottom:0}header{background:var(--nc-bg-2);border-bottom:1px solid var(--nc-bg-3);padding:2rem 1.5rem;margin:-2rem calc(0px - (50vw - 50%)) 2rem;padding-left:calc(50vw - 50%);padding-right:calc(50vw - 50%)}header h1,header h2,header h3{padding-bottom:0;border-bottom:0}header>:first-child{margin-top:0;padding-top:0}header>:last-child{margin-bottom:0}a button,button,input[type=button],input[type=reset],input[type=submit]{font-size:1rem;display:inline-block;padding:6px 12px;text-align:center;text-decoration:none;white-space:nowrap;background:var(--nc-lk-1);color:var(--nc-lk-tx);border:0;border-radius:4px;box-sizing:border-box;cursor:pointer}a button[disabled],button[disabled],input[type=button][disabled],input[type=reset][disabled],input[type=submit][disabled]{cursor:not-allowed;opacity:.5}.button:focus,.button:hover,button:focus,button:hover,input[type=button]:focus,input[type=button]:hover,input[type=reset]:focus,input[type=reset]:hover,input[type=submit]:focus,input[type=submit]:hover{background:var(--nc-lk-2)}code,kbd,pre,samp{font-family:var(--nc-font-mono)}code,kbd,pre,samp{background:var(--nc-bg-2);border:1px solid var(--nc-bg-3);border-radius:4px;padding:3px 6px;font-size:.9rem}kbd{border-bottom:3px solid var(--nc-bg-3)}pre{padding:1rem 1.4rem;max-width:100%;overflow:auto}pre code{background:inherit;font-size:inherit;color:inherit;border:0;padding:0;margin:0}code pre{display:inline;background:inherit;font-size:inherit;color:inherit;border:0;padding:0;margin:0}details{padding:.6rem 1rem;background:var(--nc-bg-2);border:1px solid var(--nc-bg-3);border-radius:4px}summary{cursor:pointer;font-weight:700}details[open]{padding-bottom:.75rem}details[open] summary{margin-bottom:6px}details[open]>:last-child{margin-bottom:0}dt{font-weight:700}dd:before{content:'â†’ '}hr{border:0;border-bottom:1px solid var(--nc-bg-3);margin:1rem auto}fieldset{margin-top:1rem;padding:2rem;border:1px solid var(--nc-bg-3);border-radius:4px}legend{padding:auto .5rem}table{border-collapse:collapse;width:100%}td,th{border:1px solid var(--nc-bg-3);text-align:left;padding:.5rem}th{background:var(--nc-bg-2)}tr:nth-child(even){background:var(--nc-bg-2)}table caption{font-weight:700;margin-bottom:.5rem}textarea{max-width:100%}ol,ul{padding-left:2rem}li{margin-top:.4rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}mark{padding:3px 6px;background:var(--nc-ac-1);color:var(--nc-ac-tx)}input,select,textarea{padding:6px 12px;margin-bottom:.5rem;background:var(--nc-bg-2);color:var(--nc-tx-2);border:1px solid var(--nc-bg-3);border-radius:4px;box-shadow:none;box-sizing:border-box}img{max-width:100%}iframe{border:0;width:100%;height:100%;min-height:300px}</style><style>.center img{max-width:100%;height:auto}pre{color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4}pre code.language-diff span:nth-child(1n + 7){color:#50fa7b}article blockquote p{margin-bottom:0}body table.highlight tr:nth-child(even){background-color:inherit}@media (prefers-color-scheme: dark){.gist-iframe{filter:invert(1) hue-rotate(180deg) brightness(1)}body table.highlight tr:nth-child(even){background-color:#f6f8fa}body table.highlight td,body table.highlight th{border-color:rgba(27,31,35,.3)}}</style><body><main class="container transition-fade" id=swup><div itemscope itemtype=http://schema.org/BlogPosting><div class=container><header class="grid center"><div class="cell menu"><h1 itemprop="name headline">Use Laravel Valet for WordPress Multisites</h1></div></header><p><a title="Go Back Home" href=https://ohdoylerules.com>Go home</a><article class=the-loop><p class=post-info><span class=post-date itemprop=datePublished>ðŸ•’Â Â <span>September 01, 2019</span></span><div itemprop="ArticleBody text" class=main-content><p>Working with WordPress multisites can sometimes be a pain. Especially if you are not using the amazing <a rel="noopener nofollow noreferrer" href=https://laravel.com/docs/6.0/valet target=_blank>Laravel Valet</a> tool to manage your local sites.<p>From the site:<blockquote><p>Valet is a Laravel (or any site really) development environment for Mac minimalists. No Vagrant, no /etc/hosts file.</blockquote><p>I would add that everything can be managed from the command line as well. Very handy.<p>I'm going to make some assumptions for the rest of the post. Firstly, you already have a WordPress multisite setup at <code>~/Sites/my-blog</code> (or wherever your root folder is) that is already resolving with <code>my-blog.localhost</code>. The TLD (in my case <code>.localhost</code>) is not important either. Just imagine yours there instead.<p>We are going to want to add a new domain name that resolves to the exact same folder as our current blog setup. We can do that with <code>valet link</code>.<p>So let's run some commands:<ul><li><code>cd ~/Sites/my-blog</code><li><code>valet link my-other-blog.localhost</code></ul><p>Now we have 2 domains pointing to the same folder:<ul><li><code>my-blog.localhost</code><li><code>my-other-blog.localhost</code></ul><p>They are both going to resolve to the same site right now. That's OK. We need to tweak our <code>wp-config.php</code> to work properly with the requests.<p>If we have multisite already setup, we should see some sites in the <code>wp_blogs</code> table of our database. We want each of these "sites" to reflect the domains on our system. You can update those now and make sure that the domains match the ones we are setting up.<p>Then we need to update our <code>wp-config.php</code> with some changes:<pre class=language-php data-lang=php style=background:#2b303b;color:#c0c5ce><code class=language-php data-lang=php><span style=color:#ab7967>&LT?php
</span><span style=color:#65737e>// wp-config.php
</span><span>
</span><span style=color:#65737e>// ... there is going to be other stuff in here at the top...
</span><span>
</span><span style=color:#65737e>// check for HTTPS since valet makes it easy to add HTTPS locally...
</span><span>$</span><span style=color:#bf616a>protocol </span><span>= </span><span style=color:#96b5b4>isset</span><span>($</span><span style=color:#bf616a>_SERVER</span><span>['</span><span style=color:#a3be8c>HTTPS</span><span>']) && $</span><span style=color:#bf616a>_SERVER</span><span>['</span><span style=color:#a3be8c>HTTPS</span><span>'] === '</span><span style=color:#a3be8c>on</span><span>' ? '</span><span style=color:#a3be8c>https://</span><span>' : '</span><span style=color:#a3be8c>http://</span><span>';
</span><span>
</span><span style=color:#65737e>// set the home vars based on the domain that is being used for this request
</span><span style=color:#96b5b4>define</span><span>('</span><span style=color:#a3be8c>WP_HOME</span><span>', $</span><span style=color:#bf616a>protocol </span><span>. $</span><span style=color:#bf616a>_SERVER</span><span>['</span><span style=color:#a3be8c>HTTP_HOST</span><span>']);
</span><span style=color:#96b5b4>define</span><span>('</span><span style=color:#a3be8c>WP_SITEURL</span><span>', </span><span style=color:#d08770>WP_HOME</span><span>);
</span><span>
</span><span style=color:#65737e>// multisite settings, should be the same
</span><span style=color:#96b5b4>define</span><span>('</span><span style=color:#a3be8c>WP_ALLOW_MULTISITE</span><span>', </span><span style=color:#d08770>true</span><span>);
</span><span style=color:#96b5b4>define</span><span>('</span><span style=color:#a3be8c>MULTISITE</span><span>', </span><span style=color:#d08770>true</span><span>);
</span><span>
</span><span style=color:#65737e>// grab the domain from the request and just set it as the current site
</span><span style=color:#96b5b4>define</span><span>('</span><span style=color:#a3be8c>DOMAIN_CURRENT_SITE</span><span>', $</span><span style=color:#bf616a>_SERVER</span><span>['</span><span style=color:#a3be8c>HTTP_HOST</span><span>']);
</span><span>
</span><span style=color:#65737e>// we get the IDs from `wp_blogs` table
</span><span style=color:#65737e>// and use them here as our domain => wp_blog.id mappings
</span><span>$</span><span style=color:#bf616a>site </span><span>= [
</span><span>    '</span><span style=color:#a3be8c>my-blog.localhost</span><span>' => </span><span style=color:#d08770>1</span><span>,
</span><span>    '</span><span style=color:#a3be8c>my-other-blog.localhost</span><span>' => </span><span style=color:#d08770>2</span><span>,
</span><span>][$</span><span style=color:#bf616a>_SERVER</span><span>['</span><span style=color:#a3be8c>HTTP_HOST</span><span>']];
</span><span>
</span><span style=color:#65737e>// we set the active ID here now that we have the right one
</span><span style=color:#65737e>// based on the domain we are on in this request
</span><span style=color:#96b5b4>define</span><span>('</span><span style=color:#a3be8c>SITE_ID_CURRENT_SITE</span><span>', $</span><span style=color:#bf616a>site</span><span>);
</span><span style=color:#96b5b4>define</span><span>('</span><span style=color:#a3be8c>BLOG_ID_CURRENT_SITE</span><span>', $</span><span style=color:#bf616a>site</span><span>);
</span><span>
</span><span style=color:#65737e>// the rest of the regular stuff
</span><span style=color:#65737e>// up to you what you want here
</span><span style=color:#96b5b4>define</span><span>('</span><span style=color:#a3be8c>WP_DEBUG</span><span>', </span><span style=color:#d08770>false</span><span>);
</span><span style=color:#96b5b4>define</span><span>('</span><span style=color:#a3be8c>WP_CACHE</span><span>', </span><span style=color:#d08770>false</span><span>);
</span><span style=color:#96b5b4>define</span><span>('</span><span style=color:#a3be8c>PATH_CURRENT_SITE</span><span>', '</span><span style=color:#a3be8c>/</span><span>');
</span><span style=color:#96b5b4>define</span><span>('</span><span style=color:#a3be8c>COOKIE_DOMAIN</span><span>', '');
</span><span style=color:#96b5b4>define</span><span>('</span><span style=color:#a3be8c>ADMIN_COOKIE_PATH</span><span>', '</span><span style=color:#a3be8c>/</span><span>');
</span><span style=color:#96b5b4>define</span><span>('</span><span style=color:#a3be8c>COOKIEPATH</span><span>', '</span><span style=color:#a3be8c>/</span><span>');
</span><span style=color:#96b5b4>define</span><span>('</span><span style=color:#a3be8c>SITECOOKIEPATH</span><span>', '</span><span style=color:#a3be8c>/</span><span>');
</span></code></pre><p>So what we are doing here is taking advantage of the way PHP handles requests. Each request runs the entire application. So we can use the request itself as the state of our application. We use the domain to figure out which site we should be loading. Pretty simple.<p>Now we don't have to make multiple copies of the WordPress setup just to test the basic multisite features.<p>I understand that you probably don't want to do this as multisite is usually because you want to administrate multiple instances of WordPress at the same time. But when you are just using multisite for managing content. In my case, it was just that the site was multilingual and so we wanted the sites to be identical but the content is swapping in and out. So this is a setup for that instead of having two completely separate folders and copies.<p>The nice thing about this is that it also scales nicely. If you have new sites, just <code>valet link</code> the domain, and add to the array of <code>$sites</code>. Done!</div><p><a title="Go Back Home" href=https://ohdoylerules.com>Go home</a><hr><div class="media grid"><div class=media-left><a class=post-author-link href=https://twitter.com/james2doyle target=_blank> <img alt="James Doyle Profile Picture" src="https://www.gravatar.com/avatar/b7375c88e1864c4ddf0d7bdab58e4cca?s=120&d=mm&r=g" height=120 width=120> </a></div><div class="media-body cell -9of12"><div class=media-heading><h3 itemprop="author publisher creator provider">James Doyle</h3></div><div class=media-content><p>I'm a full-stack developer, co-organizer of <a title="PHP Vancouver" href=https://www.meetup.com/vancouver-php target=_blank>PHP Vancouver</a> meetup, and winner of a <a title="Canadian Developer 30 under 30 award" href=http://www.canadianbusiness.com/innovation/developer-30-under-30-gallery/image/20/ target=_blank>Canadian Developer 30 under 30 award</a>. I'm a huge Open Source advocate and contributor to a lot of projects in my community. When I am not sitting at a computer, I'm trying to perfect some other skill.</div></div></div></article></div></div></main><script src=https://unpkg.com/swup@4.6.1/dist/Swup.umd.js></script><script>const swup=new Swup({native:true});function handleGists(){const a=document.querySelectorAll('.iframes');[...a].forEach(function(b){b.onload=function(){b.style.height=b.contentWindow.document.body.scrollHeight+ 50+ 'px'};b.style.height=b.contentWindow.document.body.scrollHeight+ 50+ 'px'})}document.addEventListener('DOMContentLoaded',handleGists);swup.hooks.on('visit:end',handleGists,{priority:100})</script>